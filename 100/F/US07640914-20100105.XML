<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v42-2006-08-23.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07640914-20100105.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20091221" date-publ="20100105">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07640914</doc-number>
<kind>B2</kind>
<date>20100105</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>12124845</doc-number>
<date>20080521</date>
</document-id>
</application-reference>
<us-application-series-code>12</us-application-series-code>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>F</section>
<class>02</class>
<subclass>D</subclass>
<main-group>41</main-group>
<subgroup>30</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20100105</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>F</section>
<class>02</class>
<subclass>M</subclass>
<main-group>43</main-group>
<subgroup>00</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20100105</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>F</section>
<class>02</class>
<subclass>B</subclass>
<main-group>15</main-group>
<subgroup>00</subgroup>
<symbol-position>L</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20100105</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>123431</main-classification>
<further-classification> 23478</further-classification>
<further-classification> 23575</further-classification>
</classification-national>
<invention-title id="d0e43">Engine output control system and method</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>2221405</doc-number>
<kind>A</kind>
<name>Nallinger</name>
<date>19401100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>3589348</doc-number>
<kind>A</kind>
<name>Reichhelm</name>
<date>19710600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>3794000</doc-number>
<kind>A</kind>
<name>Hodgkinson</name>
<date>19740200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>4031864</doc-number>
<kind>A</kind>
<name>Crothers</name>
<date>19770600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>4136652</doc-number>
<kind>A</kind>
<name>Lee</name>
<date>19790100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>4205650</doc-number>
<kind>A</kind>
<name>Szwarcbier</name>
<date>19800600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>4256075</doc-number>
<kind>A</kind>
<name>Fukui et al.</name>
<date>19810300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>4311118</doc-number>
<kind>A</kind>
<name>Slagle</name>
<date>19820100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>4325329</doc-number>
<kind>A</kind>
<name>Taylor</name>
<date>19820400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>4331121</doc-number>
<kind>A</kind>
<name>Stokes</name>
<date>19820500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>4402296</doc-number>
<kind>A</kind>
<name>Schwarz</name>
<date>19830900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>4411243</doc-number>
<kind>A</kind>
<name>Hardenberg et al.</name>
<date>19831000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>4459930</doc-number>
<kind>A</kind>
<name>Flory</name>
<date>19840700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>4480616</doc-number>
<kind>A</kind>
<name>Takeda</name>
<date>19841100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>4489596</doc-number>
<kind>A</kind>
<name>Linder et al.</name>
<date>19841200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>4502453</doc-number>
<kind>A</kind>
<name>Kabasin et al.</name>
<date>19850300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>4558665</doc-number>
<kind>A</kind>
<name>Sandberg et al.</name>
<date>19851200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>4590904</doc-number>
<kind>A</kind>
<name>Wannenwetsch</name>
<date>19860500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>4648367</doc-number>
<kind>A</kind>
<name>Gillbrand et al.</name>
<date>19870300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00020">
<document-id>
<country>US</country>
<doc-number>4706630</doc-number>
<kind>A</kind>
<name>Wineland et al.</name>
<date>19871100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00021">
<document-id>
<country>US</country>
<doc-number>4810929</doc-number>
<kind>A</kind>
<name>Strumbos</name>
<date>19890300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00022">
<document-id>
<country>US</country>
<doc-number>4817576</doc-number>
<kind>A</kind>
<name>Abe et al.</name>
<date>19890400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00023">
<document-id>
<country>US</country>
<doc-number>4930537</doc-number>
<kind>A</kind>
<name>Farmer</name>
<date>19900600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00024">
<document-id>
<country>US</country>
<doc-number>4945881</doc-number>
<kind>A</kind>
<name>Gonze et al.</name>
<date>19900800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00025">
<document-id>
<country>US</country>
<doc-number>4962789</doc-number>
<kind>A</kind>
<name>Benscoter</name>
<date>19901000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00026">
<document-id>
<country>US</country>
<doc-number>4993386</doc-number>
<kind>A</kind>
<name>Ozasa et al.</name>
<date>19910200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00027">
<document-id>
<country>US</country>
<doc-number>4998518</doc-number>
<kind>A</kind>
<name>Mitsumoto</name>
<date>19910300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00028">
<document-id>
<country>US</country>
<doc-number>5017826</doc-number>
<kind>A</kind>
<name>Oshima et al.</name>
<date>19910500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00029">
<document-id>
<country>US</country>
<doc-number>5018483</doc-number>
<kind>A</kind>
<name>Kashima et al.</name>
<date>19910500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00030">
<document-id>
<country>US</country>
<doc-number>5044331</doc-number>
<kind>A</kind>
<name>Suga et al.</name>
<date>19910900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00031">
<document-id>
<country>US</country>
<doc-number>5044344</doc-number>
<kind>A</kind>
<name>Tuckey et al.</name>
<date>19910900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00032">
<document-id>
<country>US</country>
<doc-number>5056490</doc-number>
<kind>A</kind>
<name>Kashima</name>
<date>19911000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00033">
<document-id>
<country>US</country>
<doc-number>5056494</doc-number>
<kind>A</kind>
<name>Kayanuma</name>
<date>19911000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00034">
<document-id>
<country>US</country>
<doc-number>5060610</doc-number>
<kind>A</kind>
<name>Paro</name>
<date>19911000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00035">
<document-id>
<country>US</country>
<doc-number>5111795</doc-number>
<kind>A</kind>
<name>Thompson</name>
<date>19920500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00036">
<document-id>
<country>US</country>
<doc-number>5131228</doc-number>
<kind>A</kind>
<name>Mochizuki et al.</name>
<date>19920700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00037">
<document-id>
<country>US</country>
<doc-number>5174247</doc-number>
<kind>A</kind>
<name>Tosa et al.</name>
<date>19921200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00038">
<document-id>
<country>US</country>
<doc-number>5188087</doc-number>
<kind>A</kind>
<name>Saito</name>
<date>19930200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00039">
<document-id>
<country>US</country>
<doc-number>5204630</doc-number>
<kind>A</kind>
<name>Seitz et al.</name>
<date>19930400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00040">
<document-id>
<country>US</country>
<doc-number>5230309</doc-number>
<kind>A</kind>
<name>Suga et al.</name>
<date>19930700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00041">
<document-id>
<country>US</country>
<doc-number>5233944</doc-number>
<kind>A</kind>
<name>Mochizuki</name>
<date>19930800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00042">
<document-id>
<country>US</country>
<doc-number>5335637</doc-number>
<kind>A</kind>
<name>Davis et al.</name>
<date>19940800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00043">
<document-id>
<country>US</country>
<doc-number>5336396</doc-number>
<kind>A</kind>
<name>Shetley</name>
<date>19940800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00044">
<document-id>
<country>US</country>
<doc-number>5357908</doc-number>
<kind>A</kind>
<name>Sung et al.</name>
<date>19941000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00045">
<document-id>
<country>US</country>
<doc-number>5360034</doc-number>
<kind>A</kind>
<name>Der Manuelian</name>
<date>19941100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00046">
<document-id>
<country>US</country>
<doc-number>5408979</doc-number>
<kind>A</kind>
<name>Backlund et al.</name>
<date>19950400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00047">
<document-id>
<country>US</country>
<doc-number>5417239</doc-number>
<kind>A</kind>
<name>Ford</name>
<date>19950500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00048">
<document-id>
<country>US</country>
<doc-number>5469830</doc-number>
<kind>A</kind>
<name>Gonzales</name>
<date>19951100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00049">
<document-id>
<country>US</country>
<doc-number>5477836</doc-number>
<kind>A</kind>
<name>Hyodo et al.</name>
<date>19951200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00050">
<document-id>
<country>US</country>
<doc-number>5508582</doc-number>
<kind>A</kind>
<name>Sugimoto et al.</name>
<date>19960400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00051">
<document-id>
<country>US</country>
<doc-number>5565157</doc-number>
<kind>A</kind>
<name>Sugimoto et al.</name>
<date>19961000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00052">
<document-id>
<country>US</country>
<doc-number>5694908</doc-number>
<kind>A</kind>
<name>Hsu</name>
<date>19971200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00053">
<document-id>
<country>US</country>
<doc-number>5740784</doc-number>
<kind>A</kind>
<name>McKinney</name>
<date>19980400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00054">
<document-id>
<country>US</country>
<doc-number>5782092</doc-number>
<kind>A</kind>
<name>Schultalbers et al.</name>
<date>19980700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00055">
<document-id>
<country>US</country>
<doc-number>5806500</doc-number>
<kind>A</kind>
<name>Fargo et al.</name>
<date>19980900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00056">
<document-id>
<country>US</country>
<doc-number>5875743</doc-number>
<kind>A</kind>
<name>Dickey</name>
<date>19990300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00057">
<document-id>
<country>US</country>
<doc-number>5887566</doc-number>
<kind>A</kind>
<name>Glauber et al.</name>
<date>19990300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00058">
<document-id>
<country>US</country>
<doc-number>5921222</doc-number>
<kind>A</kind>
<name>Freeland</name>
<date>19990700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00059">
<document-id>
<country>US</country>
<doc-number>6112705</doc-number>
<kind>A</kind>
<name>Nakayama et al.</name>
<date>20000900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00060">
<document-id>
<country>US</country>
<doc-number>6112725</doc-number>
<kind>A</kind>
<name>McKinney</name>
<date>20000900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00061">
<document-id>
<country>US</country>
<doc-number>6119637</doc-number>
<kind>A</kind>
<name>Matthews et al.</name>
<date>20000900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00062">
<document-id>
<country>US</country>
<doc-number>6189516</doc-number>
<kind>B1</kind>
<name>Hei Ma</name>
<date>20010200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00063">
<document-id>
<country>US</country>
<doc-number>6213086</doc-number>
<kind>B1</kind>
<name>Chmela et al.</name>
<date>20010400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00064">
<document-id>
<country>US</country>
<doc-number>6229253</doc-number>
<kind>B1</kind>
<name>Iwata et al.</name>
<date>20010500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00065">
<document-id>
<country>US</country>
<doc-number>6234123</doc-number>
<kind>B1</kind>
<name>Iiyama et al.</name>
<date>20010500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00066">
<document-id>
<country>US</country>
<doc-number>6318083</doc-number>
<kind>B1</kind>
<name>Machida et al.</name>
<date>20011100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00067">
<document-id>
<country>US</country>
<doc-number>6325039</doc-number>
<kind>B1</kind>
<name>Goto</name>
<date>20011200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00068">
<document-id>
<country>US</country>
<doc-number>6382225</doc-number>
<kind>B1</kind>
<name>Tipton</name>
<date>20020500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00069">
<document-id>
<country>US</country>
<doc-number>6494192</doc-number>
<kind>B1</kind>
<name>Capshaw et al.</name>
<date>20021200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00070">
<document-id>
<country>US</country>
<doc-number>6505579</doc-number>
<kind>B1</kind>
<name>Lee</name>
<date>20030100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00071">
<document-id>
<country>US</country>
<doc-number>6553974</doc-number>
<kind>B1</kind>
<name>Wickman et al.</name>
<date>20030400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00072">
<document-id>
<country>US</country>
<doc-number>6617769</doc-number>
<kind>B2</kind>
<name>Suzuki</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00073">
<document-id>
<country>US</country>
<doc-number>6619242</doc-number>
<kind>B2</kind>
<name>Kaneko</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00074">
<document-id>
<country>US</country>
<doc-number>6622664</doc-number>
<kind>B2</kind>
<name>Holder et al.</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00075">
<document-id>
<country>US</country>
<doc-number>6622690</doc-number>
<kind>B2</kind>
<name>Ando et al.</name>
<date>20030900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00076">
<document-id>
<country>US</country>
<doc-number>6651432</doc-number>
<kind>B1</kind>
<name>Gray, Jr.</name>
<date>20031100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00077">
<document-id>
<country>US</country>
<doc-number>6659068</doc-number>
<kind>B2</kind>
<name>Urushihara et al.</name>
<date>20031200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00078">
<document-id>
<country>US</country>
<doc-number>6691669</doc-number>
<kind>B2</kind>
<name>Surnilla et al.</name>
<date>20040200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00079">
<document-id>
<country>US</country>
<doc-number>6698387</doc-number>
<kind>B1</kind>
<name>McFarland et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00080">
<document-id>
<country>US</country>
<doc-number>6711893</doc-number>
<kind>B2</kind>
<name>Ueda et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00081">
<document-id>
<country>US</country>
<doc-number>6792966</doc-number>
<kind>B2</kind>
<name>Harvey</name>
<date>20040900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00082">
<document-id>
<country>US</country>
<doc-number>6845616</doc-number>
<kind>B2</kind>
<name>Jauss</name>
<date>20050100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00083">
<document-id>
<country>US</country>
<doc-number>6928983</doc-number>
<kind>B2</kind>
<name>Mashiki</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00084">
<document-id>
<country>US</country>
<doc-number>6951202</doc-number>
<kind>B2</kind>
<name>Oda</name>
<date>20051000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00085">
<document-id>
<country>US</country>
<doc-number>6959693</doc-number>
<kind>B2</kind>
<name>Oda</name>
<date>20051100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00086">
<document-id>
<country>US</country>
<doc-number>6972093</doc-number>
<kind>B2</kind>
<name>Partridge et al.</name>
<date>20051200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00087">
<document-id>
<country>US</country>
<doc-number>6978762</doc-number>
<kind>B2</kind>
<name>Mori</name>
<date>20051200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00088">
<document-id>
<country>US</country>
<doc-number>6988485</doc-number>
<kind>B2</kind>
<name>Ichise et al.</name>
<date>20060100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00089">
<document-id>
<country>US</country>
<doc-number>6990956</doc-number>
<kind>B2</kind>
<name>Niimi</name>
<date>20060100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00090">
<document-id>
<country>US</country>
<doc-number>7055500</doc-number>
<kind>B2</kind>
<name>Miyashita et al.</name>
<date>20060600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00091">
<document-id>
<country>US</country>
<doc-number>7082926</doc-number>
<kind>B2</kind>
<name>Sadakane et al.</name>
<date>20060800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00092">
<document-id>
<country>US</country>
<doc-number>7159568</doc-number>
<kind>B1</kind>
<name>Lewis et al.</name>
<date>20070100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00093">
<document-id>
<country>US</country>
<doc-number>7178503</doc-number>
<kind>B1</kind>
<name>Brehob</name>
<date>20070200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00094">
<document-id>
<country>US</country>
<doc-number>7225787</doc-number>
<kind>B2</kind>
<name>Bromberg et al.</name>
<date>20070600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00095">
<document-id>
<country>US</country>
<doc-number>7255080</doc-number>
<kind>B1</kind>
<name>Leone</name>
<date>20070800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00096">
<document-id>
<country>US</country>
<doc-number>7261064</doc-number>
<kind>B2</kind>
<name>Bhaisora et al.</name>
<date>20070800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00097">
<document-id>
<country>US</country>
<doc-number>7278396</doc-number>
<kind>B2</kind>
<name>Leone et al.</name>
<date>20071000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00098">
<document-id>
<country>US</country>
<doc-number>7287492</doc-number>
<kind>B2</kind>
<name>Leone et al.</name>
<date>20071000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00099">
<document-id>
<country>US</country>
<doc-number>7287509</doc-number>
<kind>B1</kind>
<name>Brehob</name>
<date>20071000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00100">
<document-id>
<country>US</country>
<doc-number>7293552</doc-number>
<kind>B2</kind>
<name>Leone et al.</name>
<date>20071100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00101">
<document-id>
<country>US</country>
<doc-number>7302933</doc-number>
<kind>B2</kind>
<name>Kerns</name>
<date>20071200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00102">
<document-id>
<country>US</country>
<doc-number>7412966</doc-number>
<kind>B2</kind>
<name>Lewis et al.</name>
<date>20080800</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123431</main-classification></classification-national>
</citation>
<citation>
<patcit num="00103">
<document-id>
<country>US</country>
<doc-number>2001/0035215</doc-number>
<kind>A1</kind>
<name>Tipton et al.</name>
<date>20011100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00104">
<document-id>
<country>US</country>
<doc-number>2003/0089337</doc-number>
<kind>A1</kind>
<name>Cohn et al.</name>
<date>20030500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00105">
<document-id>
<country>US</country>
<doc-number>2003/0127072</doc-number>
<kind>A1</kind>
<name>Gmelin et al.</name>
<date>20030700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00106">
<document-id>
<country>US</country>
<doc-number>2004/0035395</doc-number>
<kind>A1</kind>
<name>Heywood et al.</name>
<date>20040200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00107">
<document-id>
<country>US</country>
<doc-number>2004/0065274</doc-number>
<kind>A1</kind>
<name>Cohn et al.</name>
<date>20040400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00108">
<document-id>
<country>US</country>
<doc-number>2004/0083717</doc-number>
<kind>A1</kind>
<name>Zhu et al.</name>
<date>20040500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00109">
<document-id>
<country>US</country>
<doc-number>2004/0250790</doc-number>
<kind>A1</kind>
<name>Heywood et al.</name>
<date>20041200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00110">
<document-id>
<country>US</country>
<doc-number>2004/0261763</doc-number>
<kind>A1</kind>
<name>Hashimoto et al.</name>
<date>20041200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00111">
<document-id>
<country>US</country>
<doc-number>2005/0051135</doc-number>
<kind>A1</kind>
<name>Tomoda et al.</name>
<date>20050300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00112">
<document-id>
<country>US</country>
<doc-number>2005/0066939</doc-number>
<kind>A1</kind>
<name>Shimada et al.</name>
<date>20050300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00113">
<document-id>
<country>US</country>
<doc-number>2005/0097888</doc-number>
<kind>A1</kind>
<name>Miyashita</name>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00114">
<document-id>
<country>US</country>
<doc-number>2005/0103285</doc-number>
<kind>A1</kind>
<name>Oda</name>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00115">
<document-id>
<country>US</country>
<doc-number>2005/0109316</doc-number>
<kind>A1</kind>
<name>Oda</name>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00116">
<document-id>
<country>US</country>
<doc-number>2005/0109319</doc-number>
<kind>A1</kind>
<name>Oda</name>
<date>20050500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00117">
<document-id>
<country>US</country>
<doc-number>2005/0155577</doc-number>
<kind>A1</kind>
<name>Ichise et al.</name>
<date>20050700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00118">
<document-id>
<country>US</country>
<doc-number>2005/0155578</doc-number>
<kind>A1</kind>
<name>Ichise et al.</name>
<date>20050700</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00119">
<document-id>
<country>US</country>
<doc-number>2005/0166896</doc-number>
<kind>A1</kind>
<name>Sadakane</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00120">
<document-id>
<country>US</country>
<doc-number>2005/0172931</doc-number>
<kind>A1</kind>
<name>Mori</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00121">
<document-id>
<country>US</country>
<doc-number>2005/0178356</doc-number>
<kind>A1</kind>
<name>Shibagaki</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00122">
<document-id>
<country>US</country>
<doc-number>2005/0178360</doc-number>
<kind>A1</kind>
<name>Satou</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00123">
<document-id>
<country>US</country>
<doc-number>2005/0183698</doc-number>
<kind>A1</kind>
<name>Yonezawa</name>
<date>20050800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00124">
<document-id>
<country>US</country>
<doc-number>2005/0274353</doc-number>
<kind>A1</kind>
<name>Okubo et al.</name>
<date>20051200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00125">
<document-id>
<country>US</country>
<doc-number>2006/0016429</doc-number>
<kind>A1</kind>
<name>Mashiki</name>
<date>20060100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00126">
<document-id>
<country>US</country>
<doc-number>2006/0075991</doc-number>
<kind>A1</kind>
<name>Heywood et al.</name>
<date>20060400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00127">
<document-id>
<country>US</country>
<doc-number>2006/0090732</doc-number>
<kind>A1</kind>
<name>Shibagaki</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00128">
<document-id>
<country>US</country>
<doc-number>2006/0102136</doc-number>
<kind>A1</kind>
<name>Bromberg et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00129">
<document-id>
<country>US</country>
<doc-number>2006/0102145</doc-number>
<kind>A1</kind>
<name>Cohn et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00130">
<document-id>
<country>US</country>
<doc-number>2006/0102146</doc-number>
<kind>A1</kind>
<name>Cohn et al.</name>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00131">
<document-id>
<country>US</country>
<doc-number>2006/0180099</doc-number>
<kind>A1</kind>
<name>Aimoto et al.</name>
<date>20060800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00132">
<document-id>
<country>US</country>
<doc-number>2006/0191727</doc-number>
<kind>A1</kind>
<name>Usami et al.</name>
<date>20060800</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00133">
<document-id>
<country>US</country>
<doc-number>2007/0028861</doc-number>
<kind>A1</kind>
<name>Kamio et al.</name>
<date>20070200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00134">
<document-id>
<country>US</country>
<doc-number>2007/0028905</doc-number>
<kind>A1</kind>
<name>Shinagawa et al.</name>
<date>20070200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00135">
<document-id>
<country>US</country>
<doc-number>2007/0034192</doc-number>
<kind>A1</kind>
<name>Kamio et al.</name>
<date>20070200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00136">
<document-id>
<country>US</country>
<doc-number>2007/0119391</doc-number>
<kind>A1</kind>
<name>Fried et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00137">
<document-id>
<country>US</country>
<doc-number>2007/0119392</doc-number>
<kind>A1</kind>
<name>Leone et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00138">
<document-id>
<country>US</country>
<doc-number>2007/0119394</doc-number>
<kind>A1</kind>
<name>Leone</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00139">
<document-id>
<country>US</country>
<doc-number>2007/0119412</doc-number>
<kind>A1</kind>
<name>Leone et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00140">
<document-id>
<country>US</country>
<doc-number>2007/0119413</doc-number>
<kind>A1</kind>
<name>Lewis et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00141">
<document-id>
<country>US</country>
<doc-number>2007/0119414</doc-number>
<kind>A1</kind>
<name>Leone et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00142">
<document-id>
<country>US</country>
<doc-number>2007/0119415</doc-number>
<kind>A1</kind>
<name>Lewis et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00143">
<document-id>
<country>US</country>
<doc-number>2007/0119416</doc-number>
<kind>A1</kind>
<name>Boyarski</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00144">
<document-id>
<country>US</country>
<doc-number>2007/0119421</doc-number>
<kind>A1</kind>
<name>Lewis et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00145">
<document-id>
<country>US</country>
<doc-number>2007/0119422</doc-number>
<kind>A1</kind>
<name>Lewis et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00146">
<document-id>
<country>US</country>
<doc-number>2007/0119425</doc-number>
<kind>A1</kind>
<name>Lewis et al.</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00147">
<document-id>
<country>US</country>
<doc-number>2007/0204813</doc-number>
<kind>A1</kind>
<name>Arai et al.</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00148">
<document-id>
<country>US</country>
<doc-number>2007/0215069</doc-number>
<kind>A1</kind>
<name>Leone</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00149">
<document-id>
<country>US</country>
<doc-number>2007/0215071</doc-number>
<kind>A1</kind>
<name>Dearth et al.</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00150">
<document-id>
<country>US</country>
<doc-number>2007/0215072</doc-number>
<kind>A1</kind>
<name>Dearth et al.</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00151">
<document-id>
<country>US</country>
<doc-number>2007/0215101</doc-number>
<kind>A1</kind>
<name>Russell et al.</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00152">
<document-id>
<country>US</country>
<doc-number>2007/0215102</doc-number>
<kind>A1</kind>
<name>Russell et al.</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00153">
<document-id>
<country>US</country>
<doc-number>2007/0215104</doc-number>
<kind>A1</kind>
<name>Hahn</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00154">
<document-id>
<country>US</country>
<doc-number>2007/0215110</doc-number>
<kind>A1</kind>
<name>Stein et al.</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00155">
<document-id>
<country>US</country>
<doc-number>2007/0215111</doc-number>
<kind>A1</kind>
<name>Surnilla</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00156">
<document-id>
<country>US</country>
<doc-number>2007/0215125</doc-number>
<kind>A1</kind>
<name>Dearth et al.</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00157">
<document-id>
<country>US</country>
<doc-number>2007/0215127</doc-number>
<kind>A1</kind>
<name>Dearth et al.</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00158">
<document-id>
<country>US</country>
<doc-number>2007/0215130</doc-number>
<kind>A1</kind>
<name>Shelby et al.</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00159">
<document-id>
<country>US</country>
<doc-number>2007/0219679</doc-number>
<kind>A1</kind>
<name>Leone</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00160">
<document-id>
<country>US</country>
<doc-number>2007/0219701</doc-number>
<kind>A1</kind>
<name>Hashimoto et al.</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00161">
<document-id>
<country>US</country>
<doc-number>2007/0221163</doc-number>
<kind>A1</kind>
<name>Kamio</name>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00162">
<document-id>
<country>US</country>
<doc-number>2007/0234976</doc-number>
<kind>A1</kind>
<name>Dearth et al.</name>
<date>20071000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00163">
<document-id>
<country>US</country>
<doc-number>2007/0289573</doc-number>
<kind>A1</kind>
<name>Leone et al.</name>
<date>20071200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00164">
<document-id>
<country>US</country>
<doc-number>2007/0295307</doc-number>
<kind>A1</kind>
<name>Kerns</name>
<date>20071200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00165">
<document-id>
<country>US</country>
<doc-number>2008/0035106</doc-number>
<kind>A1</kind>
<name>Stein</name>
<date>20080200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00166">
<document-id>
<country>US</country>
<doc-number>2008/0041334</doc-number>
<kind>A1</kind>
<name>Brehob</name>
<date>20080200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00167">
<document-id>
<country>US</country>
<doc-number>2008/0072881</doc-number>
<kind>A1</kind>
<name>Leone et al.</name>
<date>20080300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00168">
<document-id>
<country>US</country>
<doc-number>2008/0127933</doc-number>
<kind>A1</kind>
<name>Blumberg et al.</name>
<date>20080600</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00169">
<document-id>
<country>US</country>
<doc-number>2009/0043478</doc-number>
<kind>A1</kind>
<name>Labonte</name>
<date>20090200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>701103</main-classification></classification-national>
</citation>
<citation>
<patcit num="00170">
<document-id>
<country>US</country>
<doc-number>2009/0076705</doc-number>
<kind>A1</kind>
<name>Colesworthy et al.</name>
<date>20090300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>701103</main-classification></classification-national>
</citation>
<citation>
<patcit num="00171">
<document-id>
<country>EP</country>
<doc-number>1057988</doc-number>
<date>20060100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00172">
<document-id>
<country>JP</country>
<doc-number>61065066</doc-number>
<date>19860400</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00173">
<document-id>
<country>JP</country>
<doc-number>2007/056754</doc-number>
<date>20070300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00174">
<document-id>
<country>WO</country>
<doc-number>2004/097198</doc-number>
<date>20041100</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00175">
<document-id>
<country>WO</country>
<doc-number>2006/055540</doc-number>
<date>20060500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00176">
<document-id>
<country>WO</country>
<doc-number>2007/106354</doc-number>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00177">
<document-id>
<country>WO</country>
<doc-number>2007/106416</doc-number>
<date>20070900</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00178">
<othercit>U.S. Appl. No. 60/780,319, filed Mar. 8, 2006, Bromberg et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00179">
<othercit>U.S. Appl. No. 60/780,981, filed Mar. 10, 2006, Cohn et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00180">
<othercit>U.S. Appl. No. 60/781,598, filed Mar. 10, 2006, Blumberg et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00181">
<othercit>U.S. Appl. No. 60/790,715, filed Apr. 10, 2006, Bromberg et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00182">
<othercit>U.S. Appl. No. 60/746,507, filed May 5, 2006, Cohn et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00183">
<othercit>U.S. Appl. No. 60/747,865, filed May 22, 2006, Heywood et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00184">
<othercit>U.S. Appl. No. 60/832,836, filed Jun. 24, 2006, Bromberg et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00185">
<othercit>U.S. Appl. No. 11/682,372, filed Mar. 6, 2007, Bromberg et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00186">
<othercit>U.S. Appl. No. 11/683,564, filed Mar. 8, 2007, Bromberg et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00187">
<othercit>U.S. Appl. No. 11/684,100, filed Mar. 9, 2008, Bromberg et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00188">
<othercit>U.S. Appl. No. 60/948,753, filed Jun. 10, 2007, Bromberg et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00189">
<othercit>U.S. Appl. No. 11/776,120, filed Jul. 11, 2007, Stein et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00190">
<othercit>U.S. Appl. No. 11/782,050, filed Jul. 24, 2007, Bromberg et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00191">
<othercit>U.S. Appl. No. 60/973,499, filed Sep. 19,2 007, Bromberg.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00192">
<othercit>U.S. Appl. No. 11/871,496, filed Oct. 12, 2007, Zubeck et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00193">
<othercit>U.S. Appl. No. 11/955,246, filed Dec. 12, 2007, Pursifull et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00194">
<othercit>U.S. Appl. No. 11/962,683, filed Dec. 21, 2007, Pursifull et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00195">
<othercit>U.S. Appl. No. 12/014,952, filed Jan. 16, 2008, Leone et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00196">
<othercit>U.S. Appl. No. 12/048,395, filed Mar. 14, 2008, Boyarski.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00197">
<othercit>U.S. Appl. No. 12/117,167, filed May 8, 2008, Leone et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00198">
<othercit>U.S. Appl. No. 12/145,110, filed Jun. 24, 2008, Lewis et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00199">
<othercit>U.S. Appl. No. 12/176,832, filed Jul. 21, 2008, Lewis et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00200">
<othercit>Bromberg, V. et al., &#x201c;Calculations of Knock Suppressions in Highly Turbocharged Gasoline/Ethanol Engines Using Direct Ethanol Injection&#x201d;, Jul, 7, 2005, Massachusetts Institue of Technology.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00201">
<othercit>Brusca, S. et al., &#x201c;Water Injection in IC&#x2014;SI Engines to Control Detonation and to Reduce Pollutant Emissions&#x201d;, SAE Technical Paper No. 2003-01-1912, May 19-22, 2003.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00202">
<othercit>Cohn, D.R. et al., &#x201c;Direct Injection Ethanol Boosted Gasoline Engines: Biofuel Leveraging for Cost Effective Reduction of Oil Dependence and CO2 Emissions&#x201d;, Mar. 15, 2005, Massachusetts Institute of Technology.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00203">
<othercit>Hunter, M. Park, &#x201c;1962 Oldsmobile Jetfire,&#x201d; originally appeared in Special Interest Autos, Apr. 1996, http://www.tctc.com/&#x2dc;park/mph/pageCLIP/page62JET/62jet.htm, Nov. 7, 2006.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00204">
<othercit>Russ, Stephen &#x201c;A Review of the Effect of Engine Operating Conditions on Borderline Knock&#x201d;, SAE Technical Paper Series 960497, Feb. 26-29, 1996.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00205">
<othercit>Vance, Bill, &#x201c;Turbocharger Boosted Engine's Efficiency: Developed to maintain high-altitude performance,&#x201d; for the Calgary Herald Edmonton, www.ucalgary.cak/&#x2dc;simpson/Articles/JetFire.html, Nov. 7, 2006.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>11</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>123431</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123  1 A</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123300</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123304</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123478</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123575</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123305</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>12340623</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>12340621</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>12340629</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>12340647</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123516</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123520</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123432</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification> 60601</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>31</number-of-drawing-sheets>
<number-of-figures>49</number-of-figures>
</figures>
<us-related-documents>
<continuation>
<relation>
<parent-doc>
<document-id>
<country>US</country>
<doc-number>11291811</doc-number>
<kind>00</kind>
<date>20051130</date>
</document-id>
<parent-grant-document>
<document-id>
<country>US</country>
<doc-number>7412966</doc-number>
<kind>A </kind>
</document-id>
</parent-grant-document>
</parent-doc>
<child-doc>
<document-id>
<country>US</country>
<doc-number>12124845</doc-number>
</document-id>
</child-doc>
</relation>
</continuation>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20080228382</doc-number>
<kind>A1</kind>
<date>20080918</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Lewis</last-name>
<first-name>Donald J.</first-name>
<address>
<city>Howell</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Lippa</last-name>
<first-name>Allan J.</first-name>
<address>
<city>Northville</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Russell</last-name>
<first-name>John D.</first-name>
<address>
<city>Portland</city>
<state>OR</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<last-name>Lippa</last-name>
<first-name>Allan J.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
<agent sequence="02" rep-type="attorney">
<addressbook>
<orgname>Alleman Hall McCoy Russell &#x26; Tuttle LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Ford Global Technologies, LLC</orgname>
<role>02</role>
<address>
<city>Dearborn</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Huynh</last-name>
<first-name>Hai H</first-name>
<department>3747</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A system for an engine, comprising a cylinder located in the engine, a turbocharger coupled to the engine, a first injector for injecting a first fuel into said cylinder, wherein said first injector is a direct cylinder injector where said direct cylinder injector delivers a liquid including an alcohol, a second injector for injecting a second fuel into said cylinder, wherein said second injector is a port injector, where said port injector delivers a liquid including gasoline, a catalytic device configured to receive exhaust gases produced by at least the cylinder, and a controller configured to vary an amount of said first and second fuel injection during engine operation based on operating conditions, where amounts of variation of said first and second fuels are set to maintain a substantially stoichiometric mixture, the controller further configured to increase a relative amount of injection of the second injector in response to an indication of engine knock during a first operating condition, decrease engine boosting in response to the indication of engine knock during a second condition; and retard ignition timing in response the indication of engine knock during a third condition.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="168.40mm" wi="242.82mm" file="US07640914-20100105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="266.87mm" wi="182.80mm" file="US07640914-20100105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="260.86mm" wi="177.72mm" orientation="landscape" file="US07640914-20100105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="265.18mm" wi="191.01mm" file="US07640914-20100105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="271.61mm" wi="165.44mm" file="US07640914-20100105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="267.38mm" wi="187.03mm" file="US07640914-20100105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="263.65mm" wi="196.68mm" file="US07640914-20100105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="258.32mm" wi="194.65mm" file="US07640914-20100105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00008" num="00008">
<img id="EMI-D00008" he="267.72mm" wi="195.50mm" file="US07640914-20100105-D00008.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00009" num="00009">
<img id="EMI-D00009" he="267.89mm" wi="196.68mm" file="US07640914-20100105-D00009.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00010" num="00010">
<img id="EMI-D00010" he="255.52mm" wi="189.15mm" file="US07640914-20100105-D00010.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00011" num="00011">
<img id="EMI-D00011" he="272.03mm" wi="188.47mm" file="US07640914-20100105-D00011.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00012" num="00012">
<img id="EMI-D00012" he="264.75mm" wi="192.53mm" orientation="landscape" file="US07640914-20100105-D00012.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00013" num="00013">
<img id="EMI-D00013" he="262.72mm" wi="189.74mm" file="US07640914-20100105-D00013.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00014" num="00014">
<img id="EMI-D00014" he="218.36mm" wi="167.64mm" file="US07640914-20100105-D00014.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00015" num="00015">
<img id="EMI-D00015" he="271.61mm" wi="191.09mm" file="US07640914-20100105-D00015.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00016" num="00016">
<img id="EMI-D00016" he="265.60mm" wi="181.86mm" file="US07640914-20100105-D00016.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00017" num="00017">
<img id="EMI-D00017" he="239.69mm" wi="190.16mm" orientation="landscape" file="US07640914-20100105-D00017.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00018" num="00018">
<img id="EMI-D00018" he="269.66mm" wi="186.69mm" file="US07640914-20100105-D00018.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00019" num="00019">
<img id="EMI-D00019" he="266.62mm" wi="189.74mm" file="US07640914-20100105-D00019.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00020" num="00020">
<img id="EMI-D00020" he="266.19mm" wi="194.90mm" file="US07640914-20100105-D00020.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00021" num="00021">
<img id="EMI-D00021" he="262.81mm" wi="193.12mm" file="US07640914-20100105-D00021.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00022" num="00022">
<img id="EMI-D00022" he="267.29mm" wi="171.53mm" file="US07640914-20100105-D00022.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00023" num="00023">
<img id="EMI-D00023" he="271.19mm" wi="196.43mm" file="US07640914-20100105-D00023.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00024" num="00024">
<img id="EMI-D00024" he="264.92mm" wi="191.60mm" file="US07640914-20100105-D00024.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00025" num="00025">
<img id="EMI-D00025" he="255.61mm" wi="183.56mm" file="US07640914-20100105-D00025.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00026" num="00026">
<img id="EMI-D00026" he="263.65mm" wi="174.50mm" file="US07640914-20100105-D00026.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00027" num="00027">
<img id="EMI-D00027" he="250.11mm" wi="169.33mm" orientation="landscape" file="US07640914-20100105-D00027.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00028" num="00028">
<img id="EMI-D00028" he="129.03mm" wi="166.71mm" file="US07640914-20100105-D00028.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00029" num="00029">
<img id="EMI-D00029" he="232.83mm" wi="170.18mm" orientation="landscape" file="US07640914-20100105-D00029.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00030" num="00030">
<img id="EMI-D00030" he="227.67mm" wi="180.26mm" orientation="landscape" file="US07640914-20100105-D00030.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00031" num="00031">
<img id="EMI-D00031" he="265.51mm" wi="191.60mm" file="US07640914-20100105-D00031.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?RELAPP description="Other Patent Relations" end="lead"?>
<heading id="h-0001" level="1">CROSS REFERENCE TO PRIORITY APPLICATIONS</heading>
<p id="p-0002" num="0001">The present application is a continuation of U.S. patent application Ser. No. 11/291,811, titled &#x201c;Engine Output Control System and Method&#x201d;, filed Nov. 30, 2005, the entire contents of which are incorporated herein by reference.</p>
<?RELAPP description="Other Patent Relations" end="tail"?>
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0002" level="1">BACKGROUND AND SUMMARY</heading>
<p id="p-0003" num="0002">Engines may use various forms of fuel delivery to provide a desired amount of fuel for combustion in each cylinder. One type of fuel delivery uses a port injector for each cylinder to deliver fuel to respective cylinders. Still another type of fuel delivery uses a direct injector for each cylinder.</p>
<p id="p-0004" num="0003">Engines have been described utilizing multiple injector locations with different fuel types. One example is described in the papers titled &#x201c;Calculations of Knock Suppression in Highly Turbocharged Gasoline/Ethanol Engines Using Direct Ethanol Injection&#x201d; and &#x201c;Direct Injection Ethanol Boosted Gasoline Engine: Biofuel Leveraging for Cost Effective Reduction of Oil Dependence and CO2 Emissions&#x201d; by Heywood et al. Specifically, the Heywood et al. papers describes directly injecting ethanol to improve charge cooling effects, while relying on port injected gasoline for providing the majority of combusted fuel over a drive cycle.</p>
<p id="p-0005" num="0004">However, the inventors herein have recognized several issues with such systems. For example, ethanol and gasoline have different power densities and different stoichiometric air-fuel ratios. Thus, if the absolute and relative amounts of fuel are varied with operating conditions during engine operation, combustion air-fuel ratio may inadvertently swing lean or rich during such operation. Further, engine torque may be affected as well due to the different power densities of the fuels. As such, degraded emissions and driver comfort may be achieved.</p>
<p id="p-0006" num="0005">Thus, in one approach, a system for an engine is provided, the system comprising: a cylinder located in the engine; a first injector for injecting a first fuel into said cylinder; a second injector for injecting a second fuel into said cylinder; and a controller configured to vary an amount of said first and second fuel injection during engine operation based on operating conditions, where amounts of variation of said first and second fuels are set to maintain desired engine output and provide a substantially stoichiometric mixture.</p>
<p id="p-0007" num="0006">In this way, it is possible to enable continuous variation between absolute and relative amounts of fuel from different sources with variation in operating conditions, while maintaining a desired air-fuel ratio and engine output torque.</p>
<p id="p-0008" num="0007">In one particular approach, the controller varies said amounts of one of said first and second fuel injection with a fuel blend of one of said first and second fuels. In this way, it is possible to maintain accurate air-fuel ratio control by compensating the amount of fuel injections based on the blend.</p>
<p id="p-0009" num="0008">In another approach a system for an engine is provided, the system comprising: a cylinder located in the engine; a first injector for injecting a first fuel into said cylinder; and a second injector for injecting a second fuel into said cylinder, said second injector sized different than said first injector.</p>
<p id="p-0010" num="0009">In this way, it is possible to utilize different fuel types with different power densities, yet still provide maximum engine torque and/or minimum engine torque with either fuel.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0003" level="1">DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 1</figref> is a block diagram of a vehicle illustrating various components of the powertrain system;</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 2</figref> shows a partial engine view;</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 3</figref> shows an engine with a turbocharger;</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIGS. 4-5</figref> show example engine cylinder and port configurations;</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 6</figref> shows two fuel injectors;</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 7</figref> shows a fuel pump system;</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIGS. 8-10</figref> shows fuel vapor purge system configurations;</p>
<p id="p-0018" num="0017"><figref idref="DRAWINGS">FIGS. 11-12</figref> shows high level flow charts for air-fuel ratio feedback control;</p>
<p id="p-0019" num="0018"><figref idref="DRAWINGS">FIGS. 13-14</figref> and <b>16</b> show high level flow charts for fuel type enablement;</p>
<p id="p-0020" num="0019"><figref idref="DRAWINGS">FIG. 15</figref> shows graphs illustrating example ratios of fuel type enablement based on operating conditions;</p>
<p id="p-0021" num="0020"><figref idref="DRAWINGS">FIGS. 16-18</figref> show high level flow charts for engine starting and running operation;</p>
<p id="p-0022" num="0021"><figref idref="DRAWINGS">FIG. 19</figref> shows a high level flow chart for engine starting taking into account fuel levels of different fuel types;</p>
<p id="p-0023" num="0022"><figref idref="DRAWINGS">FIG. 20</figref> shows a high level flow chart for compensating for depleting a fuel source;</p>
<p id="p-0024" num="0023"><figref idref="DRAWINGS">FIG. 21</figref> shows a graph illustrating different fuel injector characteristics for two example injectors;</p>
<p id="p-0025" num="0024"><figref idref="DRAWINGS">FIG. 22</figref> shows a graph illustrating an example relationship of fuel injection as a function of knock tendency;</p>
<p id="p-0026" num="0025"><figref idref="DRAWINGS">FIG. 23</figref> shows a high level flow chart of an alternative embodiment for controlling fuel injection of a first and second fuel type taking into account minimum pulse width issues and different fuel type characteristics;</p>
<p id="p-0027" num="0026"><figref idref="DRAWINGS">FIGS. 24-25</figref> show high level flow charts for controlling operation using water injection;</p>
<p id="p-0028" num="0027"><figref idref="DRAWINGS">FIGS. 26-27</figref> show graphs illustrating an amount of injection to reduce knock for varying water content and varying amounts of desired charge cooling;</p>
<p id="p-0029" num="0028"><figref idref="DRAWINGS">FIG. 28</figref> shows a high level flow chart for controlling fuel type injection amounts (and relative amounts) and/or adjusting ignition timing to reduce knock;</p>
<p id="p-0030" num="0029"><figref idref="DRAWINGS">FIG. 29</figref> shows graphs illustrating example knock control operation;</p>
<p id="p-0031" num="0030"><figref idref="DRAWINGS">FIG. 30</figref> shows a high level flow chart for event-based engine starting;</p>
<p id="p-0032" num="0031"><figref idref="DRAWINGS">FIGS. 31-34</figref> shows high level flow charts for fuel vapor purging control, estimation, and adaptive learning;</p>
<p id="p-0033" num="0032"><figref idref="DRAWINGS">FIG. 35</figref> shows a graph of an example injector characteristic;</p>
<p id="p-0034" num="0033"><figref idref="DRAWINGS">FIGS. 36-38</figref> show example fuel tank and pump configurations;</p>
<p id="p-0035" num="0034"><figref idref="DRAWINGS">FIG. 39</figref> shows a high level flow chart for transitioning on a second fuel type;</p>
<p id="p-0036" num="0035"><figref idref="DRAWINGS">FIG. 40</figref> shows example operation according to the routine of <figref idref="DRAWINGS">FIG. 39</figref>;</p>
<p id="p-0037" num="0036"><figref idref="DRAWINGS">FIG. 41</figref> shows a high level flow chart for selecting injection timing(s);</p>
<p id="p-0038" num="0037"><figref idref="DRAWINGS">FIG. 42</figref> shows a graph illustrating example injection timing operation;</p>
<p id="p-0039" num="0038"><figref idref="DRAWINGS">FIG. 43</figref> shows a graph illustrating fuel types and injection timings for various engine speed and load regions; and</p>
<p id="p-0040" num="0039"><figref idref="DRAWINGS">FIG. 44</figref> shows a high level flow chart for controlling boost.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0004" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0041" num="0040">Referring to <figref idref="DRAWINGS">FIG. 1</figref>, in this example, internal combustion engine <b>10</b>, further described herein with particular reference to <figref idref="DRAWINGS">FIGS. 2 and 3</figref>, is shown coupled to torque converter <b>11</b> via crankshaft <b>13</b>. Torque converter <b>11</b> is also coupled to transmission <b>15</b> via turbine shaft <b>17</b>. Torque converter <b>11</b> has a bypass, or lock-up clutch <b>14</b> which can be engaged, disengaged, or partially engaged. When the clutch is either disengaged or partially engaged, the torque converter is said to be in an unlocked state. The lock-up clutch <b>14</b> can be actuated electrically, hydraulically, or electro-hydraulically, for example. The lock-up clutch <b>14</b> receives a control signal (not shown) from the controller, described in more detail below. The control signal may be a pulse width modulated signal to engage, partially engage, and disengage, the clutch based on engine, vehicle, and/or transmission operating conditions. Turbine shaft <b>17</b> is also known as transmission input shaft. Transmission <b>15</b> comprises an electronically controlled transmission with a plurality of selectable discrete gear ratios. Transmission <b>15</b> also comprises various other gears, such as, for example, a final drive ratio (not shown). Transmission <b>15</b> is also coupled to tire <b>19</b> via axle <b>21</b>. Tire <b>19</b> interfaces the vehicle (not shown) to the road <b>23</b>. Note that in one example embodiment, this powertrain is coupled in a passenger vehicle that travels on the road.</p>
<p id="p-0042" num="0041">In an alternative embodiment, a manual transmission operated by a driver with a clutch may be used. Further, various types of automatic transmissions may be used.</p>
<p id="p-0043" num="0042"><figref idref="DRAWINGS">FIG. 2</figref> shows one cylinder of a multi-cylinder engine, as well as the intake and exhaust path connected to that cylinder. In the embodiment shown in <figref idref="DRAWINGS">FIG. 2</figref>, engine <b>10</b> is capable of using two different fuels, and/or two different injectors in one example. For example, engine <b>10</b> may use gasoline and an alcohol containing fuel such as ethanol, methanol, a mixture of gasoline and ethanol (e.g., E85 which is approximately 85% ethanol and 15% gasoline), a mixture of gasoline and methanol (e.g., M85 which is approximately 85% methanol and 15% gas), etc. In another example, two fuel systems are used, but each uses the same fuel, such as gasoline. In still another embodiment, a single injector (such as a direct injector) may be used to inject a mixture of gasoline and such an alcohol based fuel, where the ratio of the two fuel quantities in the mixture may be adjusted by controller <b>12</b> via a mixing valve, for example. In still another example, two different injectors for each cylinder are used, such as port and direct injectors. In even another embodiment, different sized injectors, in addition to different locations and different fuels, may be used.</p>
<p id="p-0044" num="0043">As will be described in more detail below, various advantageous results may be obtained by various of the above systems. For example, when using both gasoline and a fuel having alcohol (e.g., ethanol), it may be possible to adjust the relative amounts of the fuels to take advantage of the increased charge cooling of alcohol fuels (e.g., via direct injection) to reduce the tendency of knock. This phenomenon, combined with increased compression ratio, and/or boosting and/or engine downsizing, can then be used to obtain large fuel economy benefits (by reducing the knock limitations on the engine).</p>
<p id="p-0045" num="0044"><figref idref="DRAWINGS">FIG. 2</figref> shows one example fuel system with two fuel injectors per cylinder, for at least one cylinder. Further, each cylinder may have two fuel injectors. The two injectors may be configured in various locations, such as two port injectors, one port injector and one direct injector (as shown in <figref idref="DRAWINGS">FIG. 2</figref>), or others.</p>
<p id="p-0046" num="0045">Also, as described herein, there are various configurations of the cylinders, fuel injectors, and exhaust system, as well as various configuration for the fuel vapor purging system and exhaust gas oxygen sensor locations.</p>
<p id="p-0047" num="0046">Continuing with <figref idref="DRAWINGS">FIG. 2</figref>, it shows a dual injection system, where engine <b>10</b> has both direct and port fuel injection, as well as spark ignition. Internal combustion engine <b>10</b>, comprising a plurality of combustion chambers, is controlled by electronic engine controller <b>12</b>. Combustion chamber <b>30</b> of engine <b>10</b> is shown including combustion chamber walls <b>32</b> with piston <b>36</b> positioned therein and connected to crankshaft <b>40</b>. A starter motor (not shown) may be coupled to crankshaft <b>40</b> via a flywheel (not shown), or alternatively direct engine starting may be used.</p>
<p id="p-0048" num="0047">In one particular example, piston <b>36</b> may include a recess or bowl (not shown) to help in forming stratified charges of air and fuel, if desired. However, in an alternative embodiment, a flat piston may be used.</p>
<p id="p-0049" num="0048">Combustion chamber, or cylinder, <b>30</b> is shown communicating with intake manifold <b>44</b> and exhaust manifold <b>48</b> via respective intake valves <b>52</b><i>a </i>and <b>52</b><i>b </i>(not shown), and exhaust valves <b>54</b><i>a </i>and <b>54</b><i>b </i>(not shown). Thus, while four valves per cylinder may be used, in another example, a single intake and single exhaust valve per cylinder may also be used. In still another example, two intake valves and one exhaust valve per cylinder may be used.</p>
<p id="p-0050" num="0049">Combustion chamber <b>30</b> can have a compression ratio, which is the ratio of volumes when piston <b>36</b> is at bottom center to top center. In one example, the compression ratio may be approximately 9:1. However, in some examples where different fuels are used, the compression ratio may be increased. For example, it may be between 10:1 and 11:1 or 11:1 and 12:1, or greater.</p>
<p id="p-0051" num="0050">Fuel injector <b>66</b>A is shown directly coupled to combustion chamber <b>30</b> for delivering injected fuel directly therein in proportion to the pulse width of signal dfpw received from controller <b>12</b> via electronic driver <b>68</b>. While <figref idref="DRAWINGS">FIG. 2</figref> shows injector <b>66</b>A as a side injector, it may also be located overhead of the piston, such as near the position of spark plug <b>92</b>. Such a position may improve mixing and combustion due to the lower volatility of some alcohol based fuels. Alternatively, the injector may be located overhead and near the intake valve to improve mixing.</p>
<p id="p-0052" num="0051">Fuel may be delivered to fuel injector <b>66</b>A by a high pressure fuel system (not shown) including a fuel tank, fuel pumps, and a fuel rail. Alternatively, fuel may be delivered by a single stage fuel pump at lower pressure, in which case the timing of the direct fuel injection may be more limited during the compression stroke than if a high pressure fuel system is used. Further, while not shown, the fuel tank (or tanks) may (each) have a pressure transducer providing a signal to controller <b>12</b>.</p>
<p id="p-0053" num="0052">Fuel injector <b>66</b>B is shown coupled to intake manifold <b>44</b>, rather than directly to cylinder <b>30</b>. Fuel injector <b>66</b>B delivers injected fuel in proportion to the pulse width of signal pfpw received from controller <b>12</b> via electronic driver <b>68</b>. Note that a single driver <b>68</b> may be used for both fuel injection systems, or multiple drivers may be used. Fuel system <b>164</b> is also shown in schematic form delivering vapors to intake manifold <b>44</b>. Various fuel systems and fuel vapor purge systems may be used, such as those described below herein with regard to <figref idref="DRAWINGS">FIGS. 8-10</figref>, for example.</p>
<p id="p-0054" num="0053">Intake manifold <b>44</b> is shown communicating with throttle body <b>58</b> via throttle plate <b>62</b>. In this particular example, throttle plate <b>62</b> is coupled to electric motor <b>94</b> so that the position of elliptical throttle plate <b>62</b> is controlled by controller <b>12</b> via electric motor <b>94</b>. This configuration may be referred to as electronic throttle control (ETC), which can also be utilized during idle speed control. In an alternative embodiment (not shown), a bypass air passageway is arranged in parallel with throttle plate <b>62</b> to control inducted airflow during idle speed control via an idle control by-pass valve positioned within the air passageway.</p>
<p id="p-0055" num="0054">Exhaust gas sensor <b>76</b> is shown coupled to exhaust manifold <b>48</b> upstream of catalytic converter <b>70</b> (where sensor <b>76</b> can correspond to various different sensors). For example, sensor <b>76</b> may be any of many known sensors for providing an indication of exhaust gas air/fuel ratio such as a linear oxygen sensor, a UEGO, a two-state oxygen sensor, an EGO, a HEGO, or an HC or CO sensor. In this particular example, sensor <b>76</b> is a two-state oxygen sensor that provides signal EGO to controller <b>12</b> which converts signal EGO into two-state signal EGOS. A high voltage state of signal EGOS indicates exhaust gases are rich of stoichiometry and a low voltage state of signal EGOS indicates exhaust gases are lean of stoichiometry. Signal EGOS may be used to advantage during feedback air/fuel control to maintain average air/fuel at stoichiometry during a stoichiometric homogeneous mode of operation. Further details of air-fuel ratio control are included herein.</p>
<p id="p-0056" num="0055">Distributorless ignition system <b>88</b> provides ignition spark to combustion chamber <b>30</b> via spark plug <b>92</b> in response to spark advance signal SA from controller <b>12</b>.</p>
<p id="p-0057" num="0056">Controller <b>12</b> may cause combustion chamber <b>30</b> to operate in a variety of combustion modes, including a homogeneous air/fuel mode and a stratified air/fuel mode by controlling injection timing, injection amounts, spray patterns, etc. Further, combined stratified and homogenous mixtures may be formed in the chamber. In one example, stratified layers may be formed by operating injector <b>66</b>A during a compression stroke. In another example, a homogenous mixture may be formed by operating one or both of injectors <b>66</b>A and <b>66</b>B during an intake stroke (which may be open valve injection). In yet another example, a homogenous mixture may be formed by operating one or both of injectors <b>66</b>A and <b>66</b>B before an intake stroke (which may be closed valve injection). In still other examples, multiple injections from one or both of injectors <b>66</b>A and <b>66</b>B may be used during one or more strokes (e.g., intake, compression, exhaust, etc.). Even further examples may be where different injection timings and mixture formations are used under different conditions, as described below.</p>
<p id="p-0058" num="0057">Controller <b>12</b> can control the amount of fuel delivered by fuel injectors <b>66</b>A and <b>66</b>B so that the homogeneous, stratified, or combined homogenous/stratified air/fuel mixture in chamber <b>30</b> can be selected to be at stoichiometry, a value rich of stoichiometry, or a value lean of stoichiometry.</p>
<p id="p-0059" num="0058">Emission control device <b>72</b> is shown positioned downstream of catalytic converter <b>70</b>. Emission control device <b>72</b> may be a three-way catalyst or a NOx trap, or combinations thereof.</p>
<p id="p-0060" num="0059">Controller <b>12</b> is shown as a microcomputer, including microprocessor unit <b>102</b>, input/output ports <b>104</b>, an electronic storage medium for executable programs and calibration values shown as read only memory chip <b>106</b> in this particular example, random access memory <b>108</b>, keep alive memory <b>110</b>, and a conventional data bus. Controller <b>12</b> is shown receiving various signals from sensors coupled to engine <b>10</b>, in addition to those signals previously discussed, including measurement of inducted mass air flow (MAF) from mass air flow sensor <b>100</b> coupled to throttle body <b>58</b>; engine coolant temperature (ECT) from temperature sensor <b>112</b> coupled to cooling sleeve <b>114</b>; a profile ignition pickup signal (PIP) from Hall effect sensor <b>118</b> coupled to crankshaft <b>40</b>; and throttle position TP from throttle position sensor <b>120</b>; absolute Manifold Pressure Signal MAP from sensor <b>122</b>; an indication of knock from knock sensor <b>182</b>; and an indication of absolute or relative ambient humidity from sensor <b>180</b>. Engine speed signal RPM is generated by controller <b>12</b> from signal PIP in a conventional manner and manifold pressure signal MAP from a manifold pressure sensor provides an indication of vacuum, or pressure, in the intake manifold. During stoichiometric operation, this sensor can give an indication of engine load. Further, this sensor, along with engine speed, can provide an estimate of charge (including air) inducted into the cylinder. In a one example, sensor <b>118</b>, which is also used as an engine speed sensor, produces a predetermined number of equally spaced pulses every revolution of the crankshaft.</p>
<p id="p-0061" num="0060">In this particular example, temperature Tcat<b>1</b> of catalytic converter <b>70</b> is provided by temperature sensor <b>124</b> and temperature Tcat<b>2</b> of emission control device <b>72</b> is provided by temperature sensor <b>126</b>. In an alternate embodiment, temperature Tcat<b>1</b> and temperature Tcat<b>2</b> may be inferred from engine operation.</p>
<p id="p-0062" num="0061">Continuing with <figref idref="DRAWINGS">FIG. 2</figref>, a variable camshaft timing system is shown. Specifically, camshaft <b>130</b> of engine <b>10</b> is shown communicating with rocker arms <b>132</b> and <b>134</b> for actuating intake valves <b>52</b><i>a</i>, <b>52</b><i>b </i>and exhaust valves <b>54</b><i>a</i>, <b>54</b><i>b</i>. Camshaft <b>130</b> is directly coupled to housing <b>136</b>. Housing <b>136</b> forms a toothed wheel having a plurality of teeth <b>138</b>. Housing <b>136</b> is hydraulically coupled to crankshaft <b>40</b> via a timing chain or belt (not shown). Therefore, housing <b>136</b> and camshaft <b>130</b> rotate at a speed substantially equivalent to the crankshaft. However, by manipulation of the hydraulic coupling as will be described later herein, the relative position of camshaft <b>130</b> to crankshaft <b>40</b> can be varied by hydraulic pressures in advance chamber <b>142</b> and retard chamber <b>144</b>. By allowing high pressure hydraulic fluid to enter advance chamber <b>142</b>, the relative relationship between camshaft <b>130</b> and crankshaft <b>40</b> is advanced. Thus, intake valves <b>52</b><i>a</i>, <b>52</b><i>b </i>and exhaust valves <b>54</b><i>a</i>, <b>54</b><i>b </i>open and close at a time earlier than normal relative to crankshaft <b>40</b>. Similarly, by allowing high pressure hydraulic fluid to enter retard chamber <b>144</b>, the relative relationship between camshaft <b>130</b> and crankshaft <b>40</b> is retarded. Thus, intake valves <b>52</b><i>a</i>, <b>52</b><i>b</i>, and exhaust valves <b>54</b><i>a</i>, <b>54</b><i>b </i>open and close at a time later than normal relative to crankshaft <b>40</b>.</p>
<p id="p-0063" num="0062">While this example shows a system in which the intake and exhaust valve timing are controlled concurrently, variable intake cam timing, variable exhaust cam timing, dual independent variable cam timing, or fixed cam timing may be used. Further, variable valve lift may also be used. Further, camshaft profile switching may be used to provide different cam profiles under different operating conditions. Further still, the valvetrain may be roller finger follower, direct acting mechanical bucket, electromechanical, electrohydraulic, or other alternatives to rocker arms.</p>
<p id="p-0064" num="0063">Continuing with the variable cam timing system, teeth <b>138</b>, being coupled to housing <b>136</b> and camshaft <b>130</b>, allow for measurement of relative cam position via cam timing sensor <b>150</b> providing signal VCT to controller <b>12</b>. Teeth <b>1</b>, <b>2</b>, <b>3</b>, and <b>4</b> are preferably used for measurement of cam timing and are equally spaced (for example, in a V-8 dual bank engine, spaced 90 degrees apart from one another) while tooth <b>5</b> is preferably used for cylinder identification, as described later herein. In addition, controller <b>12</b> sends control signals (LACT, RACT) to conventional solenoid valves (not shown) to control the flow of hydraulic fluid either into advance chamber <b>142</b>, retard chamber <b>144</b>, or neither.</p>
<p id="p-0065" num="0064">Relative cam timing can be measured in a variety of ways. In general terms, the time, or rotation angle, between the rising edge of the PIP signal and receiving a signal from one of the plurality of teeth <b>138</b> on housing <b>136</b> gives a measure of the relative cam timing. For the particular example of a V-8 engine, with two cylinder banks and a five-toothed wheel, a measure of cam timing for a particular bank is received four times per revolution, with the extra signal used for cylinder identification.</p>
<p id="p-0066" num="0065">Sensor <b>160</b> may also provide an indication of oxygen concentration in the exhaust gas via signal <b>162</b>, which provides controller <b>12</b> a voltage indicative of the O2 concentration. For example, sensor <b>160</b> can be a HEGO, UEGO, EGO, or other type of exhaust gas sensor. Also note that, as described above with regard to sensor <b>76</b>, sensor <b>160</b> can correspond to various different sensors.</p>
<p id="p-0067" num="0066">As described above, <figref idref="DRAWINGS">FIG. 2</figref> merely shows one cylinder of a multi-cylinder engine, and that each cylinder has its own set of intake/exhaust valves, fuel injectors, spark plugs, etc.</p>
<p id="p-0068" num="0067">Also, in the example embodiments described herein, the engine may be coupled to a starter motor (not shown) for starting the engine. The starter motor may be powered when the driver turns a key in the ignition switch on the steering column, for example. The starter is disengaged after engine starting, for example, by engine <b>10</b> reaching a predetermined speed after a predetermined time. Further, in the disclosed embodiments, an exhaust gas recirculation (EGR) system may be used to route a desired portion of exhaust gas from exhaust manifold <b>48</b> to intake manifold <b>44</b> via an EGR valve (not shown). Alternatively, a portion of combustion gases may be retained in the combustion chambers by controlling exhaust valve timing.</p>
<p id="p-0069" num="0068">As noted above, engine <b>10</b> may operate in various modes, including lean operation, rich operation, and &#x201c;near stoichiometric&#x201d; operation. &#x201c;Near stoichiometric&#x201d; operation can refer to oscillatory operation around the stoichiometric air fuel ratio. Typically, this oscillatory operation is governed by feedback from exhaust gas oxygen sensors. In this near stoichiometric operating mode, the engine may be operated within approximately one air-fuel ratio of the stoichiometric air-fuel ratio. This oscillatory operation is typically on the order of 1 Hz, but can vary faster and slower than 1 Hz. Further, the amplitude of the oscillations are typically within 1 a/f ratio of stoichiometry, but can be greater than 1 a/f ratio under various operating conditions. Note that this oscillation does not have to be symmetrical in amplitude or time. Further note that an air-fuel bias can be included, where the bias is adjusted slightly lean, or rich, of stoichiometry (e.g., within 1 a/f ratio of stoichiometry). Also note that this bias and the lean and rich oscillations can be governed by an estimate of the amount of oxygen stored in upstream and/or downstream three way catalysts.</p>
<p id="p-0070" num="0069">As described below, feedback air-fuel ratio control is used for providing the near stoichiometric operation. Further, feedback from exhaust gas oxygen sensors can be used for controlling air-fuel ratio during lean and during rich operation. In particular, a switching type, heated exhaust gas oxygen sensor (HEGO) can be used for stoichiometric air-fuel ratio control by controlling fuel injected (or additional air via throttle or VCT) based on feedback from the HEGO sensor and the desired air-fuel ratio. Further, a UEGO sensor (which provides a substantially linear output versus exhaust air-fuel ratio) can be used for controlling air-fuel ratio during lean, rich, and stoichiometric operation. In this case, fuel injection (or additional air via throttle or VCT) can be adjusted based on a desired air-fuel ratio and the air-fuel ratio from the sensor. Further still, individual cylinder air-fuel ratio control could be used, if desired. As described in more detail below, adjustments may be made with injector <b>66</b>A, <b>66</b>B, or combinations therefore depending on various factors.</p>
<p id="p-0071" num="0070">Also note that various methods can be used to maintain the desired torque such as, for example, adjusting ignition timing, throttle position, variable cam timing position, exhaust gas recirculation amount, and number of cylinders carrying out combustion. Further, these variables can be individually adjusted for each cylinder to maintain cylinder balance among all the cylinders.</p>
<p id="p-0072" num="0071">Referring now to <figref idref="DRAWINGS">FIG. 3</figref>, an example engine <b>10</b> is shown with four in-line cylinders. In one embodiment, engine <b>10</b> may have a turbocharger <b>319</b>, which has a turbine <b>319</b><i>a </i>coupled in the exhaust manifold <b>48</b> and a compressor <b>319</b><i>b </i>coupled in the intake manifold <b>44</b>. While <figref idref="DRAWINGS">FIG. 3</figref> does not show an intercooler, one may optionally be used. Turbine <b>319</b><i>a </i>is typically coupled to compressor <b>319</b><i>b </i>via a drive shaft <b>315</b>. Various types of turbochargers and arrangements may be used. For example, a variable geometry turbocharger (VGT) may be used where the geometry of the turbine and/or compressor may be varied during engine operation by controller <b>12</b>. Alternately, or in addition, a variable nozzle turbocharger (VNT) may be used when a variable area nozzle is placed upstream and/or downstream of the turbine in the exhaust line (and/or upstream or downstream of the compressor in the intake line) for varying the effective expansion or compression of gasses through the turbocharger. Still other approaches may be used for varying expansion in the exhaust, such as a waste gate valve. <figref idref="DRAWINGS">FIG. 3</figref> shows an example bypass valve <b>320</b> around turbine <b>319</b><i>a </i>and an example bypass valve <b>322</b> around compressor <b>319</b><i>b</i>, where each valve may be controller via controller <b>12</b>. As noted above, the valves may be located within the turbine or compressor, or may be a variable nozzle.</p>
<p id="p-0073" num="0072">Also, a twin turbocharger arrangement, and/or a sequential turbocharger arrangement, may be used if desired. In the case of multiple adjustable turbocharger and/or stages, it may be desirable to vary a relative amount of expansion though the turbocharger, depending on operating conditions (e.g. manifold pressure, airflow, engine speed, etc.). Further, a supercharger may be used, if desired.</p>
<p id="p-0074" num="0073">Referring now to <figref idref="DRAWINGS">FIG. 4</figref>, an alternative embodiment of engine <b>10</b> is shown with two port fuel injectors per cylinder for cylinders with three or more valves (e.g., two or more intake valves, such as a 3-valve engine or a 4-valve engine). Even though this example utilizes port injection, it may still be possible to exploit increased charge cooling effects of various fuels (such as ethanol, gasoline, mixtures thereof, etc). For example, in some cases, port injection can attain some charge cooling benefits at wide-open throttle conditions by using open valve injection (OVI). However, since an additional injector is supplied, the wide-open throttle OVI benefit may not be reduced by the need to design single port-injector systems to satisfy other constraints, such as: control at low fuel flows, cold start fuel behavior, and transient fuel behavior (usually with closed-valve injection). Thus, by using two fuel injectors it is possible to better exploit open valve injection, while still retaining desired functionality during various operating conditions.</p>
<p id="p-0075" num="0074">As one example, since two injectors are used, they may each be designed with smaller valve flows/openings so that under low load conditions it may be possible to provide more accurate quantity control (e.g., by using only one of the injectors).</p>
<p id="p-0076" num="0075">As another example, when using different fuels for two the injectors (e.g., one injecting gasoline and one injecting a fuel having an alcohol component, such as ethanol or E85) many of the above system constraints can be satisfied. For example, by using separate port injectors for fuels with alcohol (e.g., ethanol) and gasoline, and using the alcohol injector at higher loads when the engine is warmed up, some of the constraints at low fuel flow and cold start are avoided for the alcohol injector. Further, if the alcohol injector is operated with OVI timing, or at least partial OVI timing, then transient fuel problems may also be reduced for the ethanol injector.</p>
<p id="p-0077" num="0076">Additionally, using OVI timing (at least under some conditions) allows the alcohol injector spray pattern and targeting to be optimized for OVI. The spray could be much narrower angle than for the gasoline port injector, to increase the probability that most of the fuel enters the cylinder as a liquid, instead of evaporating from intake port and intake valve metal surfaces. This would increase the evaporative cooling benefit in a manner similar to direct injection. Also, the injector targeting may be selected to reduce bore wash issues, in which liquid fuel washes oil off cylinder walls, potentially causing excessive wear.</p>
<p id="p-0078" num="0077">In this way, in some cases, it may be possible to achieve advantageous results without requiring direct injection. For example, by using two port fuel injectors per cylinder it may be possible to reduce system cost, reduce required fuel rail pressure (high fuel rail pressure can reduce fuel economy due to parasitic losses of the fuel pump), and reduce packaging issues (direct injection may require compromised valve sizes and/or angles, intake or exhaust port shapes, etc.).</p>
<p id="p-0079" num="0078">Specifically, <figref idref="DRAWINGS">FIG. 4</figref> shows a cylinder <b>430</b> with two intake ports <b>446</b><i>a </i>and <b>446</b><i>b </i>of intake manifold <b>444</b> coupled respectively to intake valves <b>452</b><i>a </i>and <b>452</b><i>b</i>. A first injector <b>466</b>A is coupled in port <b>446</b><i>a</i>, and a second injector <b>466</b>B is coupled in port <b>446</b><i>b</i>. If desired, valve <b>424</b> may be used to deactivate port <b>446</b><i>a </i>under selected engine speed, load, and/or temperature conditions. Alternatively, a charge motion control valve may be used, if desired.</p>
<p id="p-0080" num="0079">While <figref idref="DRAWINGS">FIG. 4</figref> shows injector <b>466</b><i>a </i>downstream of valve <b>424</b>, it may also be placed upstream of valve <b>424</b> in an alternative embodiment.</p>
<p id="p-0081" num="0080">In one embodiment, injector <b>466</b>A injects a fuel having alcohol, such as ethanol, methanol, or a mixture of gasoline with an alcohol (e.g., E85, M85, or other such blends and ratios), while injector <b>466</b>B injects gasoline. The gasoline injection may be performed at least partially during conditions when valve <b>452</b><i>b </i>is open. Alternatively, gasoline injection from injector <b>466</b>B may be performed at least partially during conditions when valve <b>452</b><i>b </i>is closed. In still another example, gasoline injection from injector <b>466</b>B may be performed at least partially during conditions when valve <b>452</b><i>b </i>is closed and at least partially during conditions when valve <b>452</b><i>b </i>is open. In yet another example, under some conditions open valve injection may be used while in other conditions closed valve injection may be used. Thus, the two injectors may be of a different type due to physical location, type of substance being injected, operating strategy, etc.</p>
<p id="p-0082" num="0081">In one example, the valve <b>424</b> may be adjusted to reduce airflow (i.e., made more closed) under lower engine load conditions where fuel is primarily provided by injector <b>466</b>B. While a single valve is shown, multiple valves may be used if desired. Also, each cylinder may have such a valve, and each of such valves may be controlled by a single actuation. In this way, it is possible to position a valve to obtain the desired flow for the injectors that are active under different conditions.</p>
<p id="p-0083" num="0082">Referring now to <figref idref="DRAWINGS">FIG. 5</figref>, it shows a cylinder <b>530</b> with a single intake port <b>546</b> of intake manifold <b>544</b> coupled respectively to intake valves <b>552</b><i>a </i>and <b>552</b><i>b</i>. A first injector <b>566</b>A and a second injector <b>566</b>B are coupled to port <b>546</b>. If desired, valve <b>524</b> may be a charge motion control valve which restricts flow around injector <b>566</b>A to a greater extent than injector <b>566</b>B under selected engine speed, load, and/or temperature conditions. Again, injector <b>566</b>A injects a fuel having alcohol, such as ethanol, methanol, or a mixture of gasoline with an alcohol (e.g., E85, M85, or other such blends and ratios), while injector <b>566</b>B injects gasoline. Thus, the two injectors may be of a different type due to physical location, type of substance being injected, mixture of substance being injected, heat of vaporization of substance being injected, or operating strategy, etc.</p>
<p id="p-0084" num="0083"><figref idref="DRAWINGS">FIG. 5</figref> shows valve <b>524</b> being an elliptical valve with an asymmetric notch <b>530</b> removed from the plate. The notch provides airflow near injector <b>566</b>B whether the valve is open, closed, or partially open/closed, yet can restrict airflow to a greater extent near injector <b>566</b>A. The valve rotates about an axis <b>532</b> in response to actuation by controller <b>12</b>.</p>
<p id="p-0085" num="0084">By adjusting valve <b>424</b> (or <b>524</b>), it is possible to take advantage of the fact that at high loads, both ethanol injection and open (or partially open) valve operation provide improved performance. At lower loads, the valve(s) may be closed (or partially closed), and the gasoline injector can spray fuel into the active intake port, and the ethanol injector may be deactivated. At higher loads, the valve would be open or partially open, and ethanol could be injected into one port while gasoline is injected into the other port.</p>
<p id="p-0086" num="0085">Further, by using different operation of the two port injectors (e.g., different timing, different fuels, different injectors for a cylinder, etc.) it is possible to reduce a compromise between package-space and air/fuel mixing. Further, it allows one injector to be placed in each intake port, and ensures that fuel can always be supplied to a port that is flowing air. By reducing airflow in a port when the injector is not injecting fuel, it is possible to maintain acceptable air-fuel mixing in the other port that is flowing air with injected fuel. Further, such an approach may provide improved packaging compared with twin-spray injectors that may require a more central injector location between the ports, making it more difficult to package two injectors per cylinder.</p>
<p id="p-0087" num="0086">Referring now to <figref idref="DRAWINGS">FIG. 6</figref>, two fuel injectors are shown (<b>610</b> and <b>612</b>) with at least one different characteristic. Injector <b>610</b> may be used as injector <b>66</b>A, <b>466</b>A, <b>566</b>A, etc., while injector <b>612</b> may be used as injector <b>66</b>B, <b>466</b>B, <b>566</b>B, or vice versa, or combinations thereof, etc. The differing characteristic(s) between the injectors may be one or more of the following: injector size, injector dynamic range, materials, minimum pulse width, injector slope (flow to pulse width), orifice size, spray pattern, spray pattern area, spray targeting, or others as discussed herein.</p>
<p id="p-0088" num="0087">In one example, both injectors are sized to meet peak torque requirements (for example a maximum airflow or aircharge). However, in an example where one injector provides gasoline and the other injector provides an alcohol blend (e.g., ethanol, E85, methanol, etc.), the power densities of the fuels may be different. In such a case, the injector for the alcohol based fuel may be sized to provide a different maximum fuel flow (e.g., approximately 37% higher to account for pure ethanol).</p>
<p id="p-0089" num="0088">Referring now specifically to <figref idref="DRAWINGS">FIG. 6</figref>, injector <b>610</b>, which may be a direct cylinder injector or a port injector, is shown receiving a command signal <b>620</b> from controller <b>12</b>. Pressurized fuel is supplied to inlet <b>622</b>, the flow of which is governed by an electromagnetic actuator having coil <b>624</b>, coupled to needle <b>626</b> cooperating with pintle <b>628</b>. The shape of pintle <b>628</b> may affect the spray geometry as well as the flow rate of the injector. Further, the size and shape of the needle may also affect flow and spray patterns, as well as response time.</p>
<p id="p-0090" num="0089"><figref idref="DRAWINGS">FIG. 6</figref> also shows injector <b>612</b>, with similarly labeled components, including a command signal <b>630</b>, inlet <b>632</b>, coil <b>634</b>, needle <b>636</b>, and pintle <b>638</b>. As noted above, the pintles <b>628</b> and <b>638</b> may different in size, shape, material, or combinations thereof. Further, inlets <b>622</b>/<b>632</b>, coils <b>624</b>/<b>634</b>, and/or needles <b>626</b>/<b>636</b> may have different geometry, shapes, sizes, materials, weights, surface finishes, etc.</p>
<p id="p-0091" num="0090">In this way, the respective injectors may be designed to provide different functionality and/or injection type (e.g., fuel type) compatibility so that improved engine operation and control may be achieved. As noted herein, an injection type may refer to different injection locations, different substances being injected (e.g., water vs. fuel), different fuel types being injected, different fuel blends being injected, different alcohol contents being injected (e.g., 0% vs. 85%), etc. Further note that different injection types may also refer to different substances being injected via a common injector, where a type 1 injection may be a gasoline amount in the injection and type 2 injection may be an alcohol amount in the injection.</p>
<p id="p-0092" num="0091">Referring now to <figref idref="DRAWINGS">FIGS. 7-10</figref>, various fuel and vapor handling systems are described. Specifically, <figref idref="DRAWINGS">FIG. 7</figref> shows an example fuel pump configuration, while <figref idref="DRAWINGS">FIGS. 8-10</figref> show various fuel vapor purge system configurations.</p>
<p id="p-0093" num="0092">Referring now specifically to <figref idref="DRAWINGS">FIG. 7</figref>, an example fuel pump configuration is shown where a separate fuel pump and tank is provided for a first and second fuel type. Specifically, a first tank <b>710</b> is shown for holding liquid fuel of a first type, with pump <b>712</b> leading to injector <b>66</b>A via fuel rail <b>714</b>. Likewise, a second tank <b>720</b> is shown for holding liquid fuel of a second type, with pump <b>722</b> leading to injector <b>66</b>B via fuel rail <b>724</b>. While the pumps are shown outside the tank, in an alternative example one or both of the pumps may be located within the tank. Further, a second, high pressure fuel pump may be added to one or both the fuel lines downstream of respective low pressure pumps.</p>
<p id="p-0094" num="0093">One or both the fuel systems may be return-less-type fuel systems, return-type fuel systems, or combinations thereof. Further, the fuel systems may have different characteristics, such as different size tanks, different size pump, different pump capacity, different pump pressure, different pump maximum flows, different on/off cycles (e.g., pump <b>712</b> may run more intermittently than pump <b>722</b>), etc. Note that in some examples, only one pump may operate under some conditions. For example, if fuel from tank <b>710</b> is not needed, or not enabled (e.g., during cold start conditions), pump <b>712</b> may be deactivated (or not activated) while pump <b>722</b> operates. In this way, less battery power may be used, and less vapors may be generated.</p>
<p id="p-0095" num="0094">In one example, the first tank contains an alcohol blend, such as ethanol or an ethanol-gasoline mixture, while the second tank contains gasoline. However, other fuel types may also be used.</p>
<p id="p-0096" num="0095">Referring now specifically to <figref idref="DRAWINGS">FIGS. 8-10</figref>, example fuel purging system configurations are described in cases where two different fuel sources are provided, which may be in engines having two injectors per cylinder (e.g., a port injector and a direct injector, or two port injectors). As noted above, one fuel may be gasoline, where a second fuel may be an alcohol or an alcohol blend. In such a case, the fuels may have different volatility, vaporization, etc., which may be used to advantage.</p>
<p id="p-0097" num="0096">One example embodiment is shown in <figref idref="DRAWINGS">FIG. 8</figref>, in which a first tank <b>810</b> may be used for a first fuel (e.g., gasoline) and tank <b>812</b> may be used for a second fuel (e.g., ethanol). The tanks may be separate (as shown) or integrally formed. Further, the size or volume of the tanks may be different, for example tank <b>812</b> may be substantially smaller than tank <b>810</b>. In <figref idref="DRAWINGS">FIG. 8</figref>, tank <b>810</b> has a vapor conduit <b>820</b>, tank <b>812</b> has a vapor conduit <b>822</b>, both leading to junction <b>830</b>. Junction <b>830</b> leads to canister <b>814</b> (which can have a check valve venting to the atmosphere). Junction <b>830</b> may have a parallel conduit <b>826</b> leading to vapor management valve <b>816</b>, which controls vapor flow to engine <b>10</b> (via intake manifold <b>44</b>, for example). In this way it is possible to enable vapor from both tanks (or tank sections) to the engine using a single canister and a single vapor control valve (although more canisters and/or valves may be used if desired).</p>
<p id="p-0098" num="0097">However, one fuel may be more volatile than another fuel (for example, 10% vaporization occurs at approximately 100 deg F. for gasoline vs. 160 deg F. for 85% ethanol). Thus, in this example, when tank <b>812</b> fuel level is low, the total vapor volume (ullage space) of the system may be relatively high, which can make vapor control more difficult. Also, fuel from one tank may mix with a different fuel in the other tank (e.g., contaminating the ethanol tank with excessive amounts of gasoline due to evaporation from the gasoline tank and condensation in the ethanol tank). Some of the above issues may be reduced by making the sizes of conduits <b>820</b> and <b>822</b> relatively differently sized, for example.</p>
<p id="p-0099" num="0098">Another approach that may be used is shown in <figref idref="DRAWINGS">FIG. 9</figref>. In this example, first tank <b>910</b> may be used for a first fuel (e.g., gasoline) and tank <b>912</b> may be used for a second fuel (e.g., ethanol). The tanks may be separate (as shown) or integrally formed. Further, the size or volume of the tanks may be different, for example tank <b>912</b> may be substantially smaller than tank <b>910</b>. In the example of <figref idref="DRAWINGS">FIG. 9</figref>, separate canister systems (e.g., canisters <b>914</b> and <b>916</b>) may be used for each of tanks <b>910</b> and <b>912</b>. Specifically, tank <b>910</b> has a vapor conduit <b>920</b> leading to junction <b>930</b>, which is coupled to conduit <b>928</b> leading to canister <b>914</b> (which then vents to atmosphere via a check valve). Further, tank <b>912</b> has a conduit <b>922</b> which leads to junction <b>932</b>, which then may lead to canister <b>916</b> via conduit <b>924</b>. Junction <b>930</b> also leads to a first valve <b>940</b> via conduit <b>934</b>, while junction <b>932</b> may lead to a second valve <b>942</b> via conduit <b>926</b>. Each of valves <b>940</b> and <b>942</b> are coupled to junction <b>946</b>, which then leads to intake manifold <b>44</b> of the engine <b>10</b>. Alternatively, each of valves <b>940</b> and <b>942</b> may be directed separately to separate locations of the intake manifold. As above, additional canisters may be used, if desired. Further, canisters <b>914</b> and <b>916</b> may have different characteristics (e.g., size, charcoal loading, storage capacity, or others), and valves <b>940</b> and <b>942</b> may have different characteristics, such as sizes, mounting orientations, maximum flows, minimum flows, orifice areas, actuation mechanisms, etc. Valves <b>940</b> and <b>942</b> may be completely separate, or may be packaged together in a single housing.</p>
<p id="p-0100" num="0099">In this way, it is possible to enable vapor from both tanks (or tank sections) to the engine in controllable differential amounts while reducing contamination from one tank to another tank.</p>
<p id="p-0101" num="0100"><figref idref="DRAWINGS">FIG. 10</figref> shows still another alternative embodiment, which is similar to that of <figref idref="DRAWINGS">FIG. 9</figref>, yet a single vapor control valve is used, while maintaining separation between the two tanks (or tank sections). Specifically, in <figref idref="DRAWINGS">FIG. 10</figref>, tanks <b>1010</b> and <b>1012</b> are shown (which as noted above may have different characteristics and may be separately or integrally formed) along with canisters <b>1014</b> and <b>1016</b> (which also may have different characteristics). Tank <b>1010</b> is coupled to junction <b>1020</b> via conduit <b>1022</b> and canister <b>1014</b> is coupled to junction <b>1020</b> via conduit <b>1024</b> at a first outlet of the canister. A second outlet of the canister <b>1014</b> is coupled to junction <b>1026</b>, along with tank <b>1012</b> via conduit <b>1028</b> and canister <b>1016</b> via conduit <b>1030</b>. Further, junction <b>1020</b> leads to valve <b>1040</b>, which then directs flow to the engine intake manifold.</p>
<p id="p-0102" num="0101">In one example, a one-way check valve may be placed in line <b>1028</b> to reduce vapor flow from tank <b>1010</b> to tank <b>1012</b>. Further, such a valve may also be placed in line <b>1022</b>. However, the presence of canister <b>1014</b> may be sufficient to reduce flow of vapors from tank <b>1010</b> to tank <b>1012</b>, and vice versa.</p>
<p id="p-0103" num="0102">In this way, a single valve may be used (although more may be added if desired), yet the system provides at least some separation between the tanks via a canister (in this example, canister <b>1014</b>). Canister <b>1014</b> may be sized large enough to reduce the amount of a first fuel vapor (e.g., gasoline) that enters the tank <b>1012</b> to an acceptable level, and since it is in series with canister <b>1016</b>, this can enable canister <b>1014</b> to have a reduced size or capacity.</p>
<p id="p-0104" num="0103">In any of the examples herein with more than one canister, the canisters may be packaged in a single housing if desired.</p>
<p id="p-0105" num="0104">As will be described in more detail below, control of fuel vapors, adaptive learning, vapor concentration learning, vapor blend learning, along with air-fuel ratio, may be affected by the fuel system type and configuration. For example, in some examples vapors from one or more fuel source may be concurrently delivered to the engine, in varying amounts, and thus the controller may estimate the blend of the vapors (e.g., the percentage of alcohol in a gas/alcohol blend, for example) to determine stoichiometry of the vapors, etc., that can then be used to adjust fuel injection, etc.</p>
<p id="p-0106" num="0105">For example, under some conditions, purging of a first fuel type may be advantageous, and under other conditions, purging of a second fuel type may be advantageous. Further still, under still other conditions, both types may be concurrently purged. Factors that may influence which of these are selected may include, for example, the amount of fuel vapors of each being inducted. Thus, if the vapors contain mostly a fuel corresponding to a first injector, purging from that source may be given preference and continued for a longer period, or performed with a greater purge flow rate, for example. Alternatively, an estimated blend in the reservoirs(s) may influence which reservoir is purged (and how much volume from that source is purged). For example, some reservoirs may generate more vapors than other reservoirs, and thus need longer or more frequent, or higher volume, purging.</p>
<p id="p-0107" num="0106">Further, note that the desired/delivered amounts of type 1 and type 2 injection, or for example, the relative amount of type 1 to type 2 injection, may vary depending on the source of fuel vapors being inducted into the engine. Thus, the injection amounts may be varied based on the source of vapors, or based on whether any vapors are being inducted into the engine, or based on the concentration of vapors being inducted into the engine, and/or based on the blend of vapors being inducted into the engine.</p>
<p id="p-0108" num="0107">Referring now to <figref idref="DRAWINGS">FIG. 11</figref>, a routine is described for implementing adjustments in fuel injection amounts in response to feedback from an exhaust gas oxygen sensor (or other sources) to provide a desired overall air-fuel ratio. In particular, in cases where more than one injection type may be provided to a cylinder, the routine determines which type of fuel may be adjusted based on feedback. As used herein, different fuel or injection types may refer to different fuels (e.g., alcohol containing fuels vs. gasoline) or may refer to different injector locations (e.g., port vs. direct), or may be different sized injectors (e.g., one having higher maximum flow than the other), or may refer to other injection characteristics, fuel delivery characteristics, spray characteristics, fuel property characteristics (e.g., temperature, heat capacity, power density, etc.) or may refer to gasoline injection versus water injection, or others, or may refer to different fuel blends (where one fuel type has relatively more or less ethanol than another fuel type). Also, the fuel types may be separately delivered to the combustion chamber, or mixed before delivery to the combustion chamber.</p>
<p id="p-0109" num="0108">Specifically, in <b>1110</b>, the routine determines whether injection or delivery of fuel type 2 is enabled. As described in more detail herein, various factors may be used to determine whether to enable delivery or injection of fuel type 2, such as engine temperature, exhaust temperature, an amount of type 2 injection (e.g., fuel type) on-board (e.g., in a fuel tank), etc. If the answer to <b>1110</b> is yes, the routine continues to <b>1112</b> to determine if injection or delivery of fuel type 1 is enabled. Again, as described in more detail herein, various factors may be used to determine whether to enable delivery or injection of fuel type 1, such as engine temperature, exhaust temperature, an amount of type 1 injection (e.g., fuel type) on-board (e.g., in a fuel tank), etc. If the answer to <b>1112</b> is yes, the routine continues to <b>1114</b>, otherwise the routine continues to <b>1116</b>.</p>
<p id="p-0110" num="0109">When the answer to <b>1110</b> is no, the routine continues to <b>1118</b> where again the routine determines if injection or delivery of fuel type 1 is enabled. If not, the routine ends. Otherwise, the routine continues to <b>1120</b>.</p>
<p id="p-0111" num="0110">In <b>1114</b>, the routine selects a fuel type for adjustment as described below in more detail with regard to <figref idref="DRAWINGS">FIG. 12</figref>. For example, if type 1 is selected, the routine continues to <b>1120</b>, if type <b>2</b> is selected, the routine continues to <b>1116</b>, and if both fuel types are selected, the routine continues to <b>1122</b>. While the routine of <figref idref="DRAWINGS">FIG. 12</figref> considers factors such as a bandwidth of needed adjustments, minimum and maximum pulse width limits, and others, various other factors can influence which injectors are adjusted in response to feedback information, and/or relative amounts of adjustment between multiple injectors based on feedback information. In one embodiment where water is included in the type 2 injection (e.g., a water-alcohol or water-ethanol mix), adjustment of type 2 injection in response to air-fuel ratio errors becomes decreasingly effective as the water fraction in the mix increases. Thus, in such an embodiment, selection of type 2 injection adjustment to affect air-fuel ratio (e.g., in response to exhaust gas oxygen sensor feedback) may be stopped or disabled when the water fraction surpasses a limit, such as 0.7, for example, and thus all or most all of the adjustments can be made with a type 1 injection, such as gasoline injection. Another criteria that may be used in selecting injectors for feedback control may be based on how much fuel is in the respective tanks, and thus if one fuel is low, it may be not be increased in response to feedback to conserve that fuel.</p>
<p id="p-0112" num="0111">In <b>1116</b>, the routine adjusts fuel type 2 based on air-fuel ratio sensor feedback (see also <figref idref="DRAWINGS">FIG. 17</figref>). For example, a PI controller may be used to process an error signal (between a desired and measured air-fuel ratio) to generate a feedback correction to adjust an amount of injected or delivered fuel of fuel type 2. Note also that more than one sensor may be used to generate upstream and downstream feedback corrections.</p>
<p id="p-0113" num="0112">In <b>1120</b>, the routine adjusts fuel type 1 based on air-fuel ratio sensor feedback (see also <figref idref="DRAWINGS">FIG. 17</figref>). For example, a PI controller may be used to process an error signal (between a desired and measured air-fuel ratio) to generate a feedback correction to adjust an amount of injected or delivered fuel of fuel type 1. Again note that more than one sensor may be used to generate upstream and downstream feedback corrections.</p>
<p id="p-0114" num="0113">In <b>1122</b>, the routine adjusts both fuel type 1 and 2 based on air-fuel ratio sensor feedback (see also <figref idref="DRAWINGS">FIG. 17</figref>). For example, a PI controller may be used to process an error signal (between a desired and measured air-fuel ratio) to generate a feedback correction. The correction may then be divided into two parts, one to adjust an amount of injected or delivered fuel of fuel type 1, and another to adjust an amount of injected or delivered fuel of fuel type 2. Again note that more than one sensor may be used to generate upstream and downstream feedback corrections. Further, the upstream correction may be applied to fuel type 2 while the downstream correction may be applied to fuel type 1, or vice versa. In another example, lean corrections may be applied to fuel type 2 while rich corrections may be applied to fuel type 1, or vice versa to adjust a relative amount of fuel types. Also, greater corrections may be made with fuel type 1 under a first set of selected engine operating conditions, and greater corrections may be made with fuel type 2 under a second set of selected engine operating conditions.</p>
<p id="p-0115" num="0114">In this way, different fuel types (e.g., injection locations, fuel qualities, fuel densities, fuel heat capacities, etc.) may be used under different conditions and in different amounts to facilitate air-fuel feedback corrections depending on operating conditions.</p>
<p id="p-0116" num="0115">Referring now to <figref idref="DRAWINGS">FIG. 12</figref>, an example routine for selecting which fuel type to use for feedback adjustment of air-fuel ratio is described. As noted above, various factors may be considered, and while the routine described in <figref idref="DRAWINGS">FIG. 12</figref> shows some of these factors, others may also be added, or only some or none of the factors shown may be considered, if desired.</p>
<p id="p-0117" num="0116">In <b>1210</b>, the routine reads exhaust air-fuel ratio sensor information from one or more exhaust gas sensors. Then in <b>1212</b>, the routine calculates an amount and direction of correction or corrections. For example, a PI controller may be used, or multiple PI control loops may be used, such as based on upstream and downstream sensors. Then, in <b>1214</b>, the routine determines whether a high frequency adjustment is required in the amount of fuel delivered. For example, if a rapid (and possibly large) change in exhaust air-fuel ratio is encountered, it may be possible to more rapidly correct this error using type 2 injection (e.g., fuel type, such as when type 2 fuel is injected directly, or injected more closely to the cylinder, or if an injector for type 2 fuel has a higher bandwidth than an injector for type 1 fuel). If the answer to <b>1214</b> is yes, the routine continues to <b>1216</b> to select type 2 fuel adjustment and then ends.</p>
<p id="p-0118" num="0117">Otherwise, the routine continues to <b>1218</b> to determine if a corresponding pulse width (PW) of the injector for the type 1 injection is near a minimum PW value for the injector or a maximum PW for the injector. If so, the routine again proceeds to <b>1216</b>. If the answer to <b>1218</b> is no, the routine continues to <b>1220</b> to determine if a corresponding pulse width (PW) of the injector for the type 2 injection is near a minimum PW value for the injector or a maximum PW for the injector. If so, the routine proceeds to <b>1222</b> to select type 1 fuel for adjustment. If the answer to <b>1220</b> is no, the routine continues to <b>1224</b>.</p>
<p id="p-0119" num="0118">In <b>1224</b>, the routine determines whether conditions are present to adjust both fuel types based on feedback information. For example, it may be determined that higher frequency adjustments be made with type 2 injection (e.g., fuel type) adjustments and lower frequency adjustments be made with type 1 fuel adjustments. In this way, in the example where type 2 injection is direct fuel injection and type 1 injection is port fuel injection, wall wetting dynamic delays can be reduced. Alternatively, both fuels may be selected for adjustment, where a portion of the adjustment is made by each fuel type. This portion, which may be a percentage or other ratio, may be adjusted with engine operating conditions, fuel conditions, etc.</p>
<p id="p-0120" num="0119">If the answer to <b>1224</b> is yes, the routine continues to adjust both fuels in <b>1226</b>. Otherwise, the routine continues to <b>1228</b> to adjust fuel type 1.</p>
<p id="p-0121" num="0120">In this way, different fuel types can be used to provide air-fuel feedback control for different conditions so that overall operation is improved. For example, where port injection is used to control lower frequency feedback adjustments than direct injection, faster feedback control can be achieved while reducing wall wetting dynamics, and still utilizing feedback adjustment of both fuel types. Further, issues with minimum or maximum injector fueling can be addressed, while still maintaining accurate overall air-fuel ratio control.</p>
<p id="p-0122" num="0121">Referring now to <figref idref="DRAWINGS">FIG. 13</figref>, a first embodiment example starting routine is provided for enabling fuel types based on engine, vehicle, and/or ambient operating conditions. First, in <b>1310</b> the routine determines whether an engine start has occurred. For example, the routine can monitor engine speed, cranking motor, key-on operation, or various other parameters to identify an engine start. If the answer to <b>1310</b> is yes, the routine continues to <b>1312</b> to enable fuel type 1 delivery or injection. Then, the routine continues to <b>1314</b> to determine whether engine coolant temperature (ECT) is greater than a limit T<b>1</b>. If so, the routine continues to <b>1316</b> to determine whether catalyst temperature is greater than a limit T<b>2</b>. If so, the routine continues to <b>1318</b> to enable fuel type 2 delivery or injection. In this way, it is possible to utilize fuel type 1 for engine starting and/or engine warm-up, and avoid fuel type 2 until the engine and exhaust system have warmed, for cases where fuel type 2 is more difficult to vaporize, such as an alcohol containing fuel (e.g., ethanol or an ethanol blend), for example. As noted above, the fuel types may refer to different fuel blends, different injector locations, etc.</p>
<p id="p-0123" num="0122">While the above example relies on engine coolant temperature, various other parameters may be used, such as ambient air temperature, ambient pressure, oil temperature, etc. Likewise, various exhaust temperatures may be used, such as exhaust gas temperature, catalyst temperature, or estimates thereof. In this way, it is possible to provide an appropriate fuel for engine starting and/or warm-up. Further, the starting approaches herein may be used for re-starting, such as a hot-restart, a re-start after an unsuccessful start, starting after deceleration fuel shut-off, or starting an engine during rotation or from rest, such as with a hybrid vehicle (e.g., hybrid-electric vehicle).</p>
<p id="p-0124" num="0123">Referring now to <figref idref="DRAWINGS">FIGS. 14-15</figref>, a second embodiment for enabling fuel types is described that accounts for limiting some fuel types during engine warm-up/starting operation. In this embodiment, a warm-up strategy is described which can apply to various engine concepts using at least two fuel types, such as two PFI injectors per cylinder, one DI and one PFI injector per cylinder, or one ethanol blend injector and one gasoline injector, etc. In this way, engine control strategy can be included to prevent use of a fuel type (such as an ethanol blend) when the engine is too cold, and transition (gradually or abruptly) towards usage as the engine warms up. This can be done for at least the following reasons. (1) In the example where ethanol or an ethanol blend is used, such fuel can be less volatile than gasoline (e.g., 10% vaporization occurs at approximately 100 degrees F. for gasoline vs. 160 degrees F. for 85% ethanol). Attaining adequate vaporization and air-fuel mixing with ethanol may be difficult before the engine is warmed up. (2) Again, in the example where ethanol is used to avoid or reduce knock under selected conditions, the likelihood of knock is may be greatly reduced at cooler temperatures. Thus, it may be desirable, under some conditions, to minimize ethanol consumption when possible, to conserve it for times when knock is more likely.</p>
<p id="p-0125" num="0124">As will be described in more detail below, once the engine is warmed up, a desired ethanol fraction (EF), or other such parameter, can be determined as a function of speed and load as described, with additional logic for unusual ambient conditions, low fuel level of ethanol or gasoline, etc. The warmed-up desired ethanol fraction can then be modified with one or more multipliers (e.g., an overall multiplier EF_MUL) to account for cold start and warm-up.</p>
<p id="p-0126" num="0125">The value of EF_MUL can be in the range between zero and one during warm-up (values higher than one may be desired for higher-than-normal temperatures). The value of EF_MUL can be determined from a variety of inputs, including engine coolant temperature, engine oil temperature, ambient air temperature, engine intake air temperature, time since engine start, speed, load, available fuel pressure, ambient humidity, and other parameters. Each of these inputs could be measured or inferred. The value of EF_MUL can be continuously re-calculated during engine operation.</p>
<p id="p-0127" num="0126">Referring now specifically to <figref idref="DRAWINGS">FIG. 14</figref>, in <b>1410</b> the routine determines whether an engine start is present. Then, if so, in <b>1412</b> a time since engine start timer is reset to zero and starts counting. Likewise, a combustion event counter is reset to zero and starts counting combustion events from the start.</p>
<p id="p-0128" num="0127">From either <b>1412</b> or when the answer to <b>1410</b> is no, the routine continues to <b>1414</b>, <b>1416</b>, and <b>1418</b> to calculate individual multipliers for the type 2 injection using the calibration graphs of <figref idref="DRAWINGS">FIG. 15</figref>, which in one example is an ethanol or ethanol blend, or another alcohol containing blend. The routine then continues to step <b>1420</b>.</p>
<p id="p-0129" num="0128">In one embodiment of step <b>1420</b>, the routine determines a current value of the overall multiplier on a desired fuel type 2 fraction by multiplying the values of the separate multipliers for each input. In this method, the effects of the input variables can all be accounted for simultaneously, for example:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>EF_MUL=EF_MUL_ECT*EF_MUL_EOT*EF_MUL_AAT*EF_MUL_ACT*EF_MUL_ATMR1<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0130" num="0129">Where</p>
<p id="p-0131" num="0130">EF_MUL=Overall multiplier on desired ethanol fraction, EF_MUL_ECT=Multiplier as a function of engine coolant temperature, EF_MUL_EOT=Multiplier as a function of engine oil temperature, EF_MUL_AAT=Multiplier as a function of ambient air temperature, EF_MUL_ACT=Multiplier as a function of engine intake air temperature, EF_MUL_ATMR<b>1</b>=Multiplier as a function of time since engine start or number of combustion events since engine start.</p>
<p id="p-0132" num="0131">Example calibrations for these multipliers are illustrated in the top, middle, and bottom graphs of <figref idref="DRAWINGS">FIG. 15</figref>. The graphs show linear changes for each input, but the actual calibration may be non-linear. The values could be determined from look-up tables, from mathematical equations, etc. Note that the minimum calibration of EF_MUL_ATMR<b>1</b> could be constrained by the time required to build up sufficient ethanol fuel pressure to operate the direct injection system, or an additional multiplier could be used for fuel pressure. Also, some or all of the multipliers may be calculated using more than one input. For example, fuel/air mixing at low temperatures may only be an issue in certain ranges of speed and/or load. Also, while each graph is the same for two multipliers, each multiplier may have a different calibration in practice.</p>
<p id="p-0133" num="0132">Note that the above multipliers may also be a function of additional parameters, such as a number of combustion events from an engine start.</p>
<p id="p-0134" num="0133">An alternative embodiment of step <b>1420</b> is described for limiting a fuel type during engine warm-up. Specifically, in this embodiment, each input factor is considered as a separate possible constraint on a fuel type use (e.g., ethanol use). The current value of the overall multiplier (for the desired ethanol fraction) can be determined by the input factor which is currently the most constraining. This may involve examining the same input multipliers as above, although the calibration values of these multipliers may be chosen differently. Also, the value of EF_MUL may be continuously re-calculated during engine operation. For example, the following calculation may be used:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>EF_MUL=MINIMUM(EF_MUL_ECT, EF_MUL_EOT, EF_MUL_AAT, EF_MUL_ACT, EF_MUL_ATMR1)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0135" num="0134">With this method, when the engine is first started, EF_MUL_ATMR<b>1</b> may be the limiting constraint, followed by EF_MUL_ECT until the coolant warms up, followed by EF_MUL_EOT until the oil warms up, and then the remaining constraint may by EF_MUL_AAT in very cold weather.</p>
<p id="p-0136" num="0135">Referring now to <figref idref="DRAWINGS">FIGS. 16-18</figref>, a routine is described for selecting an initial desired relative amount of fuels, and then taking into account one or more multipliers such as those discussed above, as well as other conditions. Further, the routine then performs several adjustments, if necessary, to account for fuel storage quantities and other factors, and then uses the values to coordinate engine operation to meet driver requests.</p>
<p id="p-0137" num="0136">In <b>1610</b> the routine reads various engine operating parameters, such as engine speed, engine load, engine coolant temperature, exhaust temperature, gear ratios, etc. Then, in <b>1612</b>, the routine selects an initial type 1 and type 2 relative amounts, such as a desired fraction based on the operating parameters. Note that various alternative determinations may be made, such as determining a desired percentage of fuel types, or absolute amounts of fuel types. Further, an adaptive parameter may also be included to account for learned adjustments to the fuel types based on feedback from various sensors, such as a knock sensor. The adaptive terms may be stored as a function of speed, load, temperature, or combinations thereof, for example. In this way, if knock consistently occurs in repeatable locations, an automatic increase in the amount of type 2 injection, for example, may be adaptively learned so that such adjustment can be made without waiting for feedback from a knock sensor.</p>
<p id="p-0138" num="0137">In one example where type 2 injection is ethanol (or an ethanol blend), the determination in <b>1612</b> may be referred to as a desired ethanol fraction (EF). Note, however, that it may be a weight percent, mass percent, volume percent, or ratio. Further, absolute values may also be used, if desired, as noted herein. Further, the selection of the amounts of type 1 and type 2 injections may be based on other factors, such as factors that can affect a tendency for knock. For example, ambient humidity may be used to adjust an amount of type 2 injection for given operating conditions, as increased humidity can decrease knock tendency (and thus less type 2 injection may be needed), and vice versa. Note that a desired spark timing may also be varied as the relative amounts of type 1 and type 2 injection are varied, or as the individual amounts of the type 1 and type 2 injections are varied.</p>
<p id="p-0139" num="0138">In one example, the amount of type 2 fuel may be determined based on compression ratio, boosting, and temperature so that engine knock may be reduced thus reducing a limit of spark advance. However, as noted herein, additional factors may be used in determining whether to use type 2 fuel, and the amount of type 2 fuel, such as, for example, the amount of type 1 fuel remaining in the tank, the need to learn the content (e.g., blend) of type 2 fuel on-board, minimum pulsewidth issues, and a need to periodically operate with type 2 fuel if it has not been used frequently enough (e.g., to reduce deposit formation and or clogging of fuel lines and/or injectors).</p>
<p id="p-0140" num="0139">In another example, which may be used in addition to the examples and embodiments noted herein, transient conditions may be detected and used to initiate an open-loop adjustment in the amount of type 2 (and type 1) injection. The adjustment may be include a temporary increase in a relative amount of type 2 injection in response to the transient condition detection. In one embodiment, a driver tip-in, such as a rapid tip-in from idle conditions, may be detected. In response to such conditions, a type 2 injection (e.g. direct or port injection of an alcohol-containing mixture, e.g., ethanol or an ethanol blend) may be temporarily increased with a predetermined or actively varying profile. In this way, the heat capacity/heat of vaporization of substances, such as fuel, injected into the engine may be increased, thereby reducing a tendency for tip-in knock. As one example, EF may be temporarily increased by 5-10 percent for one to 10 combustion cycles in response to a driver tip-in.</p>
<p id="p-0141" num="0140">Continuing with <figref idref="DRAWINGS">FIG. 16</figref>, in <b>1614</b>, the routine adjusts the initial amount based on various factors, such as the multipliers discussed above with regard to <figref idref="DRAWINGS">FIGS. 14-15</figref>. For example, the minimum multiplier may be used, or all multipliers together may be used, as discussed above. Next, in <b>1616</b>, the routine continues to determine whether type 2 fuel is empty (e.g., the storage location is empty or below a minimum value) or disabled. If so, the routine continues to <b>1618</b> to set the adjusted initial relative amount (e.g., EF) to zero. Alternatively, the routine continues to determine in <b>1620</b> whether type 1 fuel is empty (e.g., the storage location is empty or below a minimum value) or disabled. If so, the routine continues to <b>1622</b> to set the adjusted initial relative amount (e.g., EF) to 1 (or 100%). Finally, the routine continues to <b>1624</b> to output the adjusted relative amount of fuel types. In this way, it is possible to account for various operating factors and/or situations in determining amount of fuel types to be used during engine operation.</p>
<p id="p-0142" num="0141">The routine then continues to <b>1710</b> in <figref idref="DRAWINGS">FIG. 17</figref> to determine a desired engine torque. The desired engine torque may be based on a driver request, engine speed, gear ratio, cruise control, traction control, vehicle stability control, etc. Then, in <b>1714</b>, the routine determines a desired air-fuel ratio based on operating conditions. For example, lean, rich, or near stoichiometric conditions may by selected. Then, in <b>1716</b>, the routine reads the relative amounts type 1 and type 2 fuels from <b>1624</b>, which accounts for warm-up effects and fuel availability.</p>
<p id="p-0143" num="0142">In <b>1718</b>, the routine determines feedforward amounts of type 1 and type 2 injections based on the relative amount, desired torque, desired air-fuel ratio, and/or other operating conditions. For example, the routine can determine a total amount of fuel energy that needs to be provided to provide the desired engine torque, and then proportion the fuel energy among the fuel types based on the desired ratio (or relative amount) of the fuel types taking into account different power density, fuel density, etc. of the fuel types, if present. Further, the routine can then determine an initial fuel amount for each fuel type, that when supplied to the engine at the current conditions, produces the desired torque, assuming sufficient air is present. The fuel amounts may be in various units, including a corresponding fuel pulse width (PW) given the injector characteristics for the fuel type, thus taking into account an injector slope and offset, for example.</p>
<p id="p-0144" num="0143">Next, in <b>1720</b>, the routine adds feedback air-fuel ratio adjustments to one or both of the fuel amounts. As described herein, the feedback adjustments may be based on air-fuel ratio sensors in the exhaust, and adjustments may change between different fuel types under different conditions. Again, the adjustments may be in various units, including pulse width (PW).</p>
<p id="p-0145" num="0144">Continuing with <figref idref="DRAWINGS">FIG. 17</figref>, in <b>1722</b> the routine determines whether the type 2 pulse width is less than a minimum value (min_pw_<b>2</b> for the type 2 injector). If so, the routine continues to <b>1724</b> to increase the type 2 fuel amount (e.g., PW) and decrease the type 1 fuel amount by a corresponding amount. In this way, in the example where type 2 fuel is used to decrease a tendency of knock, the system errs on providing additional type 2 fuel so that knock is reduced and operating at low pulse width values is also reduced or avoided.</p>
<p id="p-0146" num="0145">Alternatively, if the answer to <b>1722</b> is no, the routine continues to <b>1726</b> to determine whether the type 1 pulse width is less than a minimum value (min_pw_<b>1</b>) for the type 1 injector. If so, the routine continues to <b>1728</b> to decrease the type 1 fuel amount (e.g., PW) to zero and increase the type 2 fuel amount by a corresponding amount. Again, in this way, in the example where type 2 fuel is used to decrease a tendency of knock, the system errs on providing additional type 2 fuel so that knock is reduced and operating at low pulse width values is also reduced or avoided.</p>
<p id="p-0147" num="0146">From either <b>1728</b> or when the answer to <b>1726</b> is no, the routine continues to <b>1730</b> to determine an air amount based on the desired air-fuel ratio and the stoichiometric air-fuel ratio of the actual mixture provided via type 1 and type 2 injectors. The airflow can then be provided via an electronically controlled throttle, valve timing, or other such actuator.</p>
<p id="p-0148" num="0147">In this way, it is possible to account for varying relative amounts of fuel types and varying total fuel amounts, while compensating for minimum fuel limits and providing a desired engine torque at a desired air-fuel ratio.</p>
<p id="p-0149" num="0148">Referring now to <figref idref="DRAWINGS">FIG. 18</figref>, a routine is described for compensating for limits on the ability to use different fuel types under different conditions and compensate for the potential of engine knock. For example, in the case where a type 2 injection is used to reduce likelihood of knock (e.g., directly injected ethanol or an ethanol blend), limiting the used of such a fuel under selected conditions, along with other conditions (e.g., increased compression ratio, boosting, etc.) may result in knock occurring. In other words, in the example where ethanol is limited until the engine is warmed up, the control strategy may account for the effect of reduced ethanol on engine operation. And, if one purpose of ethanol is to enable increased compression ratio and/or increased boost pressure (because of ethanol's higher octane and higher heat of vaporization), when ethanol use is being limited (EF_MUL&#x3c;1), it may be necessary to take additional control actions to avoid or reduce knock (despite the decreased knock tendency at lower temperatures). In one embodiment, feedback knock control where spark timing is adjusted in response to a knock sensor may be used. Alternatively, or in addition, open-loop knock avoidance may also be desired to provide a starting point for the closed-loop knock control system and/or as a back-up system for times that the closed-loop knock control system is degraded.</p>
<p id="p-0150" num="0149">One approach to open-loop knock avoidance when EF_MUL is less than one can be provided with a combination of additional spark retard, additional enrichment, transmission downshifting (to increase engine speed, because knock may be less likely at higher speeds), load limiting with electronic throttle, and/or boost limiting via wastegate or variable geometry turbocharger adjustments. Depending on operating conditions (e.g. compression ratio and/or boost pressure), various control strategies could be used.</p>
<p id="p-0151" num="0150">In a first embodiment, sensitivity of knock-limited spark advance may be mapped to a number of variables, such as RPM, torque, air/fuel ratio, engine intake air temperature, and also the amount of ethanol reduction (e.g., EF_MUL) or ethanol fraction as an additional variable.</p>
<p id="p-0152" num="0151">In a second embodiment, where spark retard alone to avoid knock may be insufficient (e.g., excessive spark retard can cause surge and/or high exhaust temperature), additional modifications may be made. For example, the routine can first retard spark as much as feasible, then enrich the combustion air-fuel ratio to avoid or reduce knock. If the maximum feasible enrichment is encountered, then a transmission downshift may be commanded.</p>
<p id="p-0153" num="0152">In a third embodiment, the routine can first retard spark as much as feasible, then command a transmission downshift. If there is still a potential for knock, the routine can then enrich enough to avoid or reduce knock.</p>
<p id="p-0154" num="0153">In a fourth embodiment, the routine can limit maximum load with electronic throttle control. Such an approach may be used alone, or in combination with one of the first, second, and/or third embodiment above if those approaches provide insufficient knock control (because limiting maximum load may cause degraded driver satisfaction). The maximum allowed load can be mapped as a function of EF_MUL or ethanol fraction, engine speed, engine coolant temperature, relative air/fuel ratio, and other variables. For example, the following function may be used:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>MAX_LOAD=f(EF_MUL or EF, RPM, ECT, a/f, etc.)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0155" num="0154">In a fifth embodiment, the routine can limit maximum boost with the wastegate and/or compressor bypass valve. Again, such action may be used alone, or in addition to one of the four embodiments above, if those strategies provide insufficient knock control (again because limiting maximum boost may cause driver dissatisfaction). The maximum allowed boost can be mapped as a function of EF_MUL or ethanol fraction, engine speed, engine coolant temperature, relative air/fuel ratio, and other variables, as:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>MAX_BOOST=f(EF_MUL or EF, RPM, ECT, a/fl, etc.)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0156" num="0155">Numerous variations on these embodiments are possible, for example the second and third embodiments could omit either downshifting or enrichment.</p>
<p id="p-0157" num="0156">Referring now specifically to <figref idref="DRAWINGS">FIG. 18</figref>, in <b>1810</b> the routine compares the final type 1 and type 2 injection amounts to the initial amounts from <figref idref="DRAWINGS">FIG. 16</figref>. For example, the routine may determine a difference by which the fuel types have been adjusted, which may increase a tendency for knock based on the current operating conditions. Then, in <b>1812</b>, the routine determines whether this difference is too great for the current conditions (e.g., the routine may make an open-loop estimate of whether knock may be encountered). If so, the routine continues to <b>1814</b> to adjust an operating parameter to reduce the tendency for knock, such as the five embodiments discussed immediately above herein.</p>
<p id="p-0158" num="0157">In this way, even when the desired amount of type 2 injection to reduce knock is not available, knock may still be reduced in an efficient manner.</p>
<p id="p-0159" num="0158">Referring now to <figref idref="DRAWINGS">FIG. 19</figref>, a routine is described for dealing with different levels of fuel or injection types during an engine start, and more particularly if a fuel type becomes unavailable since the storage is empty. For example, previous engine operation may result in depleting one fuel type. However, due to the approach described herein, it may be possible to run out of one fuel type without forcing an engine shutdown. Then, the routine of <figref idref="DRAWINGS">FIG. 19</figref> may be used to decide when to allow the engine to run (or start) when one fuel tank is empty, or when one fuel type is depleted. The routine of <figref idref="DRAWINGS">FIG. 20</figref> may be used to adjust current engine operation if a fuel type is depleted during engine operation.</p>
<p id="p-0160" num="0159">Returning to <figref idref="DRAWINGS">FIG. 19</figref>, the routine first determines whether an engine start is requested (e.g., by monitoring key position, etc.). If so, the routine continues to <b>1912</b> to determine if the driver is attempting to start the engine when a first fuel type is depleted (e.g., a gasoline fuel tank is empty). If so, the routine continues to <b>1914</b> to determine whether to start on a type 2 fuel (e.g., ethanol, an ethanol blend, another alcohol containing fuel or blend, a different injector location, etc. The decision of <b>1914</b> may be based on a probability of successful starting using the type 2 fuel, and/or a probability of achieving acceptable exhaust emissions. Both of these factors may depend on factors such as temperature (of engine coolant and/or engine oil and/or engine intake air), and can be determined from:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>START_PROB=f(ECT, EOT, ACT)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>EMIS_OK_PROB=f(ECT, EOT, ACT)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0161" num="0160">If the probability of a successful start is below a threshold (i.e., answer to <b>1914</b> is no), then the engine can be cranked without any fuel injection (or operating only injectors for fuel type 1. If the probability of a successful start exceeds the threshold, then a start can be attempted with type 2 fuel in <b>1918</b>. If a start is attempted but the probability of acceptable exhaust emissions is low, then an indicator light may be activated alerting the driver and an error code can be set.</p>
<p id="p-0162" num="0161">In this way, it may be possible to provide an engine start even if a fuel type is depleted, while avoiding attempting starts under condition in which the remaining fuel type may cause degraded or unacceptable performance.</p>
<p id="p-0163" num="0162">In one embodiment, when the answer to <b>1914</b> is yes, the routine may continue to <b>1920</b> to determine whether starting on both type 1 and type 2 fuel types may be performed. Such operation may desirable under selected conditions, such as based on ECT, EOT, ACT, barometric pressure, or combinations thereof. If so, the routine may proceed to <b>1922</b> to crank with both fuel types. And if not, the routine proceeds to <b>1918</b> as indicated above.</p>
<p id="p-0164" num="0163">Referring now to <figref idref="DRAWINGS">FIG. 20</figref>, a routine is described for adjusting operation if an injection type is depleted, such as in the case where a first reservoir coupled to a first injector contains gasoline or a gasoline blend, and a second reservoir coupled to a second injector contains an alcohol blend, such as an ethanol blend, or simply ethanol. Note, however, that the routine can apply to various other situations, such as where the second reservoir contains water or a water blend, for example.</p>
<p id="p-0165" num="0164">First, in <b>2010</b> the routine determines respective reservoir levels of at least a first and second reservoir. As noted herein, the reservoirs may separately hold different fuel blends, where one reservoir is larger than another reservoir, which may be referred to as primary and secondary reservoirs, respectively. Next, in <b>2012</b>, the routine determines whether the primary reservoir is empty. For example, the routine may determine the reservoir is empty if the fluid level is below an empty threshold, or if an estimate of the amount of fluid used reaches a preselected value, without a refilling event. If not, the routine continues to <b>2014</b> to determine whether the secondary reservoir is empty. Again, this may be determined in various ways. If so, the routine continues to <b>2024</b>, otherwise the routine continues to <b>2016</b>. In one example, the values that would be considered &#x201c;low&#x201d; for each reservoir level could be calibratable so that unmodified injection and engine function could be maintained for a majority of operation, or could be set so that it is maintained as long as possible.</p>
<p id="p-0166" num="0165">In <b>2016</b>, the routine determines whether the primary reservoir is low. For example, the routine may determine the reservoir is empty if the fluid level is below a low threshold, or if an estimate of the amount of fluid used reaches a second preselected value, without a refilling event. If so, the routine continues to <b>2028</b>. If not, the routine continues to <b>2018</b> to determine whether the secondary reservoir is low. Again, this may be determined in various ways. If so, the routine continues to <b>2020</b>, otherwise the routine continues to <b>2022</b>.</p>
<p id="p-0167" num="0166">In <b>2020</b>, the routine determines whether the manifold absolute pressure level, and/or boosting level, can be maintained without enrichment if the secondary injection is not used. In other words, the routine determines whether the secondary injection is needed to avoid knock without adjusting using enrichment and/or spark retard, for example. If the answer to <b>2020</b> is yes, the routine continues to <b>2022</b>. In <b>2022</b>, the routine continues to use the injection amounts determined herein without modification. Otherwise, the routine continues to <b>2024</b> to disable the secondary injectors to one or more cylinders and adjust the primary injection amount in <b>2026</b>. Specifically, the primary injection is adjusted to compensate for the reduction in secondary injection in terms of air-fuel ratio, torque production, etc. Further, additional adjustments may also be used, such as spark adjustments, throttle angle, boost pressure, or combinations thereof.</p>
<p id="p-0168" num="0167">Continuing with <figref idref="DRAWINGS">FIG. 20</figref>, in <b>2028</b> and <b>2030</b>, when the primary reservoir is low, the routine reduces primary injection and increases secondary injection. Specifically, the routine adjusts the secondary injection to compensate for the reduction in primary injection on parameters such as air-fuel ratio, torque, etc. In this way, it is possible to reduce usage of the primary reservoir, without increasing a potential for knock. Note that the amount of increase/reduction in <b>2028</b> may be based on various factors, such as engine speed and load, vehicle speed, etc. Further, additional adjustments may be used to compensate for the increase/decrease, such as boost pressure, spark retard, throttle angle, etc. For example, as the secondary injection increases, allowable boost (without encountering knock) may be increased.</p>
<p id="p-0169" num="0168">In general terms, the routine of <figref idref="DRAWINGS">FIG. 20</figref> can operate to first deplete the secondary reservoir before depleting the primary reservoir, at least in one embodiment. Such an approach can be desirable where the primary reservoir contains a fuel that is the fuel used for starting (e.g., the second reservoir contains a fuel with less volatility). In this way, if the vehicle is shut-off without refueling, engine starting may still be provided under a greater range of conditions.</p>
<p id="p-0170" num="0169">Further, once it has been determined that the secondary supply is running low, the goal of the control system could be to maintain stoichiometric operation as long as possible to maintain emissions performance. The operating conditions could be evaluated to determine if the desired torque (or close to the desired torque) could be achieved with spark retard and without (or with reduced) fuel enrichment. If the desired torque could be obtained by increasing boost and retarding spark, then the secondary injection (e.g., ethanol or an ethanol blend) could be disabled. However, if enrichment is needed, then the secondary injection could be used. In such a circumstance, acceptable operating conditions in which the secondary injection is disabled could be mapped to determine acceptable spark, fuel, throttle, and boost settings without the secondary injection (e.g., without ethanol or with reduced ethanol). Then, once the secondary reservoir was depleted, the engine could still operate, but with potentially reduced maximum engine performance and/or reduced fuel economy (because of the potential need for additional fuel enrichment and spark retard to counteract knock).</p>
<p id="p-0171" num="0170">In this way, it is possible to take advantage of multiple reservoirs with different fuel blends to extend engine operation and performance and/or efficiency gains over a greater range.</p>
<p id="p-0172" num="0171">Referring now to <figref idref="DRAWINGS">FIG. 21</figref>, a graph illustrates different injector characteristics for two example injectors via lines <b>2110</b> and <b>2112</b>. In one example, injector line <b>2110</b> can be for type 2 injection (e.g., ethanol, direct injector, water injection, etc.), while line <b>2112</b> can be for a type 1 injection (e.g., gasoline, port injector, gasoline blend, etc.). While this example shows each injector having the same minimum pulse width (minpw<b>1</b>), in another embodiment they may have different minimum pulse widths. The graph also illustrates how the injectors are sized for different maximum fuel flows, with different injector slopes. As noted herein, the air-fuel ratio feedback control gains and/or adaptive learning gains for the different injectors may be different to account for the variation in injector slope and/or offset (minimum flow value), as well as different fuel characteristics.</p>
<p id="p-0173" num="0172">Referring now to <figref idref="DRAWINGS">FIG. 22</figref>, a graph is shown illustrating an example determination of an amount of type 2 injection (e.g., ethanol, an ethanol blend, direct injection, open valve port injection, etc.) in response to a determination of knock tendency (e.g., as torque increases, as speed reduces, as temperature increases, as humidity decreases, and/or combinations thereof). The graph illustrates with line <b>2210</b> (versus <b>2212</b>) that when first phasing in ethanol (in addition to gasoline) at medium to high load, for example, near zero ethanol injection may not be feasible. As such, the control system adds a selected amount of ethanol at or near the minimum pulse width. In this way, for example, it is possible to provide sufficient ethanol to reduce tendency for knock without violating the minimum stable pulsewidth of the ethanol injectors.</p>
<p id="p-0174" num="0173">Note that in the examples described in <figref idref="DRAWINGS">FIGS. 21 and 22</figref>, a single slope was used in the fuel injector response diagram. However, the graph may be non-linear, and for example may have two linear segments, each with its own slope and offset. Further, the graph may also have a curved response.</p>
<p id="p-0175" num="0174">Referring now to <figref idref="DRAWINGS">FIG. 23</figref>, an alternative embodiment is described for controlling fuel injection of a first and second injection type, taking into account minimum pulse width issues and different fuel type characteristics. First, in <b>2310</b>, the routine determines a desired fraction of a fuel type, for example ethanol fraction (EF). Next in <b>2312</b>, a desired overall air-fuel ratio, or relative air-fuel ratio, is determined. Desired overall relative air-fuel ratio can be determined as a function of speed, load, inferred exhaust temperature, etc. The desired ethanol fraction can be determined primarily as a function of speed and load as described herein, with additional logic for start and warm-up, variable ambient conditions, low fuel levels of ethanol or gasoline, etc.</p>
<p id="p-0176" num="0175">Next, in <b>2314</b>, the routine calculates an overall stoichiometric air/fuel ratio for the EF of <b>2310</b> as:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>AF_stoich_total=(1&#x2212;EF)*(AF_stoich_gas)+(EF)*(AF_stoich_eth)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0177" num="0176">where AF_stoich_total is the overall stoichiometric air/fuel ratio, AF_stoich_gas is the stoichiometric air/fuel ratio for a first fuel type (e.g., for gasoline approx. 14.6), AF_stoich_eth=stoichiometric air/fuel ratio for a second fuel type (e.g., 9.0 for pure ethanol, approx. 9.8 for E85), and EF=desired ethanol fraction from <b>2310</b> (or in general, desired fraction of the second fuel type). Note that the stoichiometric values for gasoline and ethanol could be modified based on adaptive learning with feedback from exhaust oxygen sensors.</p>
<p id="p-0178" num="0177">Next, in <b>2316</b> the routine calculates a desired fuel mass flow for the gasoline injector (which may be a port injector) and for the ethanol injector (which may be a direct injector) as:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>fuel_mass_total=air_mass/[(AF_stoich_total)*(lambda)]<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>fuel_mass_gasoline=(1&#x2212;EF)*(fuel_mass_total)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>fuel_mass_ethanol=(EF)*(fuel_mass_total)<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0179" num="0178">where</p>
<p id="p-0180" num="0179">lambda is a desired relative air-fuel ratio from <b>2312</b>, AF_stoich_total is an overall stoichiometric air/fuel ratio from step <b>2314</b>, and air_mass is an air mass entering the cylinder to be fueled, which may be measured or inferred.</p>
<p id="p-0181" num="0180">Continuing with <figref idref="DRAWINGS">FIG. 23</figref>, in <b>2318</b>, the routine then calculates fuel injection pulse width commands for the two injectors based on fuel masses calculated in <b>2316</b>. Further, the routine includes adjustments to maintain the ethanol injection at least at the minimum pulse width (by reducing gasoline pulse width if necessary, or by turning off the gasoline injection if it reaches a minimum pulse width and increasing ethanol pulse width accordingly, as noted above herein with regard to <figref idref="DRAWINGS">FIGS. 17 and 22</figref>, for example).</p>
<p id="p-0182" num="0181">Referring now to <figref idref="DRAWINGS">FIG. 24</figref> et seq., routines and graphs are shown for an example where a first injection type is gasoline or diesel fuel, and a second injection type includes water, such as pure water, a water and alcohol blend, or a water and ethanol blend, or a water and methanol blend, or others as noted herein. Further, in one embodiment, type 1 injection is port injected fuel to a cylinder, while type 2 injection is directly injected fuel to the cylinder. In another embodiment, both types of injection can be port injection, such as shown in <figref idref="DRAWINGS">FIG. 4</figref> or <b>5</b>.</p>
<p id="p-0183" num="0182">As discussed herein, a possible benefit of multiple fuel types, such as using gasoline and ethanol, is that knock may be suppressed under conditions where it may otherwise occur due to a combination of higher fuel octane and increased charge cooling (e.g., due to the ethanol's higher heat of vaporization). The charge cooling effect may also be enhanced by providing the charge cooling effect mostly by the air, with little or no evaporation from metal surfaces like the intake manifold, via direct injection or targeted port injection with open valve injection.</p>
<p id="p-0184" num="0183">However, ethanol (or other alcohol based fuels) may be expensive or unavailable at some times and/or locations. Thus, if relying on such fuels, if they are unavailable, engine torque and/or performance may be limited. To reduce or eliminate such torque and/or power limitations, one approach could include added hardware and/or control logic to allow use of water (or water/ethanol, or water with an alcohol containing mixture, or other mixtures) in the second (e.g., ethanol) fuel system.</p>
<p id="p-0185" num="0184">For example, water, or a water mixture, could attain part or all of the knock benefit of ethanol at high loads. Although water has no specific octane value, it does have a higher heat of vaporization (approximately 2256 kJ/kg, compared to approximately 840 for ethanol and approximately 350 for gasoline). Therefore, by enabling injection (direct or port) of water (or a water alcohol mixture), similar knock improvements may be achieved. Further, an additional benefit of water/ethanol flexibility may be the ability to use very late injection of water (when the tank is filled with mostly water). Late injection could be used for exhaust temperature control and/or increased boost at low RPM and/or reduced turbo lag.</p>
<p id="p-0186" num="0185">In one approach, when enabling a second injection source to have a varying ratio of water and an alcohol blend (e.g., water and ethanol, or water and an ethanol/gasoline blend), it may be beneficial to be able to measure or infer the Water Fraction (WF) in the ethanol/water fuel tank, or conversely, the ethanol fraction. WF may vary from zero (pure ethanol) to one (pure water), in this example. This information can then be used for various features, including determining the desired amount of gasoline and the water/ethanol blend to provide a desired torque while reducing knock, and also to maintain accurate control of combustion overall air/fuel ratio.</p>
<p id="p-0187" num="0186">In one embodiment, a sensor could measure one or more properties that differ between water and ethanol, for example any of the following, or combinations thereof, may be used: specific gravity (about 1 for water, and about 0.789 for ethanol), viscosity (about 21 lb-s/ft2 for water and about 25 for ethanol), capacitance, resistance, or others. Sensor readings may use compensation for temperature and other changes that affect the properties of water and/or ethanol, if desired.</p>
<p id="p-0188" num="0187">In another embodiment, an inferred estimate of the water fraction (WF), or equivalent parameter may be used. One process of inferring WF may include performing the estimate at specific times, for example after each engine start and/or after a refueling event is detected via fuel level sensor. The WF inference process can occur when the engine is running on gasoline in closed-loop air/fuel control (e.g., stoichiometric feedback control), with vapor purge disabled.</p>
<p id="p-0189" num="0188">The WF inference process may include gradually increasing pulse width on the water/ethanol injector(s) while maintaining an overall stoichiometric air/fuel ratio based on closed-loop control using exhaust oxygen sensors via corresponding reduction of the gasoline injection pulse width. The pulse width values and/or changes of the gasoline and water/ethanol injectors can then be used to calculate WF. For example, if the pulse width of the water/ethanol injectors can be greatly increased and/or decreased with no or minimum decrease and/or increase in gasoline injector pulse width, then WF is one (pure water).</p>
<p id="p-0190" num="0189">Alternatively, or in addition, a combination of feedback information and other information can be used to estimate WF. For example, one can use the airflow (e.g., from the MAF sensor) and air/fuel ratio (e.g. from an exhaust sensor) to determine a total amount of fuel provided by the injectors, and then use the injector slopes and offsets to determine an amount and ratio of water in the water/ethanol mixture.</p>
<p id="p-0191" num="0190">In one embodiment, various factors may be considered, including injector transfer functions (fuel mass flow vs. pulse width) may include compensation for changes in specific gravity and viscosity, which can be themselves a function of the water fraction. Thus, the water fraction (WF) may be referred to as the fraction of water in an ethanol/water mixture, although other fractions may be used, such as the fraction of water in the overall ethanol/water/gasoline mass. In the example where the water fraction is the fraction of water in an ethanol/water mixture, the following procedure may be used for calculating/estimating the water fraction (WF) during engine operation:
<ul id="ul0001" list-style="none">
    <li id="ul0001-0001" num="0000">
    <ul id="ul0002" list-style="none">
        <li id="ul0002-0001" num="0191">(1) First, the method may be enabled once the system has attained convergence about stoichiometry with feedback from one or more exhaust gas oxygen sensor(s), using type 1 injectors only (e.g., gasoline injectors in this example).</li>
        <li id="ul0002-0002" num="0192">(2) Next, a turn-on pulsewidth near a minimum pulsewidth on the type 2 injectors (e.g., ethanol/water injectors in this example) may be set. A smaller pulsewidth is desired to reduce excursions in the air/fuel ratio when injecting an unknown, or relatively unknown water mixture (where the mixture may be an ethanol/water mixture in one example). The minimum pulsewidth can be the pulsewidth which gives stable and repeatable flowrate control, and may be variable with operating conditions. In one example, to improve accuracy in determining a water fraction (WF), a larger pulsewidth may be used to increase the signal to noise ratio (i.e., generate a larger amount of water to be detected). The turn-on pulsewidth may be determined in at least two ways: (a) mapping of representative hardware, and determination of minimum pulsewidth for accurate WF calculations (this may be a function of speed, load, temperature, etc.), or (b) starting with the minimum stable pulsewidth, and gradually increasing pulsewidth of the ethanol/water injectors during (3) below, until the pulsewidth of the gasoline injectors changes sufficiently to ensure an accurate WF calculation.</li>
        <li id="ul0002-0003" num="0193">(3) Next, the controller can adjust a pulsewidth of the type 1 (e.g., gasoline, in this example) injectors to regain closed-loop stoichiometry based on exhaust oxygen sensor(s).</li>
        <li id="ul0002-0004" num="0194">(4) Then, by using the pulsewidth adjustment amount of the gasoline injectors, the controller can calculate a mass of gasoline per cylinder per combustion event, or fuel_mass_gas. This can be done using a conversion that includes the injector slopes, such as described with regard to <figref idref="DRAWINGS">FIG. 35</figref>.</li>
        <li id="ul0002-0005" num="0195">(5) Using the mass of gasoline from (4), the measured or inferred air mass, and the known stoichiometric air/fuel ratios of the fuels being combusted (e.g., gasoline and ethanol), the controller can calculate an ethanol fraction (EF) using the equation below. The controller can calculate the stoichiometric air/fuel ratio of the gasoline during step (1) above, based on measured or inferred air mass and on injector mass flow vs. pulsewidth (thus accounting for variations due to oxygenated gasoline etc). Specifically, an example ethanol fraction (EF) can be calculated as:</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0192" num="0196">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
<mrow>
  <mrow>
    <mi>E</mi>
    <mo>&#x2062;</mo>
    <mstyle>
      <mspace width="0.3em" height="0.3ex"/>
    </mstyle>
    <mo>&#x2062;</mo>
    <mi>F</mi>
  </mrow>
  <mo>=</mo>
  <mfrac>
    <mrow>
      <mo>(</mo>
      <mrow>
        <mi>air_mass</mi>
        <mo>-</mo>
        <mrow>
          <mi>fuel_mass</mi>
          <mo>&#x2062;</mo>
          <mi>_gas</mi>
          <mo>*</mo>
          <mi>AF_stoich</mi>
          <mo>&#x2062;</mo>
          <mi>_gas</mi>
        </mrow>
      </mrow>
      <mo>)</mo>
    </mrow>
    <mrow>
      <mo>(</mo>
      <mtable>
        <mtr>
          <mtd>
            <mrow>
              <mi>air_mass</mi>
              <mo>-</mo>
              <mrow>
                <mi>fuel_mass</mi>
                <mo>&#x2062;</mo>
                <mi>_gas</mi>
                <mo>*</mo>
                <mi>AF_stoich</mi>
                <mo>&#x2062;</mo>
                <mi>_gas</mi>
              </mrow>
              <mo>+</mo>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mi>fuel_mass</mi>
              <mo>&#x2062;</mo>
              <mi>_gas</mi>
              <mo>*</mo>
              <mi>AF_stoich</mi>
              <mo>&#x2062;</mo>
              <mi>_eth</mi>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
      <mo>)</mo>
    </mrow>
  </mfrac>
</mrow>
</math>
</maths>
</p>
<p id="p-0193" num="0197">where</p>
<p id="p-0194" num="0198">EF=ethanol fraction of total gasoline+ethanol (not water)</p>
<p id="p-0195" num="0199">air_mass=mass of air per cylinder per combustion event</p>
<p id="p-0196" num="0200">fuel_mass_gas=mass of gasoline per cylinder per combustion event</p>
<p id="p-0197" num="0201">AF_stoich_gas stoichiometric air/fuel for gasoline (approximately 14.6, or from (1))</p>
<p id="p-0198" num="0202">AF_stoich_eth stoichiometric air/fuel for ethanol (approximately 9.0 for pure ethanol, or approximately 9.8 for E85, or from previous closed-loop operation on ethanol similar to (1)).
<ul id="ul0003" list-style="none">
    <li id="ul0003-0001" num="0000">
    <ul id="ul0004" list-style="none">
        <li id="ul0004-0001" num="0203">(6) Using the mass of gasoline from (4) and the ethanol fraction from step (5), the controller can calculate the mass of ethanol using the equation below.
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>fuel_mass_ethanol=(EF*fuel_mass_gas)/(1&#x2212;EF)<?in-line-formulae description="In-line Formulae" end="tail"?>
</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0199" num="0204">where fuel_mass_ethanol=mass of ethanol per cylinder per combustion event.
<ul id="ul0005" list-style="none">
    <li id="ul0005-0001" num="0000">
    <ul id="ul0006" list-style="none">
        <li id="ul0006-0001" num="0205">(7) Using the mass of ethanol from (6) and the pulsewidth of the ethanol/water injectors, the controller can calculate the water fraction (WF) using one of the equations below.</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0200" num="0206">If the injector characteristics (slopes) are not a function of water fraction, the equation is:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>WF=1&#x2212;{fuel_mass_ethanol/[(PW&#x2212;OFFSET1)*ALOSL]}<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0201" num="0207">where</p>
<p id="p-0202" num="0208">WF=water fraction, of total ethanol+water (not gasoline in this example)</p>
<p id="p-0203" num="0209">PW=pulsewidth of the ethanol/water injectors</p>
<p id="p-0204" num="0210">OFFSET<b>1</b>=ethanol/water injector offset (initial delay) as a function of voltage</p>
<p id="p-0205" num="0211">ALOSL=slope of ethanol/water injectors (mass per time) at low PW</p>
<p id="p-0206" num="0212">If the injector characteristics (slopes) are a function of the water fraction, the equation is:</p>
<p id="p-0207" num="0213">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
<mfrac>
  <mtable>
    <mtr>
      <mtd>
        <mrow>
          <mrow>
            <mrow>
              <mo>-</mo>
              <mi>ALOSL_eth</mi>
            </mrow>
            <mo>*</mo>
            <mrow>
              <mo>(</mo>
              <mrow>
                <mi>k</mi>
                <mo>-</mo>
                <mn>2</mn>
              </mrow>
              <mo>)</mo>
            </mrow>
          </mrow>
          <mo>-</mo>
        </mrow>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mrow>
          <mi>sqrt</mi>
          <mo>&#x2061;</mo>
          <mrow>
            <mo>[</mo>
            <mtable>
              <mtr>
                <mtd>
                  <mrow>
                    <mrow>
                      <mrow>
                        <mi>ALOSL_eth</mi>
                        <mo>^</mo>
                        <mn>2</mn>
                      </mrow>
                      <mo>*</mo>
                      <mrow>
                        <mrow>
                          <mo>(</mo>
                          <mrow>
                            <mi>k</mi>
                            <mo>-</mo>
                            <mn>2</mn>
                          </mrow>
                          <mo>)</mo>
                        </mrow>
                        <mo>^</mo>
                        <mn>2</mn>
                      </mrow>
                    </mrow>
                    <mo>-</mo>
                    <mrow>
                      <mn>4</mn>
                      <mo>*</mo>
                      <mi>ALOSL_eth</mi>
                      <mo>*</mo>
                    </mrow>
                  </mrow>
                </mtd>
              </mtr>
              <mtr>
                <mtd>
                  <mrow>
                    <mrow>
                      <mo>(</mo>
                      <mrow>
                        <mn>1</mn>
                        <mo>-</mo>
                        <mi>k</mi>
                      </mrow>
                      <mo>)</mo>
                    </mrow>
                    <mo>*</mo>
                    <mrow>
                      <mo>(</mo>
                      <mfrac>
                        <mrow>
                          <mi>ALOSL_eth</mi>
                          <mo>-</mo>
                          <mrow>
                            <mi>fuel_mass</mi>
                            <mo>&#x2062;</mo>
                            <mi>_ethanol</mi>
                          </mrow>
                        </mrow>
                        <mrow>
                          <mo>(</mo>
                          <mrow>
                            <mi>PW</mi>
                            <mo>-</mo>
                            <mrow>
                              <mi>OFFSET</mi>
                              <mo>&#x2062;</mo>
                              <mstyle>
                                <mspace width="0.3em" height="0.3ex"/>
                              </mstyle>
                              <mo>&#x2062;</mo>
                              <mn>1</mn>
                            </mrow>
                          </mrow>
                          <mo>)</mo>
                        </mrow>
                      </mfrac>
                      <mo>)</mo>
                    </mrow>
                  </mrow>
                </mtd>
              </mtr>
            </mtable>
            <mo>]</mo>
          </mrow>
        </mrow>
      </mtd>
    </mtr>
  </mtable>
  <mrow>
    <mn>2</mn>
    <mo>*</mo>
    <mi>ALOSL_eth</mi>
    <mo>*</mo>
    <mrow>
      <mo>(</mo>
      <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <mi>k</mi>
      </mrow>
      <mo>)</mo>
    </mrow>
  </mrow>
</mfrac>
</math>
</maths>
</p>
<p id="p-0208" num="0214">where</p>
<p id="p-0209" num="0215">ALOSL_eth=slope of ethanol/water injectors at low PW with ethanol</p>
<p id="p-0210" num="0216">ALOSL_water=slope of ethanol/water injectors at low PW with water</p>
<p id="p-0211" num="0217">k=ALOSL_water/ALOSL_eth</p>
<p id="p-0212" num="0218">sqrt[ ]=square root of expression in brackets</p>
<p id="p-0213" num="0219">While the above equations show one approach for performing the calculations and determinations, they may be modified to include alternative fuel types, alternative injector characteristic equations (for example mass flow vs. pulsewidth may be curved), etc. Further, various modifications may be made to the equations to improve accuracy, or improve simplicity of calculation, if desired.</p>
<p id="p-0214" num="0220">To illustrate the source of the above equations and thus provide details for modification of the equations, the relationship between the mass of gasoline, the measured or inferred air mass, the known stoichiometric air/fuel ratios of the fuels being combusted (e.g., gasoline and ethanol), and the ethanol fraction (EF) can be derived by first noting that: fuel_mass_gas=(1&#x2212;EF)*fuel_mass_total, and then manipulating this equation to substitute for the fuel mass in terms of the air mass and overall air-fuel ratio as: fuel_mass_gas=(1&#x2212;EF)*air_mass/AF_stoich_total. Then, the individual air-fuel ratios of the fuel types can be inserted as: fuel_mass_gas=(1&#x2212;EF)*air_mass/[(1&#x2212;EF)*AF_stoich_gas+EF*AF_stoich_eth]. From this, the equation can be rearranged to give: fuel_mass_gas*AF_stoich_gas&#x2212;EF*fuel_mass_gas*AF_stoich_gas+EF*fuel_mass_gas*AF_stoich_eth=air mass&#x2212;EF*air_mass, which leads to the equation listed above in (5).</p>
<p id="p-0215" num="0221">Likewise, the mass of ethanol may be derived by noting that fuel_mass_ethanol=EF*fuel_mass_total. Then, by manipulating this equation, the equation listed in (6) can be obtained.</p>
<p id="p-0216" num="0222">Further, the water fraction (WF) can be derived (in the case where any interaction between WF and slope/offset changes is ignored) by starting with the following equation 1:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>PW=OFFSET1+LBM_INJ_TOT/ALOSL&#x2003;&#x2003;[equation 1]<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0217" num="0223">where
<ul id="ul0007" list-style="none">
    <li id="ul0007-0001" num="0000">
    <ul id="ul0008" list-style="none">
        <li id="ul0008-0001" num="0224">PW=pulsewidth of the ethanol/water injectors</li>
        <li id="ul0008-0002" num="0225">OFFSET<b>1</b>=ethanol/water injector offset (initial delay) vs. battery voltage</li>
        <li id="ul0008-0003" num="0226">LBM_INJ_TOT=total mass of ethanol/water mixture injected per cylinder per combustion event</li>
        <li id="ul0008-0004" num="0227">ALOSL=slope of ethanol/water injectors (mass per time) at a lower PW</li>
    </ul>
    </li>
</ul>
</p>
<p id="p-0218" num="0228">Note that the water fraction determination process occurs with the ethanol/water injectors at low pulsewidths, so these equations are based on the steep part of curve with slope ALOSL (it will be apparent that similar equations could easily be derived for higher pulsewidths if desired).</p>
<p id="p-0219" num="0229">Then, using a definition of WF and rearranging to solve for LBM_INJ_TOT gives:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>WF=fuel_mass_water/LBM_INJ_TOT=(LBM_INJ_TOT&#x2212;fuel_mass_ethanol)/LBM_INJ_TOT<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0220" num="0230">Note that WF is the fraction of water in the ethanol/water mixture in this example, not the overall ethanol/water/gasoline mass, although such a parameter may be determined and used for engine control. The equation above can be rearranged to give equation 2:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>LBM_INJ_TOT=fuel_mass_ethanol/(1&#x2212;WF)&#x2003;&#x2003;[equation 2]<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0221" num="0231">Rearranging equation 1 and substituting LBM_INJ_TOT from equation 2 gives: (PW&#x2212;OFFSET<b>1</b>)*ALOSL=fuel_mass_ethanol/(1&#x2212;WF), which can be rearranged to give:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>WF=1&#x2212;{fuel_mass_ethanol/[(PW&#x2212;OFFSET1)*ALOSL]}<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0222" num="0232">In an alternative embodiment, the equations may be derived for the case where the injector slope (and/or offset) is a function of the water fraction. In this example, the characteristics of <figref idref="DRAWINGS">FIG. 35</figref> may again be utilized. As above, in one example, the water fraction determination process may occur with the ethanol/water injectors at pulsewidths below a threshold value (such as below PW_BP), and thus the following equations can be based on the steeper part of the injector curve with slope ALOSL, although similar equations could be derived for higher pulsewidths, if desired.</p>
<p id="p-0223" num="0233">In this example, it is assumed that the offset (OFFSET<b>1</b>) is not a function of water fraction, because the offset is the time required to overcome inertia of the injector pintle and electrical inertia of the driver circuit, although it may be a function of other parameters, such as battery voltage and temperature. Assuming that the injector slope changes linearly in proportion to the water fraction, the slope would be measured with pure water and with pure ethanol (or E85) and expressed as:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>ALOSL_total=WF*ALOSL_water+(1&#x2212;WF)*ALOSL_eth<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0224" num="0234">where</p>
<p id="p-0225" num="0235">ALOSL_water=slope of ethanol/water injectors at low PW with water</p>
<p id="p-0226" num="0236">ALOSL_eth=slope of ethanol/water injectors at low PW with ethanol</p>
<p id="p-0227" num="0237">ALOSL_total=slope of ethanol/water injectors at low PW with ethanol/water mixture</p>
<p id="p-0228" num="0238">Substituting ALOSL_total into equation 1 yields:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>PW=OFFSET1+LBM_INJ_TOT/[WF*ALOSL_water+(1&#x2212;WF)*ALOSL_eth]&#x2003;&#x2003;[equation 3]<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0229" num="0239">Substituting LBM_INJ_TOT from equation 2 gives:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>PW=OFFSET1+[fuel_mass_ethanol/(1&#x2212;WF)]/[WF*ALOSL_water+(1&#x2212;WF)*ALOSL_eth], which can be rearranged to give:<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>WF*WF*(ALOSL_eth&#x2212;ALOSL_water)+WF*(ALOSL_water&#x2212;2*ALOSL_eth)+ALOSL_eth&#x2212;fuel_mass_ethanol/(PW&#x2212;OFFSET1)=0<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0230" num="0240">Expressing the injector's water slope as a constant multiplied by its ethanol slope gives ALOSL_water=k*ALOSL_eth, which can then be substituted into the previous equation as:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>WF*WF*(ALOSL_eth&#x2212;k*ALOSL_eth)+WF*(k*ALOSL_eth&#x2212;2*ALOSL_eth)+ALOSL_eth&#x2212;fuel_mass_ethanol/(PW&#x2212;OFFSET1)=0<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0231" num="0241">Solving the quadratic function yields two possible results, with the physically meaningful solution having WF greater than or equal to zero. Further, in this example, k should be greater than one because water has a higher density and lower viscosity than ethanol. Approximating injector flow with the equation for orifice flow, it becomes clear that k may also be less than two in this example. From this, the appropriate selection of the equation for WF can be obtained, which is set forth above herein in (7).</p>
<p id="p-0232" num="0242">Referring now specifically to <figref idref="DRAWINGS">FIG. 24</figref>, a routine is described for estimating a water fraction using the equations noted herein. In <b>2410</b>, the routine determine whether an engine start and/or refueling event in the tank for the water (or water blend) has occurred. If so, the routine continues to <b>2412</b> (if not, re-calculation of WF is not necessary). In <b>2412</b> the type 2 injection (e.g., water/ethanol injection) and fuel vapor purging systems are disabled, and stoichiometry for type 1 injection (e.g. gasoline) is calculated based on measured or inferred air mass and on feedback from the exhaust gas oxygen sensor. Then the routine continues to <b>2414</b> to determine whether the amount and/or ratio of type 2 injection is sufficient to provide accurate learning/estimation of a water fraction.</p>
<p id="p-0233" num="0243">If not, the routine increases the amount and/or frequency of type 2 injection in <b>2416</b> to increase sensitivity and/or accuracy of the measurement. Further, in <b>2416</b>, the routine may also purge a water/ethanol mixture through the fuel lines after a refueling event, to ensure that the inferred WF reading has sufficient accuracy and correlation to the mixture in the tank. The purging could involve bypassing the water/ethanol fuel rail on a return fuel system. In the example of a return-less fuel system, the WF inference process described above may continue for a sufficient time or number of injections to ensure that the water/ethanol mixture in the fuel lines has been used and the new mixture ratio is provided to the engine thus providing accurate estimates. This time can be calculated from the known volume of the fuel line and summation of the water/ethanol used during the WF inference process, if desired. Finally, the routine continues to <b>2418</b> to update the estimate of WF based on the sensed information using a rolling average filter, or other such filter.</p>
<p id="p-0234" num="0244">While the above approaches have been described for estimating a water fraction, various modifications and/or changes and/or additions may be used. For example, the estimation may occur at periodic intervals, or throughout engine operation, rather than only in response to an engine start or refueling event. Further, type 2 injection may be provided specifically for estimation, even when not needed to reduce knock, so that an estimate can be updated, or the estimate could be updated only when type 2 injection is needed to reduce knock.</p>
<p id="p-0235" num="0245">By providing an accurate estimate of the water fraction, it is possible to provide more accurate delivery via the type 2 injection and thus provide improved knock resistance and efficient use of the type 2 resources. An example of a routine to take advantageous use of such information is provided below with regard to <figref idref="DRAWINGS">FIG. 25</figref>.</p>
<p id="p-0236" num="0246">Referring now specifically to <figref idref="DRAWINGS">FIG. 25</figref>, a routine is described for controlling engine operation based on a water fraction of an ethanol/water blend in a tank provided via a direct injector or port injector to the engine, in addition to a gasoline injector (port or direct).</p>
<p id="p-0237" num="0247">In this example, various parameters are adjusted as the water fraction in a water/ethanol blend varies. For example, the measured or inferred water fraction may be used to control the amount of gasoline injection and the amount of water/ethanol injection for a given set of operating conditions. Further it may be used to adjust a desired air-fuel ratio and/or desired ethanol fraction due to changes in cooling and octane effects. It may be used to adjust injection pulse width of the water/ethanol injector in order to attain the desired mass flow of water and/or ethanol. It may also be used to limit maximum torque and/or power and/or boost to reduce engine degradation, at least under some conditions.</p>
<p id="p-0238" num="0248">The measured or inferred water fraction may also be used to vary injection timing. In particular, if the WF is close to one, then very late injection (during the expansion and/or exhaust stroke) can be used to control exhaust temperature. Such an approach may be used when there is little or no ethanol in the mixture, thus avoiding to potential emissions (e.g. HC, aldehydes, CO, etc.) that may be produced from the late injection of ethanol. In this way, late water injection for exhaust temperature control may be used under some conditions.</p>
<p id="p-0239" num="0249">Also, on a turbocharged engine, late injection may also be used to increase mass flow to the turbine, which may increase boost at low RPM and/or reduce turbo lag. While there may be a penalty from lowering temperature/energy to the turbine (which may offset the benefit of added mass flow), it may be possible to avoid or reduce this penalty by injecting at a time when the water spray is likely to impinge on the piston and/or cylinder walls. Such operation may avoid excessive cooling of the exhaust gas.</p>
<p id="p-0240" num="0250">In <b>2510</b>, the routine reads engine operating parameters, such as engine speed, engine load, etc. Then, in <b>2512</b>, the routine reads an estimated water fraction (WF) in an ethanol/water mixture, such as described above with regard to <figref idref="DRAWINGS">FIG. 24</figref>. Next, in <b>2514</b>, the routine determines a desired charge cooling or knock reduction based on current operation conditions, and optionally based on feedback from a knock sensor or other sensor indicative of knock.</p>
<p id="p-0241" num="0251">Then, in <b>2516</b>, the routine determines a desired quantity of type 2 injection based on the knock reduction needed and the water fraction. For example, as shown by <figref idref="DRAWINGS">FIG. 26</figref>, due to the greater charge cooling effect of water, as the water fraction increases, a smaller quantity (or PW) of type 2 injection may be desired. Further, as the water fraction increases, less adjustment to the type 1 injection (e.g., gasoline injection) is needed as less combustible fuel is provided via the type 2 injection, which compensation is provided via <b>2518</b> and <b>2520</b>. These determinations identify how much ethanol (or ethanol blend, or another alcohol or alcohol blend) is provided based on the amount determined in <b>2516</b>, and then determine the amount of adjustment to the type 1 injection. Then, in <b>2522</b>, the routine determines injection timings for the type 2 injection based on the water fraction and the value from <b>2516</b>. Finally, the PW limits are checked in <b>2524</b> and adjustments are made if necessary, as described herein above.</p>
<p id="p-0242" num="0252">Various advantages may be achieved by such operation. In one example, it is possible to use knowledge of the water fraction to provide a correct amount of charge cooling to reduce knock, even when the water fraction is changing. Further, it is possible to maintain accurate engine air-fuel ratio control and torque output by compensating for variability in water fraction by appropriate adjustment of the type 1 fuel injector based on the water fraction.</p>
<p id="p-0243" num="0253">In this way, it is possible to use water injection, or a blend of water injection, to increase compression ratio and/or boost pressure due to decreased knock at high loads, while also compensating for variability in the water fraction and alcohol (e.g., ethanol) fraction of the mixture. Further, a vehicle customer is able to achieve improved engine operation using one or both of water and an alcohol based fuel as a secondary injection in the engine. Further still, late injection for exhaust temperature control and/or increased boost at low RPM and/or reduced turbo lag can be provided with water injection, for example directly injected water or water blend.</p>
<p id="p-0244" num="0254">As noted above, <figref idref="DRAWINGS">FIG. 26</figref> shows the amount of type 2 injection for a given charge cooling amount. Note that while a linear curve is shown, this is just one example, and the curve may be nonlinear. Also note that this is just one curve shown for a single desired amount of charge cooling. A different curve may be used for each amount of charge cooling, providing a family of curves, as shown in <figref idref="DRAWINGS">FIG. 27</figref>.</p>
<p id="p-0245" num="0255">Referring now to <figref idref="DRAWINGS">FIG. 28</figref>, a routine is described for reacting to an indication of engine knock, such as from a knock sensor, cylinder pressure sensor, or other indication that knock is occurring, or is about to occur. In <b>2810</b> the routine reads current operating conditions, such as speed, load, etc. Then, in <b>2812</b>, the routine determines whether a measure of knock from knock sensor <b>182</b> has reached a threshold value thus providing an indication of knock. As noted above, various other indications may be used, if desired.</p>
<p id="p-0246" num="0256">If knock is indicated in <b>2812</b>, the routine continues to <b>2814</b> to determine whether type 2 injection is enabled and whether additional type 2 injection/fueling is feasible. In other words, the routine determines whether conditions are acceptable to use any type 2 injection, such as, for example, coolant temperature, whether type 2 fuel is depleted, and various others as noted herein, and whether type 2 pulsewidth is less than maximum. If not, the routine proceeds to <b>2816</b> to retard spark timing to reduce knock, and then takes additional actions in <b>2818</b>, optionally, if necessary, such as reducing airflow, etc.</p>
<p id="p-0247" num="0257">If the answer to <b>2814</b> is yes, the routine proceeds to <b>2820</b> to increase type 2 injection (e.g., ethanol injection) and correspondingly decrease type 1 injection to reduce a tendency for knock, assuming that it is possible to increase type 2 injection and/or decrease type 1 fuel injection. Alternatively, the desired ethanol fraction (EF) may be increased to increase a relative amount of ethanol to gasoline, assuming it is possible to further increase the fraction. In other words, resort to spark retard and other operations as noted herein to reduce knock may be used if type 2 injection is near a maximum available amount. Thus, spark may optionally be retarded relative to its current timing before or concurrently with the type 2 injection increase in <b>2822</b>, and then returned once the fuel adjustments have been effective. Note that the combination of spark timing and fuel adjustment may be beneficial in that the spark timing change may have a faster response on knock than the fuel change under some conditions. However, once the fuel adjustment has been effected, the spark timing may be returned to avoid fuel economy losses. In this way, fast response and low losses can be achieved. Under other conditions, only spark adjustments, or fuel adjustments without spark adjustments may be used so that even temporary retard of spark timing is reduced.</p>
<p id="p-0248" num="0258">Various examples of such alternative operation are shown in the graphs of <figref idref="DRAWINGS">FIG. 29</figref>, which show an indication of knock in the top graph (where the dashed line is a limit above which knock is identified, where the threshold may be variable with operating conditions), spark timing relative to a reference (dashed line) in the second graph, type 1 injection amount (e.g., port fuel amount) in the third graph, and type 2 injection amount (e.g., direct cylinder alcohol containing fuel amount) in the bottom graph.</p>
<p id="p-0249" num="0259">In this example, at time t<b>1</b> an indication of knock rises above a threshold value and the spark timing is retarded while the type 1 and type 2 injection amounts are also adjusted. In this case, the fuel adjustments are offsetting in direction and of different amounts to account for the different power density and stoichiometric air-fuel ratio between the fuel types. The spark timing is than returned to avoid further fuel economy losses.</p>
<p id="p-0250" num="0260">Then, at t<b>2</b>, the engine output torque is gradually increased by increasing airflow and respective fuel amounts until at t<b>3</b>, an indication of knock is again generated. At t<b>3</b>, the routine adjusts type 1 and type 2 injection amounts without additional spark retard to reduce knock, while still increasing the total fuel injection energy. Then, fuel injections and airflow increases, and then decreases until at time t<b>4</b> knock again reaches a threshold value. At this point, spark timing is retarded until t<b>5</b>, at which point the fuel injection amounts are adjusted, while still continuing to reduce the total amount of fuel energy. At t<b>5</b>, the effect of the relative fuel adjustment between the fuel types takes effect and the spark timing may be gradually returned to its desired position to avoid further fuel economy losses from retarded ignition timing.</p>
<p id="p-0251" num="0261">In this way, it is possible to provide varying levels of total fuel injection amounts, while varying the relative amounts of fuel types and ignition timing to reduce knock.</p>
<p id="p-0252" num="0262">Referring now to <figref idref="DRAWINGS">FIG. 30</figref>, an alternative engine starting routine is described that may be used. In this example, the routine controls fuel injection type, and amount, based on a fueled cylinder event strategy. Various methods may be used to identify a cylinder event, such as by decoding engine position based on cam sensor and crank sensor signals. A cylinder event signal identifies when a given engine cylinder reaches top-dead-center of compression stroke, in one example. Alternatively, other cylinder events may be used.</p>
<p id="p-0253" num="0263">In step <b>3010</b>, engine operating conditions are read. Measured or inferred operating conditions such as engine coolant temperature, catalyst temperature, time since engine last operated (soak time), and other parameters may be used. These parameters may be used to compensate the engine fuel request in <b>3024</b>, described below. These parameters can influence engine operation in different ways depending on their state. For example, low engine coolant temperatures may lead to air-fuel enrichment, but normal engine coolant temperatures may lead to stoichiometric air-fuel.</p>
<p id="p-0254" num="0264">In <b>3012</b>, the routine decides to proceed based on whether the engine is rotating. If the engine is not rotating, the routine waits until a crank position sensor detects engine rotation. If the engine is rotating, the routine proceeds to <b>3014</b>. In <b>3014</b>, the controller determines if a cylinder event has occurred, if so, the routine proceeds to step <b>3016</b>. If no new cylinder events have occurred, the routine waits until a cylinder event is observed. In step <b>3016</b>, the routine determines if synchronization between controller <b>12</b> and engine <b>10</b> has occurred. Synchronization can occur when engine timing is aligned with engine controller operation. If synchronization has occurred, the routine proceeds to step <b>3018</b>, if not, the routine proceeds to step <b>3020</b>.</p>
<p id="p-0255" num="0265">In <b>3018</b>, the number of fueled cylinder events is incremented since a cylinder event has been detected and the engine and controller <b>12</b> are in synchronization, thus indicating that fuel delivery may occur. The number of fueled cylinder events may then be used to determine an amount of fuel to be delivered to the cylinder or cylinders currently being fueled. Further, as noted below, is may also be used to select where fuel is delivered and/or a type of fuel delivered and/or when during a cycle fuel is delivered. For example, injection timing may be varied based on a number of fueled cylinder events. Likewise, a selection of type 1 and/or type 2 fuel may be based on a number of fueled cylinder events as noted in <b>3023</b> below. Further, a selection of a desired air/fuel ratio (or relative air-fuel ratio) may be based on a number of fueled cylinder events.</p>
<p id="p-0256" num="0266">Note that alternatively to, or in addition to a number of fueled cylinder events, a number of combustion cylinder events and/or other factors may be used.</p>
<p id="p-0257" num="0267">Continuing with <figref idref="DRAWINGS">FIG. 30</figref>, in <b>3020</b>, the routine observes cam and crank signals that allow determination of engine position. When engine position is established, engine controller <b>12</b> aligns operations, spark and fuel delivery, to engine timing, becoming synchronized. Fuel delivery may be suspended until synchronization occurs in this example. Upon synchronization the fueled cylinder event counter is set to zero and the routine continues to <b>3022</b> where an engine air amount prediction is retrieved from an engine air amount algorithm. Alternatively, a mass air flow meter may be used to determine the engine air amount. By integrating the air mass signal over a cylinder event and then predicting future engine air amounts by extrapolation, using previous engine air amounts, a predicted engine air amount can be calculated.</p>
<p id="p-0258" num="0268">In <b>3023</b>, the routine selects a fuel type based on the number of fueled cylinder events. For example, where different fuels are injected (e.g., port gasoline and direct injection ethanol), a port injector may be used to inject gasoline into each cylinder on an event basis (i.e., each cylinder has a unique amount of fuel injected based on the combustion event number). After a predetermined number of events, inferred cylinder temperature, time, and/or other factors, the engine could be transitioned over to direct injection. For example, both injection types may be enabled after a selected number of events, or only direct injection may be used after a selected number of events.</p>
<p id="p-0259" num="0269">In <b>3024</b>, a desired air-fuel ratio for the up coming fueled cylinder event is determined based on a number of fueled cylinder events and other factors, such as coolant temperature, etc.</p>
<p id="p-0260" num="0270">In <b>3026</b>, individual cylinder fuel mass is calculated based on the desired air-fuel ratio calculated in <b>3024</b>, predicted engine air amount retrieved from <b>3022</b>, and the fuel type selected in <b>3023</b>. If two fuel types are selected, the calculation for each fuel type is performed by further using a desired ratio or fraction of fuel types, which may be a function of engine speed, load, and/or other operating parameters. Further, other modifications may be used based on fuel puddle dynamics for any fuel injected via a port injector.</p>
<p id="p-0261" num="0271">In <b>3028</b>, the fuel pulse width(s) is(are) determined from the calculated fuel mass(es) and a function that represents the time to deliver a given fuel mass, and the respective injector slopes/offsets. The routine then continues on to <b>3030</b> where injectors are activated to deliver the desired fuel masses. The routine then advances to <b>3032</b>. In <b>3032</b>, the routine passes the fueled cylinder event number to a spark delivery routine that can adjust spark based on the fueled cylinder event number and cylinder burn rate. Typically, desired spark is advanced if the burn rate is slower and retarded if the burn rate is faster. The burn rate may be determined by the cylinder design and type of fuel, e.g., gasoline, ethanol, methanol, or blend. Base spark timing is retrieved from predetermined values stored in a table. The base spark table has x indices of engine coolant temperature and y indices of fueled cylinder events. If the burn rate of the fuel being used changes, a function FNBUR_SPK, alters the spark demand by adding an offset to the base spark. FNBUR_SPK is empirically determined and outputs spark offset as a function of burn rate. As the burn rate changes, depending on the fuel type, spark is advanced or retarded appropriately. In other words, the base spark angle that is based on the number of fueled cylinder events is modified based on cylinder burn rate. By linking spark angle to cylinder burn rate and fueled cylinder events, engine emissions can be reduced on a variety of fuel types. The routine then continues to <b>3034</b>.</p>
<p id="p-0262" num="0272">In <b>3034</b>, engine operating conditions are evaluated to determine if closed loop fuel control is desired. Common signals used to determine desired closed loop engine operation include; time since start, exhaust gas sensor temperature, engine coolant temperature, and engine load. If closed loop fuel control is desired the routine proceeds to <b>3036</b> where fuel control transitions from open loop control to closed loop control by ramping fuel toward the desired air-fuel ratio, which may be stoichiometry. If closed loop fuel control is not desired the routine exits until it is called again to determine fuel for the next cylinder. Closed loop control may be executed as described above herein.</p>
<p id="p-0263" num="0273">Alternatively, another embodiment delivers fuel based on the number of fueled cylinder events then transitions to time based fuel delivery. This method benefits from the advantages of fueling based on the number of fueled cylinder events during starting then reduces computations by using time based fueling. In another alternative, simultaneous use of fueled cylinder event based and time based fueling is provided. Event based fueling offers the before-mentioned advantages. Time based fueling permits simplified calibration of fuel compensation for slower changing conditions, such as fuel vaporization. By using both methods, fuel amount can be compensated for both engine conditions that change slowly and engine conditions that change rapidly.</p>
<p id="p-0264" num="0274">In still another embodiment, non-sequential fueling may also be used on an event basis.</p>
<p id="p-0265" num="0275">The above routine can achieve various advantages since the routine can provide selective fuel delivery on an individual cylinder basis. By determining individual cylinder fuel amounts and types, individual cylinder mixtures and combustion may be better controlled.</p>
<p id="p-0266" num="0276">Referring now to <figref idref="DRAWINGS">FIGS. 31-34</figref>, routines for controlling and adapting to fuel vapor purging as well as injector and airflow sensor errors is described. Specifically, in <figref idref="DRAWINGS">FIG. 31</figref>, a routine for controlling a single source (e.g., valve) of fuel vapors (such as shown in <figref idref="DRAWINGS">FIG. 8</figref> or <b>10</b>, for example), which may be from one or more tanks or storage canisters, is described. Specifically, in <b>3110</b>, the routine determines whether fuel vapor purging is requested. The request may be based on various operating conditions, such as speed, load, temperature, etc. Next, in <b>3112</b>, the routine adjusts a purge valve to provide a desired amount of flow into the intake manifold. The desired amount of flow may include gradually ramping the flow up when first enabling purging, and varying the flow with operating conditions, such as speed and load, for example.</p>
<p id="p-0267" num="0277">In <b>3114</b>, the routine adjusts fuel injection from one or more injectors per cylinder based on feedback from exhaust gas oxygen sensors to maintain a desired air-fuel ratio. In addition, compensation based on a feedforward estimate of vapors in the purge flow may be used, if desired. The adjustment of fuel injection may utilize various types of air-fuel ratio control, such as, for example, the approach described herein with respect to <figref idref="DRAWINGS">FIG. 11</figref>. The approach may include injector selection based on various additional factors, such as whether injectors are active, or based on a content of vapors in the purge flow, as described in more detail with regard to <figref idref="DRAWINGS">FIG. 33</figref>. Further, the selection may be based on minimum and/maximum injector pulsewidth values, as well as other operating conditions. In one embodiment, a port injector injecting gasoline may be adjusted as purge flow and/or concentration varies. In another embodiment, a direct injector injecting a mixture containing an alcohol may be adjusted as purge flow and/or concentration varies. In still another embodiment, combinations of variation of both port and direct injectors may be used.</p>
<p id="p-0268" num="0278">Continuing with <figref idref="DRAWINGS">FIG. 31</figref>, in <b>3116</b> the routine learns a vapor concentration and/or composition in the purge flow, and then learns fuel injector(s) and air meter aging values, as described herein with regard to <figref idref="DRAWINGS">FIG. 34</figref>.</p>
<p id="p-0269" num="0279">In this way, it is possible to provide robust compensation for fuel vapor purging even when the content of the vapor varies, while still maintaining a desired overall amount of fuel types during combustion. For example, where the vapor may contain varying amounts of gasoline and ethanol, the routine can appropriately use compensation of gasoline and ethanol injection to maintain desired total amount of combustion gasoline and ethanol under varying operating conditions. Further, it is possible to provide compensation even when one fuel type is depleted or not enabled during the current operating conditions, thus providing improved opportunity to purge fuel vapors.</p>
<p id="p-0270" num="0280">Referring now to <figref idref="DRAWINGS">FIG. 32</figref>, a routine similar to that of <figref idref="DRAWINGS">FIG. 31</figref> is described, except that more than one purge control valve may be provided. In this specific example, two valves are provided. In one example, the valves can control vapors from different fuel sources, such as shown with regard to <figref idref="DRAWINGS">FIG. 9</figref>. First, in <b>3210</b>, the routine determines whether fuel vapor purging is requested. The request may be based on various operating conditions, such as speed, load, temperature, etc. Next, in <b>3212</b>, the routine selects a number of active purge valves to be operated. For example, under some conditions, a first valve may be used to enable fuel vapor purging of only a first fuel type, and under other conditions, a second valve may be used to enable fuel vapor purging of only a second fuel type. These conditions may include the amount of vapors generated in the respective systems, temperature, speed, load, desired ethanol fraction, or others. In another example, the routine may enable purging of from both valves during common operating conditions, and concurrently with each other. Thus, in <b>3214</b>, the routine determines whether single purge valve operation, or multiple purge valve operation, is selected.</p>
<p id="p-0271" num="0281">If single operation is selected, the routine continues to <b>3216</b> to select which valve should be active. For example, purging from different valves may alternatively be activated so that both systems are able to purge fuel vapors. The relative amounts and durations of activation can be varied with operating conditions and/or with desired ethanol fraction. For example, purging from the ethanol system may be preferred when higher ethanol fraction is desired. Also, systems having higher volatility fuels may need additional amounts of purging (such as greater flows, longer durations, etc.). Next, in <b>3218</b>, the routine adjusts the selected purge valve to provide a desired flow amount.</p>
<p id="p-0272" num="0282">Alternatively, if dual purge valve operation is selected, the routine continues to <b>3220</b> to adjust a first purge valve to provide a first desired flow amount, and then to <b>3222</b> to adjust a second purge valve to provide a second desired flow amount. Then, from either <b>3222</b> or <b>3218</b>, the routine continues to <b>3224</b> to adjust fuel injection of one or more fuel injectors per cylinder to compensate for the fuel vapors based on exhaust gas oxygen sensor feedback and optionally feedforward estimates. As noted above, such operation may include selection and variation of which injector provides adjustment based on operating conditions, as well as selection criteria described with regard to <figref idref="DRAWINGS">FIG. 11</figref> and <figref idref="DRAWINGS">FIG. 33</figref>.</p>
<p id="p-0273" num="0283">Continuing with <figref idref="DRAWINGS">FIG. 32</figref>, in <b>3226</b> the routine learns a vapor concentration and/or composition in the purge flow, and then learns fuel injector(s) and air meter aging values in <b>3228</b>, as described herein with regard to <figref idref="DRAWINGS">FIG. 34</figref>.</p>
<p id="p-0274" num="0284">In this way, it is possible to provide robust compensation for fuel vapor purging even when the content of the vapor varies, while still maintaining a desired overall amount of fuel types during combustion. For example, where the vapor may contain varying amounts of gasoline and ethanol, the routine can appropriately use compensation of gasoline and ethanol injection to maintain desired total amount of combustion gasoline and ethanol under varying operating conditions. Further, it is possible to provide compensation even when one fuel type is depleted or not enabled during the current operating conditions, thus providing improved opportunity to purge fuel vapors. Finally, it is possible to provide desired purging of more than one fuel type.</p>
<p id="p-0275" num="0285">Referring now to <figref idref="DRAWINGS">FIG. 33</figref>, a routine is described for selecting injectors to provide compensation for fuel vapor purging from one or more fuel vapor purge control valves and/or one or more fuel types contain in fuel vapors. In this example, the routine selects one or more injectors per cylinder to provide adjustment to fuel vapors based on content of the vapors, as well as other factors, to maintain a desired air-fuel ratio. In one embodiment, such operation provides an ability to maintain a desired overall relative amount or ratio of different fuel types. Specifically, in <b>3310</b>, the routine determines whether fuel vapor purge compensation is enabled. If so, the routine continues to <b>3312</b> to determine whether compensation for type 1 fuel contained in the purge flow is requested. In one embodiment, the routine determines whether type 1 fuel is contained in the vapors being purged into the engine. If so, the routine continues to <b>3314</b> to determine whether type 1 injection is enabled at the current conditions. If so, the routine adjusts type 1 injection to compensate for type 1 fuel in the fuel vapors based on feedback from exhaust gas oxygen sensors and possibly using feedforward estimates of vapor contents in <b>3316</b>. In this way, an increase in type 1 fuel attributed to fuel vapor purge can be compensated by a corresponding decrease in type 1 fuel injected into the cylinder, thus provide accurate air-fuel control and maintenance of a desired amount of type 1 fuel at the given operating conditions.</p>
<p id="p-0276" num="0286">Alternatively, when the answer to <b>3314</b> is no, the routine continues to <b>3318</b> to adjusts type 2 injection to compensate for type 1 fuel in the fuel vapors based on feedback from exhaust gas oxygen sensors and possibly using feedforward estimates of vapor contents. While this may vary the amount of fuel types in the cylinder, it is still possible to maintain a desired air-fuel ratio, and thus improve emission control even when type 1 fuel injection may be disabled, such as due to degradation.</p>
<p id="p-0277" num="0287">The routine then continues from either <b>3316</b> or <b>3318</b> or a NO in <b>3312</b> to <b>3320</b>. In <b>3320</b>, the routine determines whether compensation for type 2 fuel contained in the purge flow is requested. In one embodiment, the routine determines whether type 2 fuel is contained in the vapors being purged into the engine. If so, the routine continues to <b>3322</b> to determine whether type 2 injection is enabled at the current conditions. If so, the routine adjusts type 2 injection to compensate for type 2 fuel in the fuel vapors based on feedback from exhaust gas oxygen sensors and possibly using feedforward estimates of vapor contents in <b>3324</b>. In this way, an increase in type 2 fuel attributed to fuel vapor purge can be compensated by a corresponding decrease in type 2 fuel injected into the cylinder, thus providing accurate air-fuel control and maintenance of a desired amount of type 2 fuel at the given operating conditions.</p>
<p id="p-0278" num="0288">Alternatively, when the answer to <b>3322</b> is no, the routine continues to <b>3326</b> to adjust type 1 injection to compensate for type 2 fuel in the fuel vapors based on feedback from exhaust gas oxygen sensors and possibly using feedforward estimates of vapor contents. While this may vary the amount of fuel types in the cylinder, it is still possible to maintain a desired air-fuel ratio, and thus improve emission control even when type 2 injection may be disabled, such as due to degradation.</p>
<p id="p-0279" num="0289">Note that in an alternative embodiment, the routine may vary different fuel injector amounts for a cylinder based on the type of vapors being purged and/or based on a quantity of types of vapors being purged.</p>
<p id="p-0280" num="0290">Referring now to <figref idref="DRAWINGS">FIG. 34</figref>, a routine is described for adaptively learning corrections in the air and fuel metering system, such as fuel injector corrections, for system configurations having multiple fuel injectors per cylinder, such as the various examples described herein, or for systems having multiple fuel metering devices for different fuel types, such as <figref idref="DRAWINGS">FIG. 36</figref> or <b>37</b>, for example.</p>
<p id="p-0281" num="0291">In one particular embodiment where one injection type is a fuel such as gasoline (which may be port or directly injected) and a second injection type includes an alcohol containing fuel (such as ethanol, or an ethanol blend, which may be port or directly injected), a method is provided that takes advantage of regression techniques to independently determine the characteristics of the elements of the air and fuel metering system. In one example, a routine may be used that schedules the injection of type 2 injection as a function of an engine parameter, such as air mass or load, and then learns an air and fuel correction as a function of that engine parameter. Thus, if the injection of alcohol via the in-cylinder injectors is scheduled strictly as a function of air mass, an adaptive system that determines an air fuel correction as a function of air mass may be used to correct for an air fuel error from a system with air meter errors (slope) and primary and secondary injector errors (slope and offset).</p>
<p id="p-0282" num="0292">However, if the amount of type 2 injection varies with other parameters, such as in response to temperature and/or knock sensor feedback or exhaust gas oxygen sensor feedback, an alternative approach may be used. Specifically, in this example, the approach described in U.S. Pat. No. 6,138,655 (which is incorporated herein by reference) may be adapted and modified. The method may include air mass squared and purge volume squared terms based on vehicle experience. Further, different algorithms may be used, such as the Potters Square Root algorithm or the Recursive Least Squares algorithm depending on numerical stability issues.</p>
<p id="p-0283" num="0293">In particular, by determining the coefficients of the following equation, improved adaptive learning of air and fuel errors may be achieved:</p>
<p id="p-0284" num="0294">
<maths id="MATH-US-00003" num="00003">
<math overflow="scroll">
<mrow>
  <mi>FuelCorrection</mi>
  <mo>=</mo>
  <mrow>
    <msub>
      <mi>a</mi>
      <mn>0</mn>
    </msub>
    <mo>+</mo>
    <mrow>
      <msub>
        <mi>a</mi>
        <mn>1</mn>
      </msub>
      <mo>*</mo>
      <mi>AirMass</mi>
    </mrow>
    <mo>+</mo>
    <mrow>
      <msub>
        <mi>a</mi>
        <mn>2</mn>
      </msub>
      <mo>*</mo>
      <msup>
        <mi>AirMass</mi>
        <mn>2</mn>
      </msup>
    </mrow>
    <mo>+</mo>
    <mrow>
      <msub>
        <mi>a</mi>
        <mn>3</mn>
      </msub>
      <mo>*</mo>
      <mi>RPM</mi>
    </mrow>
    <mo>+</mo>
    <mrow>
      <msub>
        <mi>a</mi>
        <mn>4</mn>
      </msub>
      <mo>*</mo>
      <mi>PurgeVolume</mi>
    </mrow>
    <mo>+</mo>
    <mrow>
      <msub>
        <mi>a</mi>
        <mn>5</mn>
      </msub>
      <mo>*</mo>
      <msup>
        <mi>PurgeVolume</mi>
        <mn>2</mn>
      </msup>
    </mrow>
    <mo>+</mo>
    <mrow>
      <msub>
        <mi>a</mi>
        <mn>6</mn>
      </msub>
      <mo>*</mo>
      <mi>SecondaryInjectorPulsewidth</mi>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0285" num="0295">Where &#x201c;SecondaryInjectorPulsewidth&#x201d; refers to pulsewidth of a type 2 injector, for example. The coefficient in this term would be updated only when the secondary injection is active using a series of liner regressions that can be separately enabled. Alternatively, rather than using pulsewidth, secondary injector flow may also be used. Also it may be advantageous to add terms such as secondary injector flow or pulsewidth squared and/or secondary injections per minute to account for non-linearities such as errors in the injector offset. Further, in still another alternative, the air mass and air mass squared terms may be replaced with type 1 fuel flow and type 1 fuel flow squared. Thus, in an alternative approach, the following may be used:</p>
<p id="p-0286" num="0296">
<maths id="MATH-US-00004" num="00004">
<math overflow="scroll">
<mrow>
  <mi>FuelCorrection</mi>
  <mo>=</mo>
  <mrow>
    <mo>&#x2003;</mo>
    <mrow>
      <msub>
        <mi>A</mi>
        <mn>1</mn>
      </msub>
      <mo>+</mo>
      <mrow>
        <msub>
          <mi>A</mi>
          <mn>2</mn>
        </msub>
        <mo>*</mo>
        <mi>PrimaryFuelFlow</mi>
      </mrow>
      <mo>+</mo>
      <mrow>
        <msub>
          <mi>A</mi>
          <mn>3</mn>
        </msub>
        <mo>*</mo>
        <msup>
          <mi>PrimaryFuelFlow</mi>
          <mn>2</mn>
        </msup>
      </mrow>
      <mo>+</mo>
      <mrow>
        <msub>
          <mi>A</mi>
          <mn>4</mn>
        </msub>
        <mo>*</mo>
        <mi>RPM</mi>
      </mrow>
      <mo>+</mo>
      <mrow>
        <msub>
          <mi>A</mi>
          <mn>5</mn>
        </msub>
        <mo>*</mo>
        <mi>SecondaryFuelFlow</mi>
      </mrow>
      <mo>+</mo>
      <mrow>
        <msub>
          <mi>A</mi>
          <mn>6</mn>
        </msub>
        <mo>*</mo>
        <mi>PurgeVolume</mi>
      </mrow>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0287" num="0297">Referring now to <figref idref="DRAWINGS">FIG. 34</figref>, a routine describes one example embodiment for adaptively learning errors.</p>
<p id="p-0288" num="0298">First, in <b>3440</b>, the routine determines whether the vehicle is operating under near steady state conditions, such as based on a rate of change of engine speed, vehicle speed, pedal position, fuel flow, injector pulsewidth(s), throttle position, or combinations thereof. For example, if the variation in input parameters is below an acceptable level (e.g., engine speed, fuel flow), updates to the coefficients related to speed and fuel flow may have increased error. Therefore, in steady state, the routine proceeds to <b>3432</b>. If enough activity is present (driven by transient operating conditions), the routine proceeds to <b>3412</b>. In <b>3412</b>, the routine determines whether sufficient time has passed to perform an update. In this way, it is possible to provide the opportunity to slow down or speed up the adaptive routine by only providing a pre-determined delay between coefficient updates. If it is not yet time to perform updates to the parameters, the routine jumps to step <b>3432</b>. Otherwise, continue to <b>3414</b>.</p>
<p id="p-0289" num="0299">In <b>3414</b>, the routine updates adaptive coefficients b1, b2, b3, and b4 using a regression in the equation:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>FuelErr=<i>b</i>1+<i>b</i>2*PriFuel+<i>b</i>3*PriFuel^2+<i>b</i>4*RPM<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0290" num="0300">where: FuelErr is the difference between the commanded fuel flow and &#x201c;measured&#x201d; fuel flow (equal to measured air flow divided by the air fuel ratio measured in the exhaust); PriFul is the commanded fuel to be injected by the primary injectors&#x2014;for example, gasoline injected into the intake ports; PriFul^2 equals PriFul squared; and RPM is the measured engine speed.</p>
<p id="p-0291" num="0301">One method that could be used to perform the regression is the commonly known &#x201c;recursive least squares&#x201d; method. Alternatively, &#x201c;Potters square root&#x201d; algorithm may also be used. Having completed the update of the coefficients, the routine continues to <b>3416</b> to determine if the secondary injection (e.g. in cylinder injection of alcohol or an ethanol blend, for example) is active or has been active recently. In this example, a regression of secondary injection data is not enabled until the secondary injection has been enabled, or was recently enabled. Once secondary injection is disabled, the routine may continue the regression for a short, predetermined, time to collect data at zero or low secondary fuel flow. Thus, if the secondary injection is not active, the routine continues to <b>3430</b>. Otherwise, the routine continues to <b>3418</b>.</p>
<p id="p-0292" num="0302">The following acts performed by the routine are directed to determining the coefficients of the fuel correction equation described herein. However, since portions of this regression may only be performed at certain times, or under selected conditions, (e.g., when sufficient modulation of the independent variables (primary and secondary fuel flow, engine speed, purge flow, or others) is available), the regression may be performed via a series of regressions of the various terms. Also, regarding determination of the terms related to the secondary injection, in one approach it may be advantages to independently control the secondary injection from the above parameters, e.g., by selecting values that were statistically independent of the engine speed and primary fuel flow or others. However, the secondary flow may be based on one or more of these parameters to provide the desired engine response. As a result, there is the potential for some degree of correlation between the secondary injection and these terms. Therefore, in one approach, it may be beneficial to determine how the secondary injection correlates with the terms, and subtract the correlated, and already compensated for, effects of secondary injection. To do this a similar approach as used above in <b>3414</b> may be used to update the coefficients of the equation:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>SecInj=<i>c</i>1+<i>c</i>2*PriFul+<i>c</i>3*PriFul^2+<i>c</i>4*RPM<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0293" num="0303">where: SecInj is the commanded secondary fuel flow; and c1, c2, c3, and c4 are the coefficients being updated. Further, since some of the same independent variables are being used again, some of the intermediate matrices calculated for recursive least squares or Potters square root algorithm may be used from above and may not need to be re-calculated.</p>
<p id="p-0294" num="0304">Having determined the coefficients for the correlated secondary fuel flow in <b>3418</b>, in <b>3420</b> the routine determines how much of the current secondary fuel flow, at the current operating conditions, has already been accounted by applying those coefficients. Subtracting the correlated secondary fuel flow from the actual secondary fuel flow in step <b>3422</b> gives the secondary fuel flow residuals that may be used in <b>3428</b>.</p>
<p id="p-0295" num="0305">In <b>3424</b>, the routine determines how much of the fuel error has already been accounted for by the regression in <b>3414</b> by using the updated values of the coefficients b1 through b4 and the current operating conditions. In <b>3426</b>, the routine determines the unaccounted for fuel error (fuel error residuals) that are available for the regression in <b>3428</b>. In <b>3428</b>, the routine updates the coefficient for the equation:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>FuelResid=<i>d</i>*SecFlResid<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0296" num="0306">where: FulResid is the residual fuel error calculated in <b>3426</b>; SecFlResid is the residual secondary fuel from step <b>3422</b>; and d is the coefficient to be determined. A similar approach as in <b>3414</b> may be used, with a different independent variable, and thus previous intermediate matrices are not re-used.</p>
<p id="p-0297" num="0307">It may be advantageous to expand the regression performed in <b>3428</b> to include additional terms such as secondary fuel flow squared to account for nonlinearities in the secondary fuel flow error. In this case the equation and coefficients to be updated could be of the form:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>FuelResid=<i>d</i>1*SecFlResid+<i>d</i>2*SecFlResid^2<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0298" num="0308">Where: SecFlResid^<b>2</b> is the secondary fuel residuals squared.</p>
<p id="p-0299" num="0309">Having determined the correlation between fuel errors, primary and secondary fuel flow, and engine speed, the routine now combines the terms from the previous regressions in step <b>3430</b> as follows:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>e</i>1<i>=b</i>1&#x2212;(<i>c</i>1<i>*d</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>e</i>2=<i>b</i>2&#x2212;(<i>c</i>2*<i>d</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>e</i>3<i>=b</i>3&#x2212;(<i>c</i>3<i>*d</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>e</i>4<i>=b</i>4&#x2212;(<i>c</i>4<i>*d</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>e</i>5<i>=d </i><?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0300" num="0310">to get the coefficients for the equation that describes the expected fuel error without considering the effects of carbon canister purge:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>FulNoP=<i>e</i>1<i>+e</i>2*PriFul+<i>e</i>3*PriFul^2+<i>e</i>4*RPM+<i>e</i>5*SecInj<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0301" num="0311">This equation is used in step <b>3434</b>, and the coefficients are again used in <b>3456</b>.</p>
<p id="p-0302" num="0312">Again, the routine updates coefficients for an equation if the independent variables are significantly changing. For carbon canister purge, however, it once it has been enabled and stabilized from the initial opening, the flow may be modulated to improve regression results, if desired. For example, it may be modulated independently from variable such as injector flow, speed, etc.</p>
<p id="p-0303" num="0313">Continuing with <figref idref="DRAWINGS">FIG. 34</figref>, the routine determines at <b>3432</b> whether the purge flow has been enabled and is currently being modulated. If the purge has not yet been enabled (e.g. following a cold start), the routine proceeds to <b>3456</b>. Otherwise, the routine continues to <b>3434</b> through <b>3454</b> to determine how the carbon canister purge is contributing to the measured fuel flow errors.</p>
<p id="p-0304" num="0314">In <b>3434</b>, the routine determines how much of the fuel error has already been accounted for above. Then, in <b>3436</b>, the routine determines the residual fuel errors that may be caused by the canister purge flow. Next, in <b>3438</b>, <b>3440</b>, and <b>3442</b>, the routine determines how the canister purge correlates to the primary fuel flow and engine speed and calculates the residual (unaccounted for) canister purge. These steps are similar to some above and thus may re-use some intermediate calculations, if desired.</p>
<p id="p-0305" num="0315">If secondary injection has been active, the routine also determines how the canister purge correlates to the secondary fuel flow, where the decision to make this determination is made in step <b>3444</b>. Next, in <b>3446</b>, the routine performs correlation between the purge residuals and the secondary fuel flow residuals to update coefficient g. If, in <b>3428</b>, a regression with an additional term such as secondary fuel flow squared was used, this term would also be included here. Again, since the inputs to the regression are similar to those in <b>3428</b>, some intermediate values used in the regression can be reused. If secondary injection is not active, the routine proceeds to <b>3446</b>, and in either case, to <b>3448</b>.</p>
<p id="p-0306" num="0316">In <b>3448</b>, the routine combines the coefficients related to the canister purge flow using the technique to arrive at the equation used in <b>3450</b>:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>CorPgVol2<i>=h</i>1<i>+h</i>2*PriFul+<i>h</i>3*PriFul^2+<i>h</i>4*RPM+<i>h</i>5*SecInj<?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0307" num="0317">This equation gives the purge volume that correlates to, and has already been accounted for, in the regressions from steps <b>3414</b> through <b>3430</b>.</p>
<p id="p-0308" num="0318">Continuing with <figref idref="DRAWINGS">FIG. 34</figref>, in <b>3450</b> through <b>3454</b>, the routine determines how the fuel error residuals correlate to the canister purge flow residuals in a manner similar to that above. Again, it may be advantageous to add a purge volume squared term to the regression, under some examples. This term would account for changes in the fuel content of the purge flow as the purge flow changes and may also tend to account for errors in the estimated purge flow that are likely at low purge flow rates.</p>
<p id="p-0309" num="0319">Having determined the effects of the various independent parameters in the above series of regressions, at <b>3456</b>, the routine combines the coefficients to determine the final fuel correction equation used in step <b>3458</b>. The coefficients are combined as follows:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>A</i>1<i>=e</i>1&#x2212;(<i>h</i>1<i>*d</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>A</i>2<i>=e</i>2&#x2212;(<i>h</i>2<i>*d</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>A</i>3<i>=e</i>3&#x2212;(<i>h</i>3<i>*d</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>A</i>4<i>=e</i>4&#x2212;(<i>h</i>4<i>*d</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>A</i>5<i>=e</i>5&#x2212;(<i>h</i>5<i>*I</i>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>A</i>6<i>=I </i><?in-line-formulae description="In-line Formulae" end="tail"?>
</p>
<p id="p-0310" num="0320">to provide the final fuel correction equation:</p>
<p id="p-0311" num="0321">
<maths id="MATH-US-00005" num="00005">
<math overflow="scroll">
<mrow>
  <mi>Correction</mi>
  <mo>=</mo>
  <mrow>
    <mrow>
      <mi>A</mi>
      <mo>&#x2062;</mo>
      <mstyle>
        <mspace width="0.3em" height="0.3ex"/>
      </mstyle>
      <mo>&#x2062;</mo>
      <mn>1</mn>
    </mrow>
    <mo>+</mo>
    <mrow>
      <mi>A</mi>
      <mo>&#x2062;</mo>
      <mstyle>
        <mspace width="0.3em" height="0.3ex"/>
      </mstyle>
      <mo>&#x2062;</mo>
      <mn>2</mn>
      <mo>*</mo>
      <mi>PortFul</mi>
    </mrow>
    <mo>+</mo>
    <mrow>
      <mi>A</mi>
      <mo>&#x2062;</mo>
      <mstyle>
        <mspace width="0.3em" height="0.3ex"/>
      </mstyle>
      <mo>&#x2062;</mo>
      <mn>3</mn>
      <mo>*</mo>
      <mrow>
        <mi>PortFul</mi>
        <mo>^</mo>
        <mn>2</mn>
      </mrow>
    </mrow>
    <mo>+</mo>
    <mrow>
      <mi>A</mi>
      <mo>&#x2062;</mo>
      <mstyle>
        <mspace width="0.3em" height="0.3ex"/>
      </mstyle>
      <mo>&#x2062;</mo>
      <mn>4</mn>
      <mo>*</mo>
      <mi>RPM</mi>
    </mrow>
    <mo>+</mo>
    <mrow>
      <mi>A</mi>
      <mo>&#x2062;</mo>
      <mstyle>
        <mspace width="0.3em" height="0.3ex"/>
      </mstyle>
      <mo>&#x2062;</mo>
      <mn>5</mn>
      <mo>*</mo>
      <mi>Sec</mi>
      <mo>&#x2062;</mo>
      <mstyle>
        <mspace width="0.3em" height="0.3ex"/>
      </mstyle>
      <mo>&#x2062;</mo>
      <mi>Inj</mi>
    </mrow>
    <mo>+</mo>
    <mrow>
      <mi>A</mi>
      <mo>&#x2062;</mo>
      <mstyle>
        <mspace width="0.3em" height="0.3ex"/>
      </mstyle>
      <mo>&#x2062;</mo>
      <mn>6</mn>
      <mo>*</mo>
      <mi>PrgVol</mi>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0312" num="0322">This compensation may then be used to modify the injected fuel flow, for example, as described herein.</p>
<p id="p-0313" num="0323">Note that in the above algorithm using a Potters Square Root Algorithm, it may be executed where values for the algorithm coefficients may be stored in memory. The values stored can be predetermined initial values that are used when the computer keep-alive memory has been reset, or will be the values updated in the last iteration of this algorithm.</p>
<p id="p-0314" num="0324">Referring now to <figref idref="DRAWINGS">FIG. 35</figref>, a graph is shown of an example injector transfer function, illustrating a relationship between fuel mass per injector pulse and pulsewidth (PW). The graph shows an example two-slope approximation, changing at a breakpoint (BP).</p>
<p id="p-0315" num="0325">Referring now to <figref idref="DRAWINGS">FIG. 36</figref>, an example fuel delivery system is shown for an example with a single injector per cylinder may be employed, where the single injector may be a direct injector or a port injector. In this example, a first fuel tank <b>3610</b> and a second fuel tank <b>3612</b> are shown for holding a first and second fuel type, such as gasoline and an alcohol blend. Each fuel tank has an internal fuel pump (<b>3614</b> and <b>3616</b>, respectively), although an external pump may also be used, or a dual pump system may be used. Each fuel tank leads to a mixing valve <b>3620</b> that may be adjusted via controller <b>12</b> to vary a relative amount of each of the fuel types, from only type 1 to only type 2, and any relative amount in between. The mixing/control valve leads to a fuel rail <b>3630</b> having one or more fuel injectors <b>3626</b> coupled thereto. In this way, a relative amount of fuel types may be delivered to the engine without requiring two fuel injectors.</p>
<p id="p-0316" num="0326">Referring now to <figref idref="DRAWINGS">FIG. 37</figref>, an alternative embodiment is shown of a fuel delivery system in which two fuel tanks are used with a fuel pump and a single injector per cylinder, to further reduce system cost. In this example, fuel tanks <b>3710</b> and <b>3712</b> (each storing a respective fuel type such as gasoline and an ethanol or alcohol mixture) leads to mixing/control valve <b>3720</b> via respective one way valves <b>3722</b> and <b>3724</b>, which may optionally be included to reduce any backflow. Then, valve <b>3720</b>, leads to a pump <b>3740</b> and then to fuel rail <b>3730</b> having one or more injectors <b>3736</b>. Again, a multi-stage pump, or multiple pumps may be used to further boost pressure, with each pump compressing a mixture of the fuel types.</p>
<p id="p-0317" num="0327">Referring now to <figref idref="DRAWINGS">FIG. 38</figref>, an alternative embodiment is shown of a fuel delivery system in which two fuel tanks are used with fuel pumps and two injectors per cylinder, to provide flexibility in delivering fuel types via different injectors. For example, one injector may be a direct injector for a cylinder, and the other injector may be a port injector for the cylinder, or they may both be port or direct injectors for the same cylinder, with different targeting, spray patterns, etc.</p>
<p id="p-0318" num="0328">In this example, fuel tanks <b>3810</b> and <b>3812</b> (each storing a respective fuel type such as gasoline and an ethanol or alcohol mixture) are each coupled to a first and second fuel pump <b>3830</b> and <b>3832</b> via a set of three controllable/mixing valves <b>3820</b>, <b>3822</b>, and <b>3824</b>. Specifically, valve <b>3820</b> is coupled directly to tank <b>3810</b> and valve <b>3824</b> is coupled directly to tank <b>3812</b>. Each of these valves may lead through an optional one way check valve (<b>3826</b> and <b>3828</b>, respectively) to respective pumps <b>3830</b> and <b>3832</b>. A line between the two pumps may be controlled via valve <b>3822</b>, which may be used instead of or in addition to valves <b>3820</b> and <b>3824</b>. Each of the pumps leads to a respective fuel rail <b>3834</b> or <b>3836</b>, having one or more fuel injectors <b>3840</b> and <b>3842</b>, respectively. In one example, tank <b>3810</b> holds type 1 fuel and injector <b>3840</b> is a port injector, and tank <b>3812</b> holds a type 2 fuel, and injector <b>3842</b> is a direct cylinder injector for the same cylinder as injector <b>3840</b>.</p>
<p id="p-0319" num="0329">This example configuration can enable either fuel type to be fed to ether injector, or combinations of fuel types to either injector. Also, the control valves can be located upstream of the pumps so that one can deliver either fuel at either pressure, in the case where the pumps generate different fuel pressures. Note, however, that the valves may be located downstream of the pumps if the fuel pumps generated similar pressures/flows, which could be either a high pressure fuel system or a low pressure fuel system.</p>
<p id="p-0320" num="0330">In one example, valve <b>3820</b> may be closed, and valves <b>3822</b> and <b>3824</b> open to allow flow from tank <b>3812</b> to both pumps/injectors. Alternatively, all valves could be open, where the relative amounts of each valve are adjusted to vary an amount of different fuel types to different injectors, where the valves may be adjusted based on operating conditions, whether fuels are enabled, etc. In this way, improved operation may be achieved by tailoring the fuel types and relative amounts to different injectors for different operating conditions. In another embodiment, valves <b>3820</b> and <b>3824</b> may be omitted, and both tanks may be coupled to the inlet of valve <b>3822</b>, thus allowing control of relative amounts of fuel types to both injection systems (although only one injection system may be operating at any given time).</p>
<p id="p-0321" num="0331">However, with the operation of the example systems of <figref idref="DRAWINGS">FIGS. 36-38</figref>, relative fuel amount adjustment response to conditions, such as knock, may be slower since it takes time for fuel to travel from the valve to the injectors for delivery. Thus, in the case where adjustments in the amounts, or relative amounts, of fuel types are used to reduce knock, it may be advantageous to first utilize spark retard and/or airflow control and/or boost control in response to engine knock. Then, once an adjustment to a relative amount of fuel types is made and takes effect in the combustion chamber, the spark retard and/or airflow control and/or boost control may be reduced so that improved fuel economy and/or performance may be achieved, while still reducing knock via appropriate adjustment of relative amounts of fuel types, such as increased ethanol injection.</p>
<p id="p-0322" num="0332">Referring now to <figref idref="DRAWINGS">FIG. 39</figref>, a routine is described for managing a transition when first providing type 2 injection (e.g., ethanol) in view of minimum pulse width operation of fuel injectors. Specifically, in <b>3910</b> the routine identifies a request of activation or commencing of type 2 fuel (e.g., via a second injector in a cylinder) based on a demand as determined by <figref idref="DRAWINGS">FIG. 16</figref>, for example. If such a request is present, the routine continues to <b>3912</b> to turn on a type 2 injector to a pulsewidth at or greater than a minimum pulsewidth required for stable and repeatable operation, which may be identified by an amount &#x394;1. Then, in <b>3914</b>, the routine reduces type 1 injection by an amount (&#x394;2) to maintain an overall stoichiometric ratio. The size of &#x394;2 may calculated based on &#x394;1, the first and second injector characteristics (e.g., slopes, offsets), and the stoichiometric air-fuel ratio of the type 1 and type 2 fuels, as described for <figref idref="DRAWINGS">FIG. 23</figref>. For example, where the type 1 fuel is gasoline and the type 2 fuel is ethanol, the amount of total mass reduction in gasoline is smaller than the size of the mass increase in ethanol due to the differential stoichiometric ratios.</p>
<p id="p-0323" num="0333">Note that the above adjustments are described for two injectors in a single cylinder, however for a multi-cylinder engine, each cylinder may be transitioned in a similar way in sequence. Also, in another example, only one or a subset of the cylinders may be transitioned to operate with both fuel types. Further, the transition may be serial, or all cylinders may be transitioned at substantially the same time.</p>
<p id="p-0324" num="0334">Further note that the above approach assumes that the relative power density in the fuels compensates for the change in total fuel mass being provided. In other words, when increasing the type 2 injector by &#x394;2 and decreasing the type 1 fuel by a smaller &#x394;1 so that an appropriate amount of fuel is provided to burn with the already present air, the overall torque of the combustion may change due to power density differences in the fuels. As the ratio of the stoichiometric air-fuel ratios between ethanol and gasoline is similar to the ratio of power densities, only a negligible torque disturbance may be present. However, in some cases, such a torque disturbance may be perceptible. Thus, in <b>3918</b>, the routine determines whether additional compensation may be used. If so, the routine proceeds to <b>3920</b> to use spark and/or throttle and/or boost adjustments to compensate for such torque variation. In one example, if the overall torque after the transition may increase, spark retard may be used commensurate with the change in fuel amounts, and then gradually ramped out as the throttle and/or boost level is ramped to decrease airflow. In another example, if the overall torque after the transition may decrease, spark retard along with increasing airflow before the transition may be used and then the spark retard may be removed commensurate with the change in fuel amounts.</p>
<p id="p-0325" num="0335">If the answer to <b>3918</b> is no, the routine continues to <b>3922</b> to compensate for the effect of changing the relative amounts of fuel types on optimal ignition timing. In other words, by adding type 2 fuel, it may be possible to advance ignition timing without incurring engine knock, thus providing more efficient operation. As such, the routine gradually ramps to the new desired ignition timing while gradually reducing airflow to account for the increased efficiency. In this way, it is possible to commence an alternative fuel type during engine operation without violating minimum pulse width requirements and thereby achieve improved efficiency and maintaining engine output torque.</p>
<p id="p-0326" num="0336"><figref idref="DRAWINGS">FIG. 40</figref> shows an example of such operation where type 1 fuel is gasoline and type 2 fuel is ethanol or an ethanol blend. The top graph shows engine output torque (Tq), the second graph from the top shows the ethanol pulsewidth, the third graph from the top shows the gasoline pulsewidth, the fourth graph from the top shows throttle position, the fifth graph from the top shows relative air-fuel ratio of the combustion gasses (X), and the bottom graph shows spark angle. In this example, at time t<b>1</b> the ethanol injector is activated to a minimum pulse width and the gasoline injector is correspondingly decreased. Then, from t<b>1</b> to t<b>2</b>, the spark is gradually ramped to a new optimal timing (which is more advanced due to the added charge cooling of the ethanol), while the throttle is gradually ramped closed to compensate for the increased efficiency of the engine due to the spark timing change.</p>
<p id="p-0327" num="0337">In this example, fueling adjustments are shown for a fixed engine speed and load, and without delays from puddle dynamics, although compensation for these may be added, if desired. Further, additional adjustments may be present due to other transient conditions, such as feedback from exhaust gas oxygen sensors, etc.</p>
<p id="p-0328" num="0338">Referring now to <figref idref="DRAWINGS">FIG. 41</figref>, a routine is described for adjusting injection timing based on an amount of fuel types delivered to the engine cylinder. Further, the timing of delivery of more than one fuel type may be varied (e.g., interval between start of injection of the types, interval between end of injection of the types, overlap of injection, the timing of one fuel type, etc.) in response to pressure in the intake manifold of said engine, a time or number of cylinder events since the start of said engine, an atmospheric condition surrounding said engine (e.g., barometric pressure, humidity, and ambient air temperature), a temperature of the fuel injected by said first injector or the temperature of the fuel injected by said second injector, engine speed, engine load, coolant temperature, water fraction in the alcohol/water blend, desired ethanol fraction, knock sensor indication, the duration of fuel injection for a first injector type or a second injector type, or combinations of these and/or other factors. For example, each or both of an injection timing of a port injector and a direct injector for a common cylinder may vary with these operating conditions to vary an injection overlap, to vary vaporization, mixing, or others. As another example, the duration between start of injection between two injectors for a common cylinder may vary depending on the amount of fluid delivery by one or both of the injectors.</p>
<p id="p-0329" num="0339">Specifically, in <b>4110</b> the routine reads operating conditions such as speed, load, coolant temperature, valve and/or cam timing, air temperature, humidity, barometric pressure, fuel temperature, etc. Then, in <b>4112</b>, the routine reads a desired type 1 and type 2 desired fuel delivery amounts, and then selects the timings for type 1 and type 2 fuel injection based on the conditions of <b>4110</b> and the amounts of <b>4112</b>. Thus, as the conditions of <b>4110</b> change and/or the amount of fuel types vary, injection timing of one or both fuel types may vary. As shown herein with regard to <figref idref="DRAWINGS">FIG. 42</figref>, various combinations of open valve injection via a port fuel injector and closed valve injection of a direct injector may be used. Further, when only a single injection source is active, different injection timing may be used than when more than one injection source is active. Further, the injection timings may overlap under some conditions and not overlap under other conditions.</p>
<p id="p-0330" num="0340"><figref idref="DRAWINGS">FIG. 42</figref> thus shows an example of port fuel injection of gasoline (or a blend thereof, cross-hatching from bottom left to upper right) and direct injection of ethanol (or a blend thereof, cross-hatching from upper left to bottom right). The top graph shows an example of closed valve injection of port fuel and open valve injection of direct fuel during an intake stroke. The next graph shows an example of both closed and open valve injection of port fuel and open valve injection of direct fuel during an intake stroke, where the injections partially overlap. The next graph shows an example of both closed and both open and closed valve injection of port fuel and open valve injection of direct fuel during an intake stroke, where the injections do not overlap and the direct fuel injection occurs at least partially during compression after the intake valve closes. Finally, the last graph shows an example of closed valve port injection and open valve injection of direct fuel during an intake stroke, where the injections do not overlap and the direct fuel injection occurs at least partially during compression after the intake valve closes. In the first three examples, the port fuel is greater in timing than the direct fuel, where the opposite is true in the last graph.</p>
<p id="p-0331" num="0341">In one example, during idle conditions, open valve port injection may be used with a smaller amount of direct injection at least partially during a compression stroke to improve combustion stability, such as during a cold start.</p>
<p id="p-0332" num="0342">Note that in one embodiment, two port fuel injectors may be used. In such a case, a routine similar to that of <figref idref="DRAWINGS">FIG. 41</figref> may be used. In such a case, various combinations of open valve and closed valve injection via one or more port fuel injectors may be used. For example, when only a single injection source is active, different injection timing may be used than when more than one injection source is active. Further, the injection timings may overlap under some conditions and not overlap under other conditions.</p>
<p id="p-0333" num="0343">One example approach for operating multiple port injectors is described with regard to <figref idref="DRAWINGS">FIG. 43</figref>, which shows a speed/load range with three regions (region <b>1</b>, region <b>2</b>, and region <b>3</b>), where region <b>1</b> is below the dashed line, region <b>2</b> is between the dashed and solid lines, and region <b>3</b> is at or above the solid line. In one example, only a first fuel type (e.g., port gasoline injection) may be used in region <b>1</b> with closed, or partially closed, valve injection timing. Further, a combination of both injection types may be used in region <b>2</b> (e.g., port gasoline injection and ethanol injection, with each having closed and/or open valve injection timing). Specifically, in region <b>2</b>, as load increases, the amount of fuel types injected may vary, e.g., by increasing type 2 injection and maintaining or decreasing type 1 injection. In one specific example, the injections ramp to only type 2 injection at wide open throttle conditions (the solid line, region <b>3</b>) with open and/or closed valve injection timing.</p>
<p id="p-0334" num="0344">Referring now to <figref idref="DRAWINGS">FIG. 44</figref>, an example routine for controlling boosting (e.g., via a variable geometry turbocharger, electrically controlled supercharger, adjustable compressor bypass valve, or a waste gate) is described. Specifically, in <b>4410</b>, the routine reads operating conditions, such as engine speed, fluid reserve levels of fuel types (e.g., of gasoline in a first tank and ethanol in a second tank, or blends thereof), desired engine output, temperature, etc. Then, in <b>4412</b>, the routine determines a desired boost amount (e.g., desired position of a VGT, desired pressure ratio across a compressor, etc.). Then, the routine determines a desired type 1 and type <b>2</b> fluid delivery in <b>4414</b>.</p>
<p id="p-0335" num="0345">In <b>4416</b>, the routine determines whether a type 2 fluid reserve is below a threshold value (for example, near empty, or the system is unable to provide the amount desired in <b>4414</b>). If so, the routine continues to <b>4418</b> to reduce the boost amount to reduce a tendency of knock caused by lack of a desired amount of type 2 fluid, for example.</p>
<p id="p-0336" num="0346">From <b>4418</b>, or a no in <b>4416</b>, the routine determines whether a knock indication is present in <b>4420</b>, such as based on a knock sensor or other approach as noted herein. If so, the routine continues to <b>4422</b> to determine if a first condition is present. For example, the conditions may be a high boost presence, a temperature is above a threshold, or other. If so, the routine continues to <b>4424</b> to further reduce a boost amount. Otherwise, the routine continues to <b>4426</b> to identify if a second condition is present. If so, the routine continues to <b>4428</b> to increase a type 2 fluid delivered and adjust a type 1 fluid if necessary to control air-fuel ratio and/or engine torque. Otherwise, the routine continues to <b>4430</b> to retard spark timing.</p>
<p id="p-0337" num="0347">In this way, boost can be adjusted and engine improved engine operation can be achieved under varying conditions.</p>
<p id="p-0338" num="0348">It will be appreciated that the configurations, systems, and routines disclosed herein are exemplary in nature, and that these specific embodiments are not to be considered in a limiting sense, because numerous variations are possible. For example, the above approaches can be applied to V-6, I-3, I-4, I-5, I-6, V-8, V-10, V-12, opposed 4, and other engine types.</p>
<p id="p-0339" num="0349">As another example, engine <b>10</b> may be a variable displacement engine in which some cylinders (e.g., half) are deactivated by deactivating intake and exhaust valves for those cylinders. In this way, improved fuel economy may be achieved. However, as noted herein, in one example injection using multiple types of fuel delivery (e.g., fuel composition or delivery location) can be used to reduce a tendency of knock at higher loads. Thus, by operating with direct injection of a fuel containing alcohol (such as ethanol or an ethanol blend) during cylinder deactivation operation, it may be possible to extend a range of cylinder deactivation, thereby further improving fuel economy.</p>
<p id="p-0340" num="0350">As will be appreciated by one of ordinary skill in the art, the specific routines described herein in the flowcharts and the specification may represent one or more of any number of processing strategies such as event-driven, interrupt-driven, multi-tasking, multi-threading, and the like. As such, various steps or functions illustrated may be performed in the sequence illustrated, in parallel, or in some cases omitted. Likewise, the order of processing is not necessarily required to achieve the features and advantages of the example embodiments of the invention described herein, but is provided for ease of illustration and description. Although not explicitly illustrated, one of ordinary skill in the art will recognize that one or more of the illustrated steps or functions may be repeatedly performed depending on the particular strategy being used. Further, these figures graphically represent code to be programmed into the computer readable storage medium in controller <b>12</b>. Further still, while the various routines may show a &#x201c;start&#x201d; and &#x201c;end&#x201d; block, the routines may be repeatedly performed in an iterative manner, for example.</p>
<p id="p-0341" num="0351">The subject matter of the present disclosure includes all novel and nonobvious combinations and subcombinations of the various systems and configurations, and other features, functions, and/or properties disclosed herein.</p>
<p id="p-0342" num="0352">The following claims particularly point out certain combinations and subcombinations regarded as novel and nonobvious. These claims may refer to &#x201c;an&#x201d; element or &#x201c;a first&#x201d; element or the equivalent thereof. Such claims should be understood to include incorporation of one or more such elements, neither requiring nor excluding two or more such elements. Other combinations and subcombinations of the disclosed features, functions, elements, and/or properties may be claimed through amendment of the present claims or through presentation of new claims in this or a related application. Such claims, whether broader, narrower, equal, or different in scope to the original claims, also are regarded as included within the subject matter of the present disclosure.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001" nb-file="US07640914-20100105-M00001.NB">
<img id="EMI-M00001" he="10.58mm" wi="76.20mm" file="US07640914-20100105-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002" nb-file="US07640914-20100105-M00002.NB">
<img id="EMI-M00002" he="18.03mm" wi="76.20mm" file="US07640914-20100105-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00003" nb-file="US07640914-20100105-M00003.NB">
<img id="EMI-M00003" he="10.92mm" wi="76.20mm" file="US07640914-20100105-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00004" nb-file="US07640914-20100105-M00004.NB">
<img id="EMI-M00004" he="10.92mm" wi="76.20mm" file="US07640914-20100105-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00005" nb-file="US07640914-20100105-M00005.NB">
<img id="EMI-M00005" he="7.45mm" wi="76.20mm" file="US07640914-20100105-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>The invention claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A system for an engine, comprising:
<claim-text>a cylinder located in the engine;</claim-text>
<claim-text>a turbocharger coupled to the engine;</claim-text>
<claim-text>a first injector for injecting a first fuel into said cylinder, wherein said first injector is a direct cylinder injector where said direct cylinder injector delivers a liquid including an alcohol;</claim-text>
<claim-text>a second injector for injecting a second fuel into said cylinder, wherein said second injector is a port injector, where said port injector delivers a liquid including gasoline;</claim-text>
<claim-text>a catalytic device configured to receive exhaust gases produced by at least the cylinder; and</claim-text>
<claim-text>a controller configured to vary an amount of said first and second fuel injection during engine operation based on operating conditions, where amounts of variation of said first and second fuels are set to maintain a substantially stoichiometric mixture, the controller further configured to:</claim-text>
<claim-text>increase a relative amount of injection of the second injector in response to an indication of engine knock during a first operating condition;</claim-text>
<claim-text>decrease engine boosting in response to the indication of engine knock during a second condition; and</claim-text>
<claim-text>retard ignition timing in response to the indication of engine knock during a third condition.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein said controller further adjusts injection from one of the first or second injectors to maintain desired engine output.</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein said controller further adjusts an amount from said first injector to maintain a desired air-fuel ratio.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein said controller further adjusts an amount from said second injector to maintain a desired air-fuel ratio.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein said controller further adjusts an amount from said first and second injectors to maintain a desired air-fuel ratio.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. The system of <claim-ref idref="CLM-00001">claim 1</claim-ref> wherein said controller varies said amounts of one of said first and second fuel injection with a fuel blend of one of said first and second fuels.</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. A method for operating an engine, the engine having a cylinder located therein, the method comprising;
<claim-text>boosting intake air via a turbocharger coupled to the engine;</claim-text>
<claim-text>injecting a first fuel into said cylinder via a first injector, wherein said first injector is a direct cylinder injector where said direct cylinder injector delivers a liquid including an alcohol;</claim-text>
<claim-text>injecting a second fuel into said cylinder via a second injector, wherein said second injector is a port injector, where said port injector delivers a liquid including gasoline;</claim-text>
<claim-text>treating exhaust gas from the cylinder in a catalytic device;</claim-text>
<claim-text>during a first operating condition, increasing a relative amount of injection of the second injector to the first injector in response to an indication of engine knock;</claim-text>
<claim-text>during a second condition, decreasing engine boosting in response to the indication of engine knock; and</claim-text>
<claim-text>during a third condition, retarding ignition timing in response to the indication of engine knock.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00007">claim 7</claim-ref> wherein the indication of engine knock is based on a knock sensor.</claim-text>
</claim>
<claim id="CLM-00009" num="00009">
<claim-text>9. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref> further comprising adjusting fuel injection from the first injector to maintain a stoichiometric air-fuel ratio, wherein the catalyst device is a three-way catalyst.</claim-text>
</claim>
<claim id="CLM-00010" num="00010">
<claim-text>10. The method of <claim-ref idref="CLM-00009">claim 9</claim-ref> further comprising purging fuel vapors in the engine.</claim-text>
</claim>
<claim id="CLM-00011" num="00011">
<claim-text>11. The method of <claim-ref idref="CLM-00008">claim 8</claim-ref> further comprising adjusting fuel injection from the second injector to maintain a stoichiometric air-fuel ratio, wherein the catalyst device is a three-way catalyst. </claim-text>
</claim>
</claims>
</us-patent-grant>
