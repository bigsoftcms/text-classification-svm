<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE us-patent-grant SYSTEM "us-patent-grant-v42-2006-08-23.dtd" [ ]>
<us-patent-grant lang="EN" dtd-version="v4.2 2006-08-23" file="US07640899-20100105.XML" status="PRODUCTION" id="us-patent-grant" country="US" date-produced="20091221" date-publ="20100105">
<us-bibliographic-data-grant>
<publication-reference>
<document-id>
<country>US</country>
<doc-number>07640899</doc-number>
<kind>B2</kind>
<date>20100105</date>
</document-id>
</publication-reference>
<application-reference appl-type="utility">
<document-id>
<country>US</country>
<doc-number>11106886</doc-number>
<date>20050415</date>
</document-id>
</application-reference>
<us-application-series-code>11</us-application-series-code>
<us-term-of-grant>
<us-term-extension>367</us-term-extension>
<disclaimer>
<text>This patent is subject to a terminal disclaimer.</text>
</disclaimer>
</us-term-of-grant>
<classifications-ipcr>
<classification-ipcr>
<ipc-version-indicator><date>20060101</date></ipc-version-indicator>
<classification-level>A</classification-level>
<section>F</section>
<class>01</class>
<subclass>L</subclass>
<main-group>9</main-group>
<subgroup>04</subgroup>
<symbol-position>F</symbol-position>
<classification-value>I</classification-value>
<action-date><date>20100105</date></action-date>
<generating-office><country>US</country></generating-office>
<classification-status>B</classification-status>
<classification-data-source>H</classification-data-source>
</classification-ipcr>
</classifications-ipcr>
<classification-national>
<country>US</country>
<main-classification>123 9011</main-classification>
<further-classification>25112902</further-classification>
<further-classification>25112917</further-classification>
</classification-national>
<invention-title id="d0e55">Adjusting electrically actuated valve lift</invention-title>
<references-cited>
<citation>
<patcit num="00001">
<document-id>
<country>US</country>
<doc-number>4829947</doc-number>
<kind>A</kind>
<name>Lequesne</name>
<date>19890500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00002">
<document-id>
<country>US</country>
<doc-number>5074259</doc-number>
<kind>A</kind>
<name>Pusic</name>
<date>19911200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00003">
<document-id>
<country>US</country>
<doc-number>5124598</doc-number>
<kind>A</kind>
<name>Kawamura</name>
<date>19920600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>310 30</main-classification></classification-national>
</citation>
<citation>
<patcit num="00004">
<document-id>
<country>US</country>
<doc-number>6066999</doc-number>
<kind>A</kind>
<name>Pischinger</name>
<date>20000500</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00005">
<document-id>
<country>US</country>
<doc-number>6286478</doc-number>
<kind>B1</kind>
<name>Atago et al.</name>
<date>20010900</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123306</main-classification></classification-national>
</citation>
<citation>
<patcit num="00006">
<document-id>
<country>US</country>
<doc-number>6378473</doc-number>
<kind>B2</kind>
<name>Yamaki et al.</name>
<date>20020400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00007">
<document-id>
<country>US</country>
<doc-number>6390036</doc-number>
<kind>B1</kind>
<name>Yuuki</name>
<date>20020500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00008">
<document-id>
<country>US</country>
<doc-number>6397798</doc-number>
<kind>B1</kind>
<name>Fiaccabrino</name>
<date>20020600</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00009">
<document-id>
<country>US</country>
<doc-number>6532919</doc-number>
<kind>B2</kind>
<name>Curtis et al.</name>
<date>20030300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00010">
<document-id>
<country>US</country>
<doc-number>6549390</doc-number>
<kind>B1</kind>
<name>Ozawa et al.</name>
<date>20030400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>361139</main-classification></classification-national>
</citation>
<citation>
<patcit num="00011">
<document-id>
<country>US</country>
<doc-number>6655328</doc-number>
<kind>B2</kind>
<name>Kather</name>
<date>20031200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00012">
<document-id>
<country>US</country>
<doc-number>6690563</doc-number>
<kind>B2</kind>
<name>Ozawa et al.</name>
<date>20040200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>361154</main-classification></classification-national>
</citation>
<citation>
<patcit num="00013">
<document-id>
<country>US</country>
<doc-number>6701876</doc-number>
<kind>B2</kind>
<name>Youqing</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00014">
<document-id>
<country>US</country>
<doc-number>6705256</doc-number>
<kind>B2</kind>
<name>Yamaki et al.</name>
<date>20040300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00015">
<document-id>
<country>US</country>
<doc-number>6805079</doc-number>
<kind>B1</kind>
<name>Brehob et al.</name>
<date>20041000</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00016">
<document-id>
<country>US</country>
<doc-number>7011053</doc-number>
<kind>B2</kind>
<name>Muraji</name>
<date>20060300</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00017">
<document-id>
<country>US</country>
<doc-number>7128032</doc-number>
<kind>B2</kind>
<name>Froeschle et al.</name>
<date>20061000</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9011</main-classification></classification-national>
</citation>
<citation>
<patcit num="00018">
<document-id>
<country>US</country>
<doc-number>7213550</doc-number>
<kind>B2</kind>
<name>Nishida</name>
<date>20070500</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>123 9015</main-classification></classification-national>
</citation>
<citation>
<patcit num="00019">
<document-id>
<country>US</country>
<doc-number>7459345</doc-number>
<kind>B2</kind>
<name>Hwan</name>
<date>20081200</date>
</document-id>
</patcit>
<category>cited by examiner</category>
<classification-national><country>US</country><main-classification>438121</main-classification></classification-national>
</citation>
<citation>
<patcit num="00020">
<document-id>
<country>FR</country>
<doc-number>2851367</doc-number>
<kind>A1</kind>
<date>20030200</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00021">
<document-id>
<country>WO</country>
<doc-number>WO 03021086</doc-number>
<date>20030300</date>
</document-id>
</patcit>
<category>cited by other</category>
</citation>
<citation>
<patcit num="00022">
<document-id>
<country>WO</country>
<doc-number>WO2004033868</doc-number>
<kind>A2</kind>
<date>20040400</date>
</document-id>
</patcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00023">
<othercit>Moyer et al., Electromagnetic Valve System, US Patent Applicatiopn Pub. No. US 2004/0113731, Jun. 17, 2004.</othercit>
</nplcit>
<category>cited by examiner</category>
</citation>
<citation>
<nplcit num="00024">
<othercit>U.S. Appl. No. 11/049,032, filed Feb. 1, 2005, Ervin et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
<citation>
<nplcit num="00025">
<othercit>U.S. Appl. No. 11/047,462, filed Feb. 1, 2005, Ervin et al.</othercit>
</nplcit>
<category>cited by other</category>
</citation>
</references-cited>
<number-of-claims>8</number-of-claims>
<us-exemplary-claim>1</us-exemplary-claim>
<us-field-of-classification-search>
<classification-national>
<country>US</country>
<main-classification>123 9012</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123 9013</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123 9011</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>123 9015</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>25112901</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>25112915</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>25112916</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>25112918</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>25112902</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>25112917</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>361139</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>361140</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>361144</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>361154</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>701105</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>701111</main-classification>
</classification-national>
<classification-national>
<country>US</country>
<main-classification>701113</main-classification>
</classification-national>
</us-field-of-classification-search>
<figures>
<number-of-drawing-sheets>7</number-of-drawing-sheets>
<number-of-figures>7</number-of-figures>
</figures>
<us-related-documents>
<related-publication>
<document-id>
<country>US</country>
<doc-number>20060231050</doc-number>
<kind>A1</kind>
<date>20061019</date>
</document-id>
</related-publication>
</us-related-documents>
<parties>
<applicants>
<applicant sequence="001" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Lewis</last-name>
<first-name>Donald J.</first-name>
<address>
<city>Howell</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="002" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Winstead</last-name>
<first-name>Vince</first-name>
<address>
<city>Farmington Hills</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
<applicant sequence="003" app-type="applicant-inventor" designation="us-only">
<addressbook>
<last-name>Ervin</last-name>
<first-name>James D.</first-name>
<address>
<city>Novi</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
<nationality>
<country>omitted</country>
</nationality>
<residence>
<country>US</country>
</residence>
</applicant>
</applicants>
<agents>
<agent sequence="01" rep-type="attorney">
<addressbook>
<last-name>Lippa</last-name>
<first-name>Allan J.</first-name>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
<agent sequence="02" rep-type="attorney">
<addressbook>
<orgname>Allen Hall McCoy Russell &#x26; Tuttle LLP</orgname>
<address>
<country>unknown</country>
</address>
</addressbook>
</agent>
</agents>
</parties>
<assignees>
<assignee>
<addressbook>
<orgname>Ford Global Technologies, LLC</orgname>
<role>02</role>
<address>
<city>Dearborn</city>
<state>MI</state>
<country>US</country>
</address>
</addressbook>
</assignee>
</assignees>
<examiners>
<primary-examiner>
<last-name>Chang</last-name>
<first-name>Ching</first-name>
<department>3748</department>
</primary-examiner>
</examiners>
</us-bibliographic-data-grant>
<abstract id="abstract">
<p id="p-0001" num="0000">A system and method for controlling electromechanical valves operating in an engine is presented. According to the method, valve operation can be adjusted in a number of ways.</p>
</abstract>
<drawings id="DRAWINGS">
<figure id="Fig-EMI-D00000" num="00000">
<img id="EMI-D00000" he="230.97mm" wi="302.68mm" file="US07640899-20100105-D00000.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00001" num="00001">
<img id="EMI-D00001" he="215.22mm" wi="156.29mm" orientation="landscape" file="US07640899-20100105-D00001.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00002" num="00002">
<img id="EMI-D00002" he="210.90mm" wi="131.83mm" file="US07640899-20100105-D00002.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00003" num="00003">
<img id="EMI-D00003" he="216.66mm" wi="157.06mm" file="US07640899-20100105-D00003.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00004" num="00004">
<img id="EMI-D00004" he="231.56mm" wi="147.07mm" file="US07640899-20100105-D00004.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00005" num="00005">
<img id="EMI-D00005" he="230.38mm" wi="143.93mm" file="US07640899-20100105-D00005.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00006" num="00006">
<img id="EMI-D00006" he="235.20mm" wi="143.76mm" file="US07640899-20100105-D00006.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
<figure id="Fig-EMI-D00007" num="00007">
<img id="EMI-D00007" he="231.99mm" wi="161.37mm" file="US07640899-20100105-D00007.TIF" alt="embedded image" img-content="drawing" img-format="tif"/>
</figure>
</drawings>
<description id="description">
<?BRFSUM description="Brief Summary" end="lead"?>
<heading id="h-0001" level="1">FIELD</heading>
<p id="p-0002" num="0001">The present description relates to a method for controlling electrically actuated valves operating in a cylinder of an internal combustion engine.</p>
<heading id="h-0002" level="1">BACKGROUND</heading>
<p id="p-0003" num="0002">One method to control intake and exhaust valve operation during engine operation is described in French patent application. No. FR 2851367 A1. This method presents several means to control a dual coil electromagnetically actuated valve. One approach described in the application attempts to open and close an electrically actuated valve using a single coil of a dual coil actuator, the closing coil. By controlling current to a single coil, the amount of energy used to operate an engine with electrical valves may be lowered. In addition, impacts between valve components may be reduced by controlling a valve with a single coil. This method of controlling a valve is sometimes referred to as &#x201c;Ballistic&#x201d; mode.</p>
<p id="p-0004" num="0003">The above-mentioned method can also have a disadvantage. Namely, the method may be limited to a narrow range of engine operating conditions because the valve opening lift amount and duration may not be controllable during some operating conditions by using a single coil. By controlling a dual coil actuator with a single coil, the valve may not be held in an open position long enough for the cylinder to induct enough air to support combustion. Consequently, this method of valve control may be limited to engine operating conditions where torque and speed are relatively low. On the other hand, the valve may stay open longer than desired, at least during some conditions. For example, during idle conditions a low torque amount may be necessary to hold an engine at a desired idle speed. Due to valve timing, the amount of air and fuel that is inducted into a cylinder may be able to produce torque in excess of the torque necessary to maintain the desired idle speed. Consequently, engine torque may be regulated by other means such that a fraction of the total torque available from the air-fuel mixture is produced. As a result, fuel consumption and emissions may increase.</p>
<p id="p-0005" num="0004">The inventors herein have recognized the above-mentioned disadvantages and have developed a method of electromechanical valve control that offers substantial improvements.</p>
<heading id="h-0003" level="1">SUMMARY</heading>
<p id="p-0006" num="0005">One embodiment of the present description includes a method to adjust lift amount of an electrically actuated valve, said electrically actuated valve operating in a cylinder of an internal combustion engine, the method comprising: operating said electrically actuated valve at a first valve opening lift amount, by adjusting current flowing to a valve opening coil, at a first engine operating condition; and operating said electrically actuated valve at a second valve opening lift amount, by adjusting current flowing to said valve opening coil, at a second engine operating condition.</p>
<p id="p-0007" num="0006">By adjusting current that may be supplied to a valve opening coil, it may be possible to reduce or increase the amount of inducted air mass. In one example, it may be possible to maintain a desired torque amount if barometric pressure increases by reducing the amount of valve lift, thereby reducing the inducted air amount. In another example, it may be possible to maintain a desired torque amount if barometric pressure decreases by increasing the amount of valve lift, thereby increasing the inducted air amount. In other words, valve lift of an electrically actuated valve may be controlled by adjusting current flow to a valve actuator. In particular, current flow can be adjusted to an opening coil such that valve lift may be increased or decreased, at least during some conditions.</p>
<p id="p-0008" num="0007">The present description may provide several advantages. For example, the approach may allow the engine to operate more efficiently at idle. By adjusting valve lift, the amount of inducted air may be matched to a desired amount of torque, thereby reducing the amount of excess inducted air. In other words, the present method may provide better air charge regulation, at least during some conditions. The method may also use less energy than operating a valve from full closed to full open. Since the present method does not require the valve to be captured in an open position, the amount of energy used to open the valve may be reduced, at least during some conditions. These advantages may reduce fuel consumption and improve engine torque control during some driving conditions.</p>
<p id="p-0009" num="0008">The above advantages and other advantages, and features of the present description will be readily apparent from the following Detailed Description when taken alone or in connection with the accompanying drawings.</p>
<?BRFSUM description="Brief Summary" end="tail"?>
<?brief-description-of-drawings description="Brief Description of Drawings" end="lead"?>
<description-of-drawings>
<heading id="h-0004" level="1">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p-0010" num="0009">The advantages described herein will be more fully understood by reading an example of an embodiment, referred to herein as the Detailed Description, when taken alone or with reference to the drawings, wherein:</p>
<p id="p-0011" num="0010"><figref idref="DRAWINGS">FIG. 1</figref> is a schematic diagram of an engine;</p>
<p id="p-0012" num="0011"><figref idref="DRAWINGS">FIG. 2</figref> is a schematic diagram that shows an electrically actuated valve in a neutral state;</p>
<p id="p-0013" num="0012"><figref idref="DRAWINGS">FIG. 3</figref> is an example plot of simulation data that shows valve trajectories for a known valve control mode;</p>
<p id="p-0014" num="0013"><figref idref="DRAWINGS">FIG. 4</figref> is a plot of simulation data that shows example valve trajectories for valve controlled by a single coil;</p>
<p id="p-0015" num="0014"><figref idref="DRAWINGS">FIG. 5</figref> is an example plot of simulation data that shows a valve trajectory for a valve operated in a hyper-ballistic valve mode;</p>
<p id="p-0016" num="0015"><figref idref="DRAWINGS">FIG. 6</figref> is an example plot of simulation data that shows another valve trajectory for a valve operated in a hyper-ballistic valve mode; and</p>
<p id="p-0017" num="0016"><figref idref="DRAWINGS">FIG. 7</figref> is a flow chart of an example valve timing strategy.</p>
</description-of-drawings>
<?brief-description-of-drawings description="Brief Description of Drawings" end="tail"?>
<?DETDESC description="Detailed Description" end="lead"?>
<heading id="h-0005" level="1">DETAILED DESCRIPTION</heading>
<p id="p-0018" num="0017">Referring to <figref idref="DRAWINGS">FIG. 1</figref>, internal combustion engine <b>10</b>, comprising a plurality of cylinders, one cylinder of which is shown in <figref idref="DRAWINGS">FIG. 1</figref>, is controlled by electronic engine controller <b>12</b>. Engine <b>10</b> includes combustion chamber <b>30</b> and cylinder walls <b>32</b> with piston <b>36</b> positioned therein and connected to crankshaft <b>40</b>. Combustion chamber <b>30</b> is known communicating with intake manifold <b>44</b> and exhaust manifold <b>48</b> via respective intake valve <b>52</b> an exhaust valve <b>54</b>. Each intake and exhaust valve is operated by an electromechanically controlled valve coil and armature assembly <b>53</b>. Alternatively, the intake <b>52</b> or exhaust <b>54</b> valve may be mechanically actuated. Armature temperature is determined by temperature sensor <b>51</b>. Valve position is determined by position sensor <b>50</b>. Valve position may be determined by linear variable displacement, discrete, or optical transducers or from actuator current measurements. In an alternative example, each valve actuator for valves <b>52</b> and <b>54</b> has a position sensor and a temperature sensor. In yet another alternative example, armature temperature may be determined from actuator power consumption since resistive losses can scale with temperature.</p>
<p id="p-0019" num="0018">Intake manifold <b>44</b> is also shown having fuel injector <b>66</b> coupled thereto for delivering liquid fuel in proportion to the pulse width of signal FPW from controller <b>12</b>. Fuel is delivered to fuel injector <b>66</b> by fuel system (not shown) including a fuel tank, fuel pump, and fuel rail (not shown). Alternatively, the engine may be configured such that the fuel is injected directly into the engine cylinder, which is known to those skilled in the art as direct injection. In addition, intake manifold <b>44</b> is shown communicating with optional electronic throttle <b>125</b>.</p>
<p id="p-0020" num="0019">Distributorless ignition system <b>88</b> provides ignition spark to combustion chamber <b>30</b> via spark plug <b>92</b> in response to controller <b>12</b>. Universal Exhaust Gas Oxygen (UEGO) sensor <b>76</b> is shown coupled to exhaust manifold <b>48</b> upstream of catalytic converter <b>70</b>. Alternatively, a two-state exhaust gas oxygen sensor may be substituted for UEGO sensor <b>76</b>. Two-state exhaust gas oxygen sensor <b>98</b> is shown coupled to exhaust manifold <b>48</b> downstream of catalytic converter <b>70</b>. Alternatively, sensor <b>98</b> can also be a UEGO sensor. Catalytic converter temperature is measured by temperature sensor <b>77</b>, and/or estimated based on operating conditions such as engine speed, load, air temperature, engine temperature, and/or airflow, or combinations thereof.</p>
<p id="p-0021" num="0020">Converter <b>70</b> can include multiple catalyst bricks, in one example. In another example, multiple emission control devices, each with multiple bricks, can be used. Converter <b>70</b> can be a three-way type catalyst in one example.</p>
<p id="p-0022" num="0021">Controller <b>12</b> is shown in <figref idref="DRAWINGS">FIG. 1</figref> as a conventional microcomputer including: microprocessor unit <b>102</b>, input/output ports <b>104</b>, and read-only-memory <b>106</b>, random-access-memory <b>108</b>, <b>110</b> Keep-alive-memory, and a conventional data bus. Controller <b>12</b> is shown receiving various signals from sensors coupled to engine <b>10</b>, in addition to those signals previously discussed, including: engine coolant temperature (ECT) from temperature sensor <b>112</b> coupled to water jacket <b>114</b>; a position sensor <b>119</b> coupled to a accelerator pedal; a measurement of engine manifold pressure (MAP) from pressure sensor <b>122</b> coupled to intake manifold <b>44</b>; a measurement (ACT) of engine air amount temperature or manifold temperature from temperature sensor <b>117</b>; and a engine position sensor from a Hall effect sensor <b>118</b> sensing crankshaft <b>40</b> position. In a preferred aspect of the present description, engine position sensor <b>118</b> produces a predetermined number of equally spaced pulses every revolution of the crankshaft from which engine speed (RPM) can be determined.</p>
<p id="p-0023" num="0022">Referring to <figref idref="DRAWINGS">FIG. 2</figref>, a schematic of an example electrically actuated valve is shown. The valve actuator is shown in a de-energized state (i.e., no electrical current is being supplied to the valve actuator coils). The electromechanical valve apparatus is comprised of an armature assembly and a valve assembly. The armature assembly is comprised of an armature return spring <b>201</b>, a valve closing coil <b>205</b>, a valve opening coil <b>209</b>, an armature plate <b>207</b>, a valve displacement transducer <b>217</b>, and an armature stem <b>203</b>. When the valve coils are not energized the armature return spring <b>201</b> opposes the valve return spring <b>211</b>, valve stem <b>213</b> and armature stem <b>203</b> are in contact with one another, and the armature plate <b>207</b> is essentially centered between opening coil <b>209</b> and closing coil <b>205</b>. This allows the valve head <b>215</b> to assume a partially open state with respect to the port <b>219</b>. When the armature is in the fully open position the armature plate <b>207</b> is in contact with the opening coil magnetic pole face <b>226</b>. When the armature is in the fully closed position the armature plate <b>207</b> is in contact with the closing coil magnetic pole face <b>224</b>.</p>
<p id="p-0024" num="0023">In one embodiment, armature plate <b>207</b> includes permanent magnets. In another embodiment, armature plate <b>207</b> does not include permanent magnets. Permanent magnets may be used to reduce valve actuator current because the permanent magnet can hold the valve in a closed position in the absence of a holding current, at least during some conditions.</p>
<p id="p-0025" num="0024">During Ballistic mode, valve armature plate <b>207</b> can be released and/or repelled from a closed position by reducing current flow to closing coil <b>205</b> and/or by controlling the direction of current flow so that coil polarity forces the actuator plate away from the coil. Typically, valve actuators comprising permanent magnet armatures can repel and attract the armature by controlling current to the opening and/or closing coil. On the other hand, other types of valve actuators may be limited to attracting an armature, non-permanent magnet armature actuators for example. By applying force to actuator armature <b>203</b>, valve opening spring <b>201</b> and/or magnetic force can cause armature plate <b>207</b> to move away from closing coil pole face <b>224</b>. As a result, this armature movement can cause valve <b>213</b> to lift off the valve seat and begin to open port <b>219</b>. After being released and/or repelled, and if not captured by the opening coil, the actuator armature <b>203</b> can reach a position where it reverses direction and travels back toward closing coil <b>224</b>. Specifically, a force balance is applied to armature <b>203</b> by opening spring <b>201</b> and closing spring <b>211</b> that can cause this armature direction reversal. If actuator closing coil <b>205</b> is energized as armature plate <b>207</b> approaches closing pole face <b>224</b>, the armature can be captured and the valve set to a closed position. As mentioned above, factors that can affect the natural frequency of the valve apparatus (e.g., opening and closing springs, armature, valve mass, friction factors, etc.) can affect the valve opening duration when a valve is controlled by a single coil. Thus, during ballistic mode control, valve position can be related to a time trajectory that describes the natural valve response, the engine position that the valve is released, and the magnetization of the closing coil during valve closing.</p>
<p id="p-0026" num="0025">On the other hand, a modified version of ballistic valve control, described herein as hyper-ballistic valve control, controls the position of the actuator armature and valve by adjusting current to the opening and closing coils without substantially capturing or holding the armature at or near the opening coil (i.e., the valve continues to move throughout the open valve duration). In this way, the valve trajectory (i.e., valve opening lift and duration) can be modified so that varying amounts of air are inducted by a cylinder. In one example, armature plate <b>207</b> can be released and/or repelled from a closed position by changing current direction or by reducing current flow to closing coil <b>205</b>. Applying force to actuator armature <b>203</b>, valve opening spring <b>201</b> can cause armature plate <b>207</b> to move away from closing coil pole face <b>224</b>. As described above, this armature movement can cause valve <b>213</b> to lift off the valve seat and begin to open port <b>219</b>. After being released and/or repelled, current can be controlled to the valve opening coil so that the armature may be attracted toward or repelled from the opening coil. By controlling the amount of current, timing of current delivery, and direction of current (i.e., controlling the electromagnet polarity) valve opening lift and duration can be controlled. In hyper-ballistic mode, the valve trajectory may not be defined solely by the valve closing coil current and the natural response of the valve, but it may also be determined by the magnetic field generated by the valve opening coil. The description of <figref idref="DRAWINGS">FIGS. 5 and 6</figref> provide additional explanation for controlling a valve in hyper-ballistic mode.</p>
<p id="p-0027" num="0026">Since ballistic mode and hyper-ballistic modes do not capture the valve in a substantially open position, these modes can be used during engine operating modes that use lower cylinder air charge amounts. For example, these modes may be used during idle, part-throttle, and during deceleration where cylinder air charge may be lower. These operating modes can reduce the valve opening time since the energy in the valve opening coil may not have to be reduced to allow a valve to close. In particular, it can take a finite amount of time to increase or decrease energy in a coil. By not capturing or holding a valve in an open position less energy may be delivered or extracted from a coil during valve operation. Consequently, it may take less time to extract or add energy to a coil so that the valve trajectory may be altered in a shorter period of time.</p>
<p id="p-0028" num="0027">As an alternative, the valve actuator may be constructed of a single coil combined with a two plate armature. The valve lift, duration, and timing methods described herein may also be extended to this and other actuator designs since actuator designs are not intended to limit the scope of this description.</p>
<p id="p-0029" num="0028">Referring to <figref idref="DRAWINGS">FIG. 3</figref>, an example plot of a simulation of a known electrically actuated valve control method is shown. The figure shows valve trajectory (position) and valve current during an intake cycle of a four-stroke cylinder, referenced to crankshaft angle (0&#xb0; identifies top-dead-center (TDC) intake stroke). The valve lift profile curve <b>301</b> shows the intake valve opening at approximately 10&#xb0; and closing at 70&#xb0;. The slope of the valve curve is reduced as the valve approaches the closed position. This can reduce the valve noise and wear that may be associated with impacting the valve seat at increased velocity. During the valve opening phase, the valve moves from the closed position to the open position and is held stationary until the valve begins to close. Although the valve may be capable of traveling further than the full open position (8 mm in <figref idref="DRAWINGS">FIG. 3</figref>) the valve armature plate can limit the valve lift because of the opening coil, see <figref idref="DRAWINGS">FIG. 2</figref> for an example armature and coil configuration.</p>
<p id="p-0030" num="0029">The valve current delivered to the closing coil is described by curve <b>302</b> (solid line), while the opening coil current is described by curve <b>303</b> (dashed line). Currents <b>302</b> and <b>303</b> may be representative in terms of timing and amplitude, but the actual current amounts to control a valve as described by curve <b>301</b> may vary due to the non-linearity of magnetic force as an actuator armature approaches an electromagnet. In this example, the valve closing current <b>302</b> and the valve opening current <b>303</b> can be used to describe current control of an armature having permanent magnets. Each current profile is shown have positive and negative current. A positive current indicates that an attractive electromagnetic force may be produced between the electromagnet and the armature plate. On the other hand, a negative current indicates that a repulsive force may be produced between the electromagnet and the armature plate. The repulsive force can be used to launch the armature while the attractive force may be used to capture the armature. If an armature is used that does not contain permanent magnets, a holding current may be used to hold the valve open and/or closed. For non-permanent magnet armature plates, the valve can be released by reducing a holding current, thereby reducing the electromagnetic field that may be holding the armature in position.</p>
<p id="p-0031" num="0030">This mode of operation may be one of a number of valve control options that are available in step <b>722</b> of <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0032" num="0031">Referring to <figref idref="DRAWINGS">FIG. 4</figref>, an example plot of simulation data of a valve trajectory for a valve operated by a single coil and for a phased single coil valve opening event. Each curve represents operation of a valve for a single induction event. The curves are shown together to illustrate differences in valve timing and to show the phase relationship between the curves. That is, the valve opening and closing times are shown for two different valve events so that a change in cylinder air charge can be explained. Valve profile curve <b>401</b> shows an example single coil controlled valve profile. Curve <b>402</b> shows a different single coil controlled valve profile that has been moved relative to crankshaft position (i.e., phased). The profiles are similar in amplitude and duration, however the valve response may vary as the valve release/repel location varies with respect to the crankshaft.</p>
<p id="p-0033" num="0032">As described above, single coil control valve mode can be characterized by the release and/or repulsion of a valve from a closed position and the subsequently capture of the valve as the natural response of the valve apparatus causes the valve actuator armature to return toward the valve closing coil. In this mode of operation, only the closing coil is operated and as a consequence the valve may not reach a full open position, depending on the system response.</p>
<p id="p-0034" num="0033">As mentioned above, the illustrated currents may be representative in terms of timing and amplitude, but actual current may vary due to the non-linearity of magnetic force as an actuator armature approaches an electromagnet. Armature coil control currents <b>403</b> and <b>404</b> represent the opening and closing coil currents for the valve trajectories <b>401</b> and <b>402</b> respectively. The valves are shown commanded similarly, but different commanded currents are possible (e.g., more or less current, changes in duration of current, and/or changes to current timing) since the valve release/repulse positions are different.</p>
<p id="p-0035" num="0034">The advanced timing of single coil control profile <b>401</b> shows an intake valve closing (IVC) location that corresponds to a piston closer to the cylinder head. At this IVC position, the cylinder volume is smaller than the cylinder volume of the IVC location shown in the retarded ballistic profile curve <b>402</b>. Changing IVC location can increase cylinder air charge as shown in cylinder air amount curves <b>405</b> and <b>406</b>. Specifically, the cylinder air amount shown by curve <b>405</b>, the advanced curve <b>405</b>, begins to increase at the valve opening and continues to increase until the valve is closed. The cylinder air amount shown by curve <b>406</b>, the retarded curve, also begins to increase at valve opening and continues to increase until the valve is closed. However, the total cylinder air amount depicted by the retarded valve timing, curve <b>406</b>, is increased over the cylinder air amount shown in the advanced curve <b>405</b>. The rate of change in cylinder air charge is higher for curve <b>406</b> because the piston position is lower in the cylinder and thus may provide additional vacuum in the cylinder. Furthermore, additional space for air may be provided since the cylinder volume can be increasing as the piston moves further through the intake stroke. Thus, curves <b>405</b> and <b>406</b> illustrate that the timing of a valve operated by single coil control can be used to change cylinder air amount. In general, the amount of air inducted into a cylinder can be increased by retarding single coil controlled valve timing and decreased by advancing single coil controlled valve timing, at least during some conditions.</p>
<p id="p-0036" num="0035">A valve controlled by a single coil may or may not have permanent magnets in the armature plate. If permanent magnets are used current may be controlled to repel or attract an armature that is near a coil. If a non-permanent magnet armature is used the armature may be attracted to the coil. Therefore, the current used to control an actuator by a single coil can be different based on the actuator type and design.</p>
<p id="p-0037" num="0036">This mode of operation may be used to adjust valve control during step <b>716</b> of <figref idref="DRAWINGS">FIG. 7</figref>. Furthermore, the method can be used when an electrically actuated valve is substantially closed (i.e., when the valve is in a position that does not permit flow through port <b>219</b>).</p>
<p id="p-0038" num="0037">Referring to <figref idref="DRAWINGS">FIG. 5</figref>, a plot of hyper-ballistic valve control variables is shown.</p>
<p id="p-0039" num="0038">Hyper-ballistic valve trajectories can alter valve lift without capturing or holding the valve actuator armature at a substantially stationary position (e.g., &#xb1;0.5 mm) during a portion of the valve open region. As the actuator armature is released and/or repelled from proximity of the closing coil, current can be adjusted in the opening coil such that the natural response of the valve apparatus may be altered. In one example, current can be adjusted to the opening coil so that the peak valve lift approaches the fully open position. In another example, current can be adjusted to the opening coil so that the peak valve lift may be less than the valve lift amount of the natural valve response. In addition, the current in the open and/or closing coils may be used to extend the valve opening duration compared to single coil (ballistic) valve control.</p>
<p id="p-0040" num="0039">Continuing with <figref idref="DRAWINGS">FIG. 5</figref>, two valve profiles are shown having a peak opening amount of approximately 6.5 mm. These valve profiles have durations and lift amounts that are less than (6.5 mm vs. 7.6 mm) the amount illustrated in <figref idref="DRAWINGS">FIG. 4</figref> that shows conditions simulating a single coil controlled valve profile. Similar to <figref idref="DRAWINGS">FIG. 4</figref>, the two valve profiles are shown for two different events to illustrate different cylinder air amounts that may be produced. The valve profiles are similar in shape to one another, but the valve opening and closing locations are phased with respect to the crankshaft. The reduced amplitude can be produced by controlling the current in the valve opening coil so that the armature plate is repelled as it approaches the opening magnet, at least in some actuator designs. In other words, the opening electromagnet can be used to augment the closing spring force so that the force applied to the armature may be increased in the closing direction. Furthermore, the current may be used to increase the force applied to the armature in a non-linear manner. For example, the force applied to the armature by the coil may be a function of the square of the distance that the armature plate is from the actuator coil. This operating mode can be used in armatures with permanent magnets or in other actuator designs that can provide a repulsion force between the electromagnetic coils and the armature. In this way, electrically actuated valves can be controlled to produce varying amounts of valve lift and opening duration. Typically, the valve position moves throughout the valve trajectory. For example, the valve position can move open (increase) monotonically until the high lift location is reached, and the valve position can close (decrease) monotonically immediately after the high lift location is reached.</p>
<p id="p-0041" num="0040">Valve current is shown for valve opening event <b>502</b>. Valve closing coil current <b>503</b> is shown repelling and then attracting the armature <b>207</b>. The opening coil current <b>504</b> provides a current that can act to repel a permanent magnet armature. This current may act to attract or repel the armature during a part or all of the valve opening duration so that the armature position is non-symmetrically controlled.</p>
<p id="p-0042" num="0041"><figref idref="DRAWINGS">FIG. 5</figref> also illustrates that valve opening and closing phasing may be used in conjunction with varying valve lift to provide additional degrees of freedom in controlling cylinder air amount. For example, curve <b>505</b> represents the amount of cylinder air amount inducted during a valve event having lift profile <b>501</b>. The amount of air inducted can be reduced compared to the amount shown by curve <b>405</b> of <figref idref="DRAWINGS">FIG. 4</figref>. Depending on engine operating conditions, the reduced valve height can restrict air flow into the cylinder and may result in a lower cylinder air charge. However, curve <b>506</b> shows that the cylinder air amount may be increased, when the lift has been reduced, by moving the valve opening and closing positions with respect to the crankshaft position. Thus, curves <b>505</b> and <b>506</b> show that cylinder air amount can be adjusted by valve lift and timing. In addition, when the lift is adjusted the valve open duration often changes too.</p>
<p id="p-0043" num="0042">Valves may be operated in this manner during steps <b>716</b> and <b>720</b> of <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0044" num="0043">Referring to <figref idref="DRAWINGS">FIG. 6</figref>, another plot of hyper-ballistic valve control variables is shown. Two valve trajectories approach the full valve open position (8 mm), but do not reach the full open position. In addition, the valve opening duration can be increased compared to the valve opening duration shown in <figref idref="DRAWINGS">FIG. 4</figref> as the lift is increased. The curves are shown to illustrate the effect of valve timing on two different induction events. The valve trajectory curves <b>601</b>-<b>602</b> illustrate that the valve amplitude and duration may be increased without substantially capturing or holding the valve in the open position. Specifically, the valve trajectories monotonically increase until the high lift point and the valve can close by monotonically decreasing until the valve is closed, immediately thereafter. The valve trajectory also shows that the valve direction can reverse without the magnetic coil holding the valve at the full open valve lift location.</p>
<p id="p-0045" num="0044">Valve trajectory <b>601</b> is shown in an advanced location, with respect to valve trajectory <b>602</b>, to illustrate that valve opening and closing can be controlled simultaneously with valve lift.</p>
<p id="p-0046" num="0045">Valve current is shown for valve opening event <b>602</b>. Curve <b>603</b> illustrates current for the closing coil and curve <b>604</b> illustrates current for the opening coil. The current is shown going negative in the closing coil, between &#x2212;10 and 20 crankshaft angle degrees, to show that the armature may be repulsed from the coil. The closing coil current is shown as positive, indicating an attractive force, between 40 and 75 crankshaft angle degrees. The opening coil current is shown as a positive current to illustrate that the armature is being drawn toward the opening coil. As mentioned above, the current in the opening coil may act to attract or repel the armature during a part or all of the valve opening duration so that the armature position is non-symmetrically controlled.</p>
<p id="p-0047" num="0046">Curve <b>605</b> represents the amount of cylinder air inducted during a valve event having lift profile <b>601</b>. The amount of air inducted is increased compared to the amount shown by curve <b>405</b> of <figref idref="DRAWINGS">FIG. 4</figref>. Depending on engine operating conditions, the increased valve height can improve air flow into the cylinder and may result in a higher cylinder air charge. However, curve <b>606</b> shows that the cylinder air amount may be further increased, when the lift has been increased, by moving the valve opening and closing positions with respect to the crankshaft position.</p>
<p id="p-0048" num="0047">A valve controlled by two coils may or may not have permanent magnets in the armature plate. If permanent magnets are used current may be controlled to repel or attract an armature that is near a coil. If a non-permanent magnet armature is used the armature may be attracted to the coil. Therefore, the current used to control an actuator by a two coils can be different based on the actuator type and design.</p>
<p id="p-0049" num="0048">Valves may be operated in this manner during steps <b>716</b> and <b>720</b> of <figref idref="DRAWINGS">FIG. 7</figref>.</p>
<p id="p-0050" num="0049">Referring to <figref idref="DRAWINGS">FIG. 7</figref>, a flow chart of an example valve timing strategy is shown. In step <b>701</b>, valve operating variables that can be stored in memory from a previous single coil controlled valve event and/or hyper-ballistic valve opening event can be recalled from memory. For example, intake valve open position, intake valve closing position, peak valve lift amount, engine temperature, valve actuator temperature, inducted cylinder air amount, manifold pressure, time since engine start, and the number of valve operations since power on can be recalled from memory. Each of the before-mentioned variables can be retrieved from unique memory locations that characterize valve operation at different engine speeds, loads, and valve release and/or repulsion locations (i.e., relative crankshaft position). In addition, engine speed, engine coolant temperature, air charge temperature, and air charge humidity can be retrieved from memory. After the parameters are recalled from memory the routine proceeds to step <b>703</b>.</p>
<p id="p-0051" num="0050">In step <b>703</b>, desired cylinder air amount and exhaust gas recirculation (EGR) can be determined. In one example, operator demand (desired brake torque) can be determined by sensing pedal position sensor <b>119</b> and it may be converted to a desired brake torque. By knowing the current engine speed and operator demand, a desired cylinder air amount can be established from empirically determined tables or from regressed data. The method described in U.S. patent application Ser. No. 10/805,642 can be used to determine cylinder air charge and the application is hereby fully incorporated into this description by reference. Specifically, the method relates engine torque to individual cylinder pressure and uses a regression to determine an amount of fuel to be delivered to individual cylinders.</p>
<p id="p-0052" num="0051">Cylinder pumping and friction losses of an active cylinder can be based on the following regression equations A and B:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>PMEP<sub>Act</sub><i>=C</i><sub>0</sub><i>+C</i><sub>1</sub><i>&#xb7;V</i><sub>IVO</sub><i>+C</i><sub>2</sub><i>&#xb7;V</i><sub>EVC</sub><i>+C</i><sub>3</sub><i>&#xb7;V</i><sub>IVC-IVO</sub><i>+C</i><sub>4</sub><i>&#xb7;N</i>&#x2003;&#x2003;Equation A:<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where PMEP<sub>Act </sub>is pumping mean effective pressure, C<sub>0</sub>-C<sub>4 </sub>are stored, predetermined, polynomial coefficients, V<sub>IVO </sub>is cylinder volume at intake valve opening position, V<sub>EVC </sub>is cylinder volume at exhaust valve closing position, V<sub>IVC </sub>is cylinder volume at intake valve closing position, V<sub>IVO </sub>is cylinder intake valve opening position, and N is engine speed. Valve timing locations intake valve open (IVO) and intake valve closed (IVC) are based on the last set of determined valve timings.
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>FMEP<sub>Act</sub><i>=C</i><sub>0</sub><i>+C</i><sub>1</sub><i>&#xb7;N+C</i><sub>2</sub><i>&#xb7;N</i><sup>2</sup>&#x2003;&#x2003;Equation B:<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where FMEP<sub>Act </sub>is friction mean effective pressure, C<sub>0</sub>-C<sub>2 </sub>stored, predetermined polynomial coefficients, and N is engine speed.
</p>
<p id="p-0053" num="0052">Cylinder pumping and friction losses of a deactivated cylinder can be based on the following regression equations C and D:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>PMEP<sub>Deact</sub><i>=C</i><sub>0</sub><i>=C</i><sub>1&#xb7;N+C</sub><sub>2</sub><i>&#xb7;N</i><sup>2</sup>&#x2003;&#x2003;Equation C:<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where PMEP<sub>Deact </sub>is friction mean effective pressure, C<sub>0</sub>-C<sub>2 </sub>are stored, predetermined polynomial coefficients, and N is engine speed.
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>FMEP<sub>Deact</sub><i>=C</i><sub>0</sub><i>=C</i><sub>1</sub><i>&#xb7;N+C</i><sub>2</sub><i>&#xb7;N</i><sup>2</sup>&#x2003;&#x2003;Equation D:<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where FMEP<sub>Deact </sub>is friction mean effective pressure, C<sub>0</sub>-C<sub>2 </sub>are stored, predetermined polynomial coefficients, and N is engine speed.
</p>
<p id="p-0054" num="0053">The following describes further exemplary details for the regression and interpolation schemes. One dimensional functions are used to store friction and pumping polynomial coefficients for active and inactive cylinders. The data taken to determine the coefficients are collected at a sufficient number of engine speed points to provide the desired torque loss accuracy. Coefficients can be interpolated between locations where no data exists. For example, data can be collected and coefficients can be determined for an engine at engine speeds of 600, 1000, 2000, and 3000 RPM. If the engine is then operated at 1500 RPM, coefficients from 1000 and 2000 RPM can be interpolated to determine the coefficients for 1500 RPM. Total friction losses can then determined by at least one of the following equations:</p>
<p id="p-0055" num="0054">
<maths id="MATH-US-00001" num="00001">
<math overflow="scroll">
  <mrow>
    <msub>
      <mi>FMEP</mi>
      <mi>total</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
      <mtable>
        <mtr>
          <mtd>
            <mrow>
              <mo>[</mo>
              <mrow>
                <mrow>
                  <msub>
                    <mi>Numcyl</mi>
                    <mi>Act</mi>
                  </msub>
                  <mo>&#xb7;</mo>
                  <msub>
                    <mi>FMEP</mi>
                    <mi>Act</mi>
                  </msub>
                </mrow>
                <mo>+</mo>
              </mrow>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mrow>
                <msub>
                  <mi>Numcyl</mi>
                  <mi>Dact</mi>
                </msub>
                <mo>&#xb7;</mo>
                <mrow>
                  <msub>
                    <mi>FMEP</mi>
                    <mi>Dact</mi>
                  </msub>
                  <mo>&#x2061;</mo>
                  <mrow>
                    <mo>(</mo>
                    <msub>
                      <mi>t</mi>
                      <mi>deact</mi>
                    </msub>
                    <mo>)</mo>
                  </mrow>
                </mrow>
              </mrow>
              <mo>]</mo>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
      <msub>
        <mi>Numcyl</mi>
        <mi>total</mi>
      </msub>
    </mfrac>
  </mrow>
</math>
</maths>
<maths id="MATH-US-00001-2" num="00001.2">
<math overflow="scroll">
  <mi>or</mi>
</math>
</maths>
<maths id="MATH-US-00001-3" num="00001.3">
<math overflow="scroll">
  <mrow>
    <msub>
      <mi>FMEP</mi>
      <mi>total</mi>
    </msub>
    <mo>=</mo>
    <mrow>
      <mrow>
        <mi>Modfact</mi>
        <mo>&#xb7;</mo>
        <msub>
          <mi>FMEP</mi>
          <mi>Act</mi>
        </msub>
      </mrow>
      <mo>+</mo>
      <mrow>
        <mrow>
          <mo>(</mo>
          <mrow>
            <mn>1</mn>
            <mo>-</mo>
            <mi>Modfact</mi>
          </mrow>
          <mo>)</mo>
        </mrow>
        <mo>&#xb7;</mo>
        <msub>
          <mi>FMEP</mi>
          <mi>Deact</mi>
        </msub>
      </mrow>
    </mrow>
  </mrow>
</math>
</maths>
<br/>
Where Numcyl<sub>Act </sub>is the number of active cylinders, Numcyl<sub>Dact </sub>is the number of deactivated cylinders, Modfact is the ratio of the number of active cylinders to total number of cylinders, and FMEP<sub>total </sub>is the total friction mean effective pressure. Total pumping losses can be determined by one of the following equations:
</p>
<p id="p-0056" num="0055">
<maths id="MATH-US-00002" num="00002">
<math overflow="scroll">
  <mrow>
    <msub>
      <mi>PMEP</mi>
      <mi>total</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
      <mtable>
        <mtr>
          <mtd>
            <mrow>
              <mo>[</mo>
              <mrow>
                <mrow>
                  <msub>
                    <mi>Numcyl</mi>
                    <mi>Act</mi>
                  </msub>
                  <mo>*</mo>
                  <msub>
                    <mi>PMEP</mi>
                    <mi>Act</mi>
                  </msub>
                </mrow>
                <mo>+</mo>
              </mrow>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mrow>
                <msub>
                  <mi>Numcyl</mi>
                  <mi>Dactt</mi>
                </msub>
                <mo>*</mo>
                <mrow>
                  <msub>
                    <mi>PMEP</mi>
                    <mi>Dact</mi>
                  </msub>
                  <mo>&#x2061;</mo>
                  <mrow>
                    <mo>(</mo>
                    <msub>
                      <mi>t</mi>
                      <mi>deact</mi>
                    </msub>
                    <mo>)</mo>
                  </mrow>
                </mrow>
              </mrow>
              <mo>]</mo>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
      <msub>
        <mi>Numcyl</mi>
        <mi>total</mi>
      </msub>
    </mfrac>
  </mrow>
</math>
</maths>
<maths id="MATH-US-00002-2" num="00002.2">
<math overflow="scroll">
  <mi>or</mi>
</math>
</maths>
<maths id="MATH-US-00002-3" num="00002.3">
<math overflow="scroll">
  <mrow>
    <msub>
      <mi>PMEP</mi>
      <mi>total</mi>
    </msub>
    <mo>=</mo>
    <mrow>
      <mrow>
        <mi>Modfact</mi>
        <mo>&#xb7;</mo>
        <msub>
          <mi>PMEP</mi>
          <mi>Act</mi>
        </msub>
      </mrow>
      <mo>+</mo>
      <mrow>
        <mrow>
          <mo>(</mo>
          <mrow>
            <mn>1</mn>
            <mo>-</mo>
            <mi>Modfact</mi>
          </mrow>
          <mo>)</mo>
        </mrow>
        <mo>&#xb7;</mo>
        <msub>
          <mi>PMEP</mi>
          <mi>Dact</mi>
        </msub>
      </mrow>
    </mrow>
  </mrow>
</math>
</maths>
<br/>
Where Numcyl<sub>Act </sub>is the number of active cylinders, Numcyl<sub>Dact </sub>is the number of deactivated cylinders, Modfact is the ratio of the number of active cylinders to total number of cylinders, and PMEP<sub>total </sub>is the total pumping mean effective pressure. Additional or fewer polynomial terms may be used in the regressions for PMEP<sub>Act</sub>, PMEP<sub>Deact</sub>, FMEP<sub>Act</sub>, and FMEP<sub>Deact </sub>based on the desired curve fit and strategy complexity.
</p>
<p id="p-0057" num="0056">The losses based on pressure can be transformed into torque by the following equations:</p>
<p id="p-0058" num="0057">
<maths id="MATH-US-00003" num="00003">
<math overflow="scroll">
  <mrow>
    <msub>
      <mi>&#x393;</mi>
      <mi>friction_total</mi>
    </msub>
    <mo>=</mo>
    <mrow>
      <msub>
        <mi>FMEP</mi>
        <mi>total</mi>
      </msub>
      <mo>&#xb7;</mo>
      <mfrac>
        <msub>
          <mi>V</mi>
          <mi>D</mi>
        </msub>
        <mrow>
          <mn>4</mn>
          <mo>&#xb7;</mo>
          <mi>&#x3c0;</mi>
        </mrow>
      </mfrac>
      <mo>&#xb7;</mo>
      <mfrac>
        <mrow>
          <mi>N</mi>
          <mo>/</mo>
          <msup>
            <mi>m</mi>
            <mn>2</mn>
          </msup>
        </mrow>
        <mrow>
          <mo>(</mo>
          <mrow>
            <mrow>
              <mn>1</mn>
              <mo>&#xb7;</mo>
              <msup>
                <mn>10</mn>
                <mrow>
                  <mo>-</mo>
                  <mn>5</mn>
                </mrow>
              </msup>
            </mrow>
            <mo>&#x2062;</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>&#x2062;</mo>
            <mi>bar</mi>
          </mrow>
          <mo>)</mo>
        </mrow>
      </mfrac>
    </mrow>
  </mrow>
</math>
</maths>
<maths id="MATH-US-00003-2" num="00003.2">
<math overflow="scroll">
  <mrow>
    <msub>
      <mi>&#x393;</mi>
      <mi>pumping_total</mi>
    </msub>
    <mo>=</mo>
    <mrow>
      <msub>
        <mi>PMEP</mi>
        <mi>total</mi>
      </msub>
      <mo>&#xb7;</mo>
      <mfrac>
        <msub>
          <mi>V</mi>
          <mi>D</mi>
        </msub>
        <mrow>
          <mn>4</mn>
          <mo>&#xb7;</mo>
          <mi>&#x3c0;</mi>
        </mrow>
      </mfrac>
      <mo>&#xb7;</mo>
      <mfrac>
        <mrow>
          <mi>N</mi>
          <mo>/</mo>
          <msup>
            <mi>m</mi>
            <mn>2</mn>
          </msup>
        </mrow>
        <mrow>
          <mo>(</mo>
          <mrow>
            <mrow>
              <mn>1</mn>
              <mo>&#xb7;</mo>
              <msup>
                <mn>10</mn>
                <mrow>
                  <mo>-</mo>
                  <mn>5</mn>
                </mrow>
              </msup>
            </mrow>
            <mo>&#x2062;</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>&#x2062;</mo>
            <mi>bar</mi>
          </mrow>
          <mo>)</mo>
        </mrow>
      </mfrac>
    </mrow>
  </mrow>
</math>
</maths>
<br/>
Where V<sub>D </sub>is the displacement volume of active cylinders. Then, indicated mean effective pressure (IMEP) for each cylinder can be determined, for example via the equation:
</p>
<p id="p-0059" num="0058">
<maths id="MATH-US-00004" num="00004">
<math overflow="scroll">
<mrow>
  <mrow>
    <msub>
      <mi>IMEP</mi>
      <mi>cyl</mi>
    </msub>
    <mo>&#x2061;</mo>
    <mrow>
      <mo>(</mo>
      <mi>bar</mi>
      <mo>)</mo>
    </mrow>
  </mrow>
  <mo>=</mo>
  <mrow>
    <mrow>
      <mo>(</mo>
      <mfrac>
        <mtable>
          <mtr>
            <mtd>
              <mrow>
                <msub>
                  <mi>&#x393;</mi>
                  <mi>brake</mi>
                </msub>
                <mo>-</mo>
                <mrow>
                  <mo>(</mo>
                  <mrow>
                    <msub>
                      <mi>&#x393;</mi>
                      <mi>friction_total</mi>
                    </msub>
                    <mo>+</mo>
                  </mrow>
                </mrow>
              </mrow>
            </mtd>
          </mtr>
          <mtr>
            <mtd>
              <mrow>
                <mrow>
                  <msub>
                    <mi>&#x393;</mi>
                    <mi>pumping_total</mi>
                  </msub>
                  <mo>+</mo>
                  <msub>
                    <mi>&#x393;</mi>
                    <mi>accessories_total</mi>
                  </msub>
                </mrow>
                <mo>)</mo>
              </mrow>
            </mtd>
          </mtr>
        </mtable>
        <msub>
          <mi>Num_cyl</mi>
          <mi>Act</mi>
        </msub>
      </mfrac>
      <mo>)</mo>
    </mrow>
    <mo>*</mo>
    <mfrac>
      <mrow>
        <mn>4</mn>
        <mo>&#x2062;</mo>
        <mstyle>
          <mspace width="0.3em" height="0.3ex"/>
        </mstyle>
        <mo>&#x2062;</mo>
        <mi>&#x3c0;</mi>
      </mrow>
      <msub>
        <mi>V</mi>
        <mi>D</mi>
      </msub>
    </mfrac>
    <mo>*</mo>
    <mrow>
      <mfrac>
        <mrow>
          <mo>(</mo>
          <mrow>
            <mn>1</mn>
            <mo>*</mo>
            <msup>
              <mn>10</mn>
              <mrow>
                <mo>-</mo>
                <mn>5</mn>
              </mrow>
            </msup>
            <mo>&#x2062;</mo>
            <mstyle>
              <mspace width="0.8em" height="0.8ex"/>
            </mstyle>
            <mo>&#x2062;</mo>
            <mi>bar</mi>
          </mrow>
          <mo>)</mo>
        </mrow>
        <mrow>
          <mi>N</mi>
          <mo>/</mo>
          <msup>
            <mi>m</mi>
            <mn>2</mn>
          </msup>
        </mrow>
      </mfrac>
      <mo>&#xb7;</mo>
      <mi>SPKTR</mi>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
</p>
<p id="p-0060" num="0059">Where Num_cyl<sub>Act </sub>is the number of active cylinders, V<sub>D </sub>is the displacement volume of active cylinders, SPKTR is a torque ratio based on spark angle retarded from minimum best torque (MBT), i.e., the minimum amount of spark angle advance that produces the best torque amount. Additional or fewer polynomial terms may be used in the regression based on the desired curve fit and strategy complexity. Alternatively, different estimation formats can also be used. The term SPKTR can be based on the equation:</p>
<p id="p-0061" num="0060">
<maths id="MATH-US-00005" num="00005">
<math overflow="scroll">
<mrow>
  <mi>SPKTR</mi>
  <mo>=</mo>
  <mfrac>
    <msub>
      <mi>&#x393;</mi>
      <mrow>
        <mi>&#x394;</mi>
        <mo>&#x2062;</mo>
        <mstyle>
          <mspace width="0.3em" height="0.3ex"/>
        </mstyle>
        <mo>&#x2062;</mo>
        <mi>SPK</mi>
      </mrow>
    </msub>
    <msub>
      <mi>&#x393;</mi>
      <mi>MBT</mi>
    </msub>
  </mfrac>
</mrow>
</math>
</maths>
<br/>
Where &#x393;<sub>&#x394;SPK </sub>is the torque at a spark angle retarded from minimum spark for best torque (MBT), &#x393;<sub>MBT </sub>is the torque at MBT. In one example, the actual value of SPKTR can be determined from a regression based on the equation:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>SPKTR=C<sub>0</sub><i>+C</i><sub>1</sub>*&#x394;<sub>spark</sub><sup>2</sup><i>+C</i><sub>2</sub>*&#x394;<sub>spark</sub><sup>2</sup><i>*N+C</i><sub>3</sub>*&#x394;<sub>spark</sub><sup>2</sup>*IMEP<sub>MBT </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where C<sub>0</sub>-C<sub>3 </sub>are stored, predetermined, regressed polynomial coefficients, N is engine speed, and IMEP<sub>MBT </sub>is IMEP at MBT spark timing. The value of SPKTR can range from 0 to 1 depending on the spark retard from MBT.
</p>
<p id="p-0062" num="0061">Individual cylinder fuel mass can be determined, in one example, for each cylinder by the following equation:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>m<sub>f</sub><i>=C</i><sub>0</sub><i>+C</i><sub>1</sub><i>*N+C</i><sub>2</sub>*AFR+C<sub>3</sub>*AFR<sup>2</sup><i>+C</i><sub>4</sub>*IMEP+C<sub>5</sub>*IMEP<sup>2</sup><i>+C</i><sub>6</sub><i>*IMEP*N </i><?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where m<sub>f </sub>is mass of fuel, C<sub>0</sub>-C<sub>6 </sub>are stored, predetermined, regressed polynomial coefficients, N is engine speed, AFR is the air-fuel ratio, and IMEP is indicated mean effective pressure. As indicated previously, additional or fewer polynomial terms may be used in the regression based on the desired curve fit and strategy complexity. For example, polynomial terms for engine temperature, air charge temperature, and altitude might also be included.
</p>
<p id="p-0063" num="0062">A desired air charge can be determined from the desired fuel charge. In one example, a predetermined air-fuel mixture (based on engine speed, temperature, and load), with or without exhaust gas sensor feedback, can be used to determine a desired air-fuel ratio. The determined fuel mass from above can be multiplied by the predetermined desired air-fuel ratio to determine a desired cylinder air amount. The desired mass of air can be determined from the equation:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>m<sub>a</sub><i>=</i><sub>f</sub>&#xb7;AFR<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where m<sub>a </sub>is the desired mass of air entering a cylinder, m<sub>f </sub>is the desired mass of fuel entering a cylinder, and AFR is the desired air-fuel ratio.
</p>
<p id="p-0064" num="0063">In addition, EGR can be determined by indexing a table containing empirically determined EGR amounts. The specific values of table entries are based on engine emissions, combustion stability, and fuel economy. Furthermore, the table can be indexed by engine speed, engine temperature, and cylinder load. The routine then proceeds to step <b>705</b>.</p>
<p id="p-0065" num="0064">In step <b>705</b>, a decision to perform single coil controlled, hyper-ballistic, or an alternate valve control is made. The cylinder air amount determined from step <b>303</b> is compared to a range of cylinder air amounts that may be available using single coil controlled (i.e., using a single coil of a dual coil actuator or using the coil of a single coil dual plate actuator) to control a valve or or hyper-ballistic valve modes, at the present engine speed. In addition, since the cylinder air amount can be a function of available cylinder volume and EGR amount, the EGR amount determined in step <b>303</b> can be used to determine if the combined EGR amount and cylinder air amount are possible in single coil controlled or hyper-ballistic mode. For example, since a valve operated in single coil controlled or hyper-ballistic mode may not be captured or held substantially motionless by an opening magnetic coil; there may be limited control over the valve opening duration. Consequently, the amount of intake and exhaust valve overlap may be limited at an engine operating condition because the cylinder may not be able to hold the desired EGR and air charge since there may be limited control over the intake valve opening duration. If the desired cylinder air amount and EGR amount is not within the single coil controlled or hyper-ballistic timing range or if single coil controlled or hyper ballistic mode control is not desirable based on other engine operating conditions (e.g., engine temperature, barometric pressure, and time since start) the routine proceeds to step <b>712</b>. Otherwise, the routine proceeds to step <b>707</b>.</p>
<p id="p-0066" num="0065">At step <b>707</b>, valve timing for single coil controlled mode or hyper-ballistic mode can be determined. In one example, desired cylinder air amount and EGR amount can be retrieved from step <b>703</b>, providing a basis for intake and exhaust valve timing. Valve timing can be determined in accordance with U.S. Pat. No. 6,850,831 which is hereby fully incorporated by reference. The volume at IVC for the desired mass of air entering a cylinder can be described by the following equation:</p>
<p id="p-0067" num="0066">
<maths id="MATH-US-00006" num="00006">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>V</mi>
    <mrow>
      <mi>a</mi>
      <mo>,</mo>
      <mi>IVC</mi>
    </mrow>
  </msub>
  <mo>=</mo>
  <mfrac>
    <msub>
      <mi>m</mi>
      <mi>a</mi>
    </msub>
    <msub>
      <mi>&#x3c1;</mi>
      <mrow>
        <mi>a</mi>
        <mo>,</mo>
        <mi>IVC</mi>
      </mrow>
    </msub>
  </mfrac>
</mrow>
</math>
</maths>
<br/>
Where &#x3c1;<sub>a, IVC </sub>is the density of air at IVC, V<sub>a, IVC </sub>is the volume of air in the cylinder at IVC. The density of air at IVC can be determined by adjusting the density of air to account for the change in temperature and pressure at IVC by the following equation:
</p>
<p id="p-0068" num="0067">
<maths id="MATH-US-00007" num="00007">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>&#x3c1;</mi>
    <mrow>
      <mi>a</mi>
      <mo>,</mo>
      <mi>IVC</mi>
    </mrow>
  </msub>
  <mo>=</mo>
  <mrow>
    <msub>
      <mi>&#x3c1;</mi>
      <mi>amb</mi>
    </msub>
    <mo>&#xb7;</mo>
    <mfrac>
      <msub>
        <mi>T</mi>
        <mi>amb</mi>
      </msub>
      <msub>
        <mi>T</mi>
        <mi>IVC</mi>
      </msub>
    </mfrac>
    <mo>&#xb7;</mo>
    <mfrac>
      <msub>
        <mi>P</mi>
        <mi>IVC</mi>
      </msub>
      <msub>
        <mi>P</mi>
        <mi>amb</mi>
      </msub>
    </mfrac>
  </mrow>
</mrow>
</math>
</maths>
<br/>
Where &#x3c1;<sub>amb </sub>is the density of air at ambient conditions, T<sub>amb </sub>is ambient temperature, T<sub>IVC </sub>is the temperature of air at IVC, P<sub>IVC </sub>is the pressure in the cylinder at IVC, and P<sub>amb </sub>is ambient pressure. In one example, when IVC occurs before bottom-dead-center (BDC) pressure in the cylinder at IVC can be determined by differentiating the ideal gas law forming the following equation:
</p>
<p id="p-0069" num="0068">
<maths id="MATH-US-00008" num="00008">
<math overflow="scroll">
<mrow>
  <msub>
    <mover>
      <mi>P</mi>
      <mo>.</mo>
    </mover>
    <mi>IVC</mi>
  </msub>
  <mo>=</mo>
  <mfrac>
    <mrow>
      <mrow>
        <msub>
          <mover>
            <mi>m</mi>
            <mo>.</mo>
          </mover>
          <mi>cyl</mi>
        </msub>
        <mo>&#xb7;</mo>
        <mi>R</mi>
        <mo>&#xb7;</mo>
        <mi>T</mi>
      </mrow>
      <mo>-</mo>
      <mrow>
        <msub>
          <mi>P</mi>
          <mi>IVC</mi>
        </msub>
        <mo>&#xb7;</mo>
        <mover>
          <mi>V</mi>
          <mo>.</mo>
        </mover>
      </mrow>
    </mrow>
    <mi>V</mi>
  </mfrac>
</mrow>
</math>
</maths>
<br/>
Where P<sub>IVC </sub>is cylinder pressure, V is cylinder volume, R is the universal gas constant, and {dot over (m)} is flow rate into the cylinder estimated by:
</p>
<p id="p-0070" num="0069">
<maths id="MATH-US-00009" num="00009">
<math overflow="scroll">
<mrow>
  <msub>
    <mover>
      <mi>m</mi>
      <mo>.</mo>
    </mover>
    <mi>cyl</mi>
  </msub>
  <mo>=</mo>
  <mrow>
    <mfrac>
      <mrow>
        <msub>
          <mi>C</mi>
          <mi>D</mi>
        </msub>
        <mo>&#xb7;</mo>
        <mrow>
          <msub>
            <mi>A</mi>
            <mi>valve</mi>
          </msub>
          <mo>&#x2061;</mo>
          <mrow>
            <mo>(</mo>
            <mi>&#x398;</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mo>&#xb7;</mo>
        <msub>
          <mi>P</mi>
          <mi>run</mi>
        </msub>
      </mrow>
      <msqrt>
        <mrow>
          <mi>R</mi>
          <mo>&#xb7;</mo>
          <mi>T</mi>
        </mrow>
      </msqrt>
    </mfrac>
    <mo>&#xb7;</mo>
    <msup>
      <mrow>
        <mo>(</mo>
        <mfrac>
          <msub>
            <mi>P</mi>
            <mi>cyl</mi>
          </msub>
          <msub>
            <mi>P</mi>
            <mi>run</mi>
          </msub>
        </mfrac>
        <mo>)</mo>
      </mrow>
      <mfrac>
        <mn>1</mn>
        <mi>&#x3b3;</mi>
      </mfrac>
    </msup>
    <mo>&#xb7;</mo>
    <msqrt>
      <mrow>
        <mfrac>
          <mrow>
            <mn>2</mn>
            <mo>&#xb7;</mo>
            <mi>&#x3b3;</mi>
          </mrow>
          <mrow>
            <mi>&#x3b3;</mi>
            <mo>-</mo>
            <mn>1</mn>
          </mrow>
        </mfrac>
        <mo>&#xb7;</mo>
        <msup>
          <mrow>
            <mo>(</mo>
            <mfrac>
              <msub>
                <mi>P</mi>
                <mi>IVC</mi>
              </msub>
              <msub>
                <mi>P</mi>
                <mi>run</mi>
              </msub>
            </mfrac>
            <mo>)</mo>
          </mrow>
          <mfrac>
            <mrow>
              <mi>&#x3b3;</mi>
              <mo>-</mo>
              <mn>1</mn>
            </mrow>
            <mi>&#x3b3;</mi>
          </mfrac>
        </msup>
      </mrow>
    </msqrt>
  </mrow>
</mrow>
</math>
</maths>
<br/>
Where C<sub>D </sub>is the valve coefficient of discharge, A<sub>valve</sub>(&#x3b8;) is effective valve area as a function of crankshaft angle &#x3b8;, P<sub>run </sub>is the manifold runner pressure which can be assumed as manifold pressure at lower engine speeds, and &#x3b3; is the ratio of specific heats. C<sub>D </sub>is calibratible and can be empirically determined.
</p>
<p id="p-0071" num="0070">The effective valve area, A<sub>valve</sub>(&#x3b8;), can vary depending on the valve mode (e.g., single coil controlled or hyper-ballistic), the amount and timing of opening and/or closing coil current (used to describe a change in lift profile), the closing coil release and/or repulsion location (measured relative to crankshaft position), and the engine speed. In one example, the valve lift can be described for single coil controlled and hyper-ballistic operation by using the equation of a polynomial:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>f</i>(<i>x</i>)=<i>ax</i><sup>4</sup><i>+bx</i><sup>3</sup><i>+cx</i><sup>2</sup><i>+dx+e </i><?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where the coefficients a-e may be obtained by fitting a recorded trajectory of a single coil controlled valve profile to the polynomial. Parameterization of the coefficients can be use to modify the base polynomial into the desired form so that hyper-ballistic and other operational variations may be described. For example, the trajectory of a single coil controlled valve can be captured at a selected engine speed and a selected valve release and/or repulsion location (e.g., 20 crank angle degrees after TDC intake stroke). The recorded data can be fit to an equation that describes a polynomial or alternately another function. Further, the coefficients that describe the basic form of the polynomial can be modified so that the height and/or width of the basic polynomial changes from the curve that describes the original ballistic profile. The coefficients may be stored at selected intervals that may depend on engine operating conditions such as engine speed, valve release location, and engine temperature.
</p>
<p id="p-0072" num="0071">The valve lift profile can be combined with the valve dimensions to estimate the effective area, A<sub>valve</sub>(&#x3b8;) via the following equation:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>A</i><sub>valve</sub>(&#x398;)=<i>L</i>(&#x398;)&#xb7;2&#xb7;&#x3c0;&#xb7;<i>d </i><?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where L(&#x3b8;) is the valve lift amount determined from the above-mentioned polynomial as a function of crankshaft angle &#x3b8;, and d is the valve seat diameter.
</p>
<p id="p-0073" num="0072">The volume of air at IVC can be determined from the following equation:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>V</i><sub>a,IVC</sub><i>=f</i><sub>air</sub><i>&#xb7;V</i><sub>i,IVC</sub>+(1&#x2212;<i>F</i><sub>e</sub>)&#xb7;<i>V</i><sub>r,IVC </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where f<sub>air </sub>is the proportion of air in the intake mixture and F<sub>e </sub>is the fraction of burned gas in the exhaust manifold that can be determined by methods described in literature. For stoichiometric or rich conditions F<sub>e </sub>can be set equal to one. F<sub>air </sub>can be determined from:
</p>
<p id="p-0074" num="0073">
<maths id="MATH-US-00010" num="00010">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>f</mi>
    <mi>air</mi>
  </msub>
  <mo>=</mo>
  <mfrac>
    <mn>1</mn>
    <mrow>
      <mn>1</mn>
      <mo>+</mo>
      <mfrac>
        <mn>1</mn>
        <mi>AFR</mi>
      </mfrac>
      <mo>+</mo>
      <msub>
        <mi>F</mi>
        <mi>i</mi>
      </msub>
    </mrow>
  </mfrac>
</mrow>
</math>
</maths>
<br/>
Where AFR is the air fuel ratio and F<sub>i </sub>is the fraction of burned gas in the exhaust manifold. F<sub>i </sub>can be estimated by methods described in literature. The volume occupied by the intake mixture at IVC can be determined by the equation:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?><i>V</i><sub>i,IVC</sub><i>=V</i><sub>IVC</sub><i>+V</i><sub>cl</sub><i>&#x2212;V</i><sub>r,IVC </sub><?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where V<sub>cl </sub>is the cylinder clearance volume, V<sub>r,IVC </sub>is the residual volume at IVC, and V<sub>IVC </sub>is the total cylinder volume at IVC. The residual volume at IVC can be empirically determined as a percentage of the total cylinder volume and stored in a function or table that may be indexed by engine speed and desired torque, for example. Typically, the percent EGR can be expressed as a mass fraction of the total cylinder air and exhaust (residual) mass, and may be based on emissions, fuel economy, and/or combustion stability. The molecular weight of exhaust and air can be assumed nearly equal so that V<sub>r,IVC </sub>can be expressed by:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>V<sub>r,IVC</sub>=EGR%&#xb7;(<i>V</i><sub>IVC</sub><i>+V</i><sub>cl</sub>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Where EGR % is a predetermine percentage of desired EGR in a cylinder (e.g., 0-25%). Substituting into the intake mixture volume equation from above yields:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>V<sub>i,IVC</sub><i>=V</i><sub>IVC</sub><i>+V</i><sub>cl</sub>&#x2212;EGR%&#xb7;(V<sub>IVC</sub>)&#x2212;EGR%&#xb7;(<i>V</i><sub>cl</sub>)<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
Solving for V<sub>IVC </sub>yields:
</p>
<p id="p-0075" num="0074">
<maths id="MATH-US-00011" num="00011">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>V</mi>
    <mi>IVC</mi>
  </msub>
  <mo>=</mo>
  <mfrac>
    <mrow>
      <msub>
        <mi>V</mi>
        <mrow>
          <mi>i</mi>
          <mo>,</mo>
          <mi>ICVC</mi>
        </mrow>
      </msub>
      <mo>-</mo>
      <mrow>
        <msub>
          <mi>V</mi>
          <mi>cl</mi>
        </msub>
        <mo>&#x2061;</mo>
        <mrow>
          <mo>(</mo>
          <mrow>
            <mn>1</mn>
            <mo>-</mo>
            <mrow>
              <mi>EGR</mi>
              <mo>&#x2062;</mo>
              <mi>%</mi>
            </mrow>
          </mrow>
          <mo>)</mo>
        </mrow>
      </mrow>
    </mrow>
    <mrow>
      <mo>(</mo>
      <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <mrow>
          <mi>EGR</mi>
          <mo>&#x2062;</mo>
          <mi>%</mi>
        </mrow>
      </mrow>
      <mo>)</mo>
    </mrow>
  </mfrac>
</mrow>
</math>
</maths>
<br/>
The cylinder volume minus the clearance volume at IVC can then be used to determine intake valve closing position by solving the following equation for &#x3b8;:
</p>
<p id="p-0076" num="0075">
<maths id="MATH-US-00012" num="00012">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>V</mi>
    <mi>&#x398;</mi>
  </msub>
  <mo>=</mo>
  <mrow>
    <mfrac>
      <mrow>
        <mi>&#x3c0;</mi>
        <mo>&#x2062;</mo>
        <mstyle>
          <mspace width="0.3em" height="0.3ex"/>
        </mstyle>
        <mo>&#x2062;</mo>
        <msup>
          <mi>B</mi>
          <mn>2</mn>
        </msup>
      </mrow>
      <mn>4</mn>
    </mfrac>
    <mo>&#x2061;</mo>
    <mrow>
      <mo>[</mo>
      <mrow>
        <mi>r</mi>
        <mo>+</mo>
        <mi>C</mi>
        <mo>-</mo>
        <mrow>
          <mo>(</mo>
          <mrow>
            <mrow>
              <mrow>
                <mi>C</mi>
                <mo>&#xb7;</mo>
                <mi>cos</mi>
              </mrow>
              <mo>&#x2062;</mo>
              <mstyle>
                <mspace width="0.3em" height="0.3ex"/>
              </mstyle>
              <mo>&#x2062;</mo>
              <mi>&#x398;</mi>
            </mrow>
            <mo>+</mo>
            <msqrt>
              <mrow>
                <msup>
                  <mi>r</mi>
                  <mn>2</mn>
                </msup>
                <mo>-</mo>
                <mrow>
                  <mrow>
                    <msup>
                      <mi>C</mi>
                      <mn>2</mn>
                    </msup>
                    <mo>&#xb7;</mo>
                    <msup>
                      <mi>sin</mi>
                      <mn>2</mn>
                    </msup>
                  </mrow>
                  <mo>&#x2062;</mo>
                  <mi>&#x398;</mi>
                </mrow>
              </mrow>
            </msqrt>
          </mrow>
          <mo>)</mo>
        </mrow>
      </mrow>
      <mo>]</mo>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
<br/>
Once the IVC location is determined, the polynomial equation describing valve trajectory from above can be used to solve for the IVO location. In this way, IVC is determined by accounting for EGR and desired air amount.
</p>
<p id="p-0077" num="0076">Alternatively, IVC position and valve opening duration may be considered to be a function of the valve release and/or repulsion point (i.e., the crankshaft angle where the armature is released and/or repulsed from the closing coil), engine speed, and of the natural response of the valve since the actuator armature may not be controlled by the valve opening coil. By using empirically determined IVC locations and engine speed to index a function or table, the valve release point (IVO) can be determined. For example, if engine speed is 800 RPM and a desired IVC is 40 crank angle degrees after TDC intake stroke, a predetermined IVO location can be determine by indexing a table based on engine speed and desired IVC. The tables or functions may be constructed to provide a desired level of resolution so that engine operating points that are between memorized data can provide a desired level of table output resolution.</p>
<p id="p-0078" num="0077">After determining IVC and IVO, the volume occupied by residual gas at IVC can be described by:</p>
<p id="p-0079" num="0078">
<maths id="MATH-US-00013" num="00013">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>V</mi>
    <mrow>
      <mi>r</mi>
      <mo>,</mo>
      <mi>IVC</mi>
    </mrow>
  </msub>
  <mo>=</mo>
  <mrow>
    <mrow>
      <mi>ERG</mi>
      <mo>&#x2062;</mo>
      <mstyle>
        <mspace width="0.3em" height="0.3ex"/>
      </mstyle>
      <mo>&#x2062;</mo>
      <mrow>
        <mi>%</mi>
        <mo>&#xb7;</mo>
        <mrow>
          <mo>(</mo>
          <mrow>
            <msub>
              <mi>V</mi>
              <mi>INC</mi>
            </msub>
            <mo>+</mo>
            <msub>
              <mi>V</mi>
              <mi>cl</mi>
            </msub>
          </mrow>
          <mo>)</mo>
        </mrow>
      </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
      <mfrac>
        <msub>
          <mi>T</mi>
          <mi>IVC</mi>
        </msub>
        <msub>
          <mi>T</mi>
          <mi>exh</mi>
        </msub>
      </mfrac>
      <mo>&#xb7;</mo>
      <mfrac>
        <msub>
          <mi>P</mi>
          <mi>exh</mi>
        </msub>
        <msub>
          <mi>P</mi>
          <mi>IVC</mi>
        </msub>
      </mfrac>
      <mo>&#xb7;</mo>
      <mrow>
        <mo>(</mo>
        <mrow>
          <msub>
            <mi>V</mi>
            <mrow>
              <mi>r</mi>
              <mo>,</mo>
              <mi>EVC</mi>
            </mrow>
          </msub>
          <mo>+</mo>
          <msub>
            <mi>V</mi>
            <mi>cl</mi>
          </msub>
        </mrow>
        <mo>)</mo>
      </mrow>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
<br/>
Where T<sub>IVC </sub>is the temperature at IVC that may be approximated by a regression of the form T<sub>IVC</sub>=f(N,m<sub>f</sub>,&#x3b8;<sub>OV</sub>). Where N is engine speed, m<sub>f </sub>is fuel flow rate, and &#x3b8;<sub>OV </sub>valve overlap. T<sub>exh </sub>is temperature in the exhaust manifold, P<sub>exh </sub>is pressure in the exhaust manifold, V<sub>cl </sub>is cylinder clearance volume, P<sub>IVC </sub>is pressure in the cylinder at IVC, and V<sub>r,EVC </sub>is the residual volume at EVC. In one example, where IVO is before EVC and where EVC and IVO are after TDC, V<sub>r,EVC </sub>can be described by:
</p>
<p id="p-0080" num="0079">
<maths id="MATH-US-00014" num="00014">
<math overflow="scroll">
<mrow>
  <msub>
    <mi>V</mi>
    <mrow>
      <mi>r</mi>
      <mo>,</mo>
      <mi>EVC</mi>
    </mrow>
  </msub>
  <mo>=</mo>
  <mrow>
    <mo>&#x222b;</mo>
    <mrow>
      <mfrac>
        <mrow>
          <msub>
            <mi>A</mi>
            <mi>e</mi>
          </msub>
          <mo>&#x2061;</mo>
          <mrow>
            <mo>(</mo>
            <mi>&#x398;</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
        <mrow>
          <mrow>
            <msub>
              <mi>A</mi>
              <mi>i</mi>
            </msub>
            <mo>&#x2061;</mo>
            <mrow>
              <mo>(</mo>
              <mi>&#x398;</mi>
              <mo>)</mo>
            </mrow>
          </mrow>
          <mo>+</mo>
          <mrow>
            <msub>
              <mi>A</mi>
              <mi>e</mi>
            </msub>
            <mo>&#x2061;</mo>
            <mrow>
              <mo>(</mo>
              <mi>&#x398;</mi>
              <mo>)</mo>
            </mrow>
          </mrow>
        </mrow>
      </mfrac>
      <mo>&#x2062;</mo>
      <mrow>
        <mo>&#x2146;</mo>
        <mrow>
          <mi>V</mi>
          <mo>&#x2061;</mo>
          <mrow>
            <mo>(</mo>
            <mi>&#x398;</mi>
            <mo>)</mo>
          </mrow>
        </mrow>
      </mrow>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
<br/>
Where the integral is evaluated from IVO to EVC, and where A<sub>i </sub>and A<sub>e </sub>are the effective areas of the intake and exhaust valves for &#x3b8;&#x3b5;(&#x3b8;<sub>IVO</sub>, &#x3b8;<sub>EVC</sub>). Thus, the before-mentioned valve trajectory describing polynomials can be evaluated from the previously determined IVO location to a EVC location that delivers the desired residual cylinder volume V<sub>r,EVC</sub>.
</p>
<p id="p-0081" num="0080">EVO may be determined experimentally and stored into memory as a function of engine operating parameters such as engine speed, cylinder load, engine temperature, and ambient air humidity. The routine continues to step <b>709</b>.</p>
<p id="p-0082" num="0081">Note: exhaust valves may also be controlled by a single coil. However, since exhaust pressure may have to be overcome during valve opening, the range of valve control may be limited. Further, current may be controlled to a coil by controlling the direction of current flow through the coil such that the coil can attract or repel the actuator armature.</p>
<p id="p-0083" num="0082">In step <b>709</b>, single coil controlled valve timing can be corrected. By operating the closing coil of a valve controlled in a mode where the opening coil is not activated during a cycle of the cylinder to capture the valve in an open and closed position, the valve closing coil current may be adjusted in response to a previous valve opening and closing cycle to adjust cylinder air charge. For example, the closing coil of an electrically actuated valve can be operated to release or repel the actuator armature so that the valve opens. During the valve opening trajectory, current to the valve closing coil can be controlled after a predetermined period, or alternatively based on a sensor signal, to close the valve at a first position, relative to the crankshaft. Subsequent operation of the closing coil to release the valve may be varied as the position of the previous valve closing varies. In this way, control of a valve closing coil may be adjusted in response to the previous valve closing event.</p>
<p id="p-0084" num="0083">A single coil controlled profile can be considered to be symmetric in shape due to the application of downward force on the valve due to the injection of air charge at intake valve opening (IVO) and the combination of mechanical and/or electrical force applied to the valve to initiate the lift. Further, pushback (i.e., air and exhaust gases that are pushed from the cylinder into the intake manifold while an intake valve is open) that can be caused by late intake valve closing can be considered negligible at many intake valve timings. Therefore, single coil controlled valve timing can be characterized by two parameters: IVO and P<sub>1</sub>, and where P<sub>1 </sub>can be defined as the peak valve lift crankshaft angle. The peak lift crankshaft angle can be the angle at which peak lift of the valve in single coil control is measured. Given these parameters an equation can be written for an estimate of intake valve closing (IVC<sub>est</sub>) for the valve.
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>IVC<sub>est</sub>=IVO+2*(<i>P</i><sub>l</sub>&#x2212;IVO).<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
The error, e, between an estimated IVC and a desired IVC can be written as the following equation:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>e=IVC&#x2212;IVC<sub>est</sub>=IVC&#x2212;IVO&#x2212;2*(<i>P</i><sub>l</sub>&#x2212;IVO).<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
An equation for a subsequent intake valve opening can be formed based on a previous intake valve closing, such as:
<br/>
<?in-line-formulae description="In-line Formulae" end="lead"?>IVO(<i>i+</i>1)=IVO(<i>i</i>)+&#x3b1;*<i>e</i>(<i>i</i>)=IVO(<i>i</i>)+&#x3b1;*(IVC(<i>i</i>)&#x2212;IVO (<i>i</i>)&#x2212;<i>IVO</i>(<i>i</i>)))<?in-line-formulae description="In-line Formulae" end="tail"?>
<br/>
where i is an event counter and a is a constant in the range &#x3b1; &#x3b5;(0,1]. The constant &#x3b1; can be used to slew to the adjusted timing over multiple cycles. From this equation, a desired IVO can be selected to yield the desired IVC.
</p>
<p id="p-0085" num="0084">Hyper-ballistic mode valve timing can also be corrected by using the before-mentioned single coil control correction and an additional correction for the current supplied to the opening coil. In one example, the valve lift can be measured and then compared to a desired valve lift amount. Then, by subtracting the actual valve lift from the desired valve lift a valve lift error can be generated. The error or a proportion of the error can be used to index a table or function that provides a current adjustment to the valve opening coil. This approach can reduce the valve lift error and can compensate for both positive and negative valve lift errors.</p>
<p id="p-0086" num="0085">In step <b>711</b>, valves are operated in single coil control or hyper-ballistic mode. Specifically, the valves are released and/or repulsed from respective closing coils, opening the valve without substantially capturing or holding the valve actuator armature by an opening magnet, and as the armature approaches the closing coil the valve can be set to a closed position. In addition, during the intake event, valve operating parameters can be monitored and stored into memory for subsequent valve timing error corrections. For example, stored parameters may include inducted air amount, valve opening position, valve lift height, valve closing position, valve current, and manifold pressure. The latest valve operating parameters may be used to modify nominal parameters that were initially programmed into the controller memory. Then the routine proceeds to exit.</p>
<p id="p-0087" num="0086">Note: it is not necessary for all intake valves of the engine to be actuated in a single coil control mode. For example, a fraction of the total number of cylinders may operate valves in a single coil control mode while others may operate valves in two coil mode. Alternatively, different intake valves may operate in different modes in a single cylinder, one intake valve in single coil control mode and another in a two coil mode for example.</p>
<p id="p-0088" num="0087">In step <b>711</b>, valves are operated by capturing or holding a valve and/or armature substantially motionless during a portion of a cylinder cycle by both the opening and closing coils. That is, the valves may be held in full open, full closed, levitated open (i.e., levitation is a position where the armature may be suspended near a actuator coil, using electromagnetic energy, while the valve may be open or closed), and/or levitated closed. Since the desired cylinder air amount may be out of single coil control or hyper-ballistic timing range, the opening and closing coils are used to open and close valves from full open to full closed positions at a desired open duration. In this mode, valve timing may be determined geometrically, as described in step <b>707</b>, or by another method to induct the desired air amount determined in step <b>703</b>. The valve commands are sent to controllers that actuate valves in respective cylinders, then routine proceeds to step <b>713</b>.</p>
<p id="p-0089" num="0088">In step <b>713</b>, the routine determines if the valve timing has delivered the desired cylinder air amount. In one example, an air meter in the intake system may be used to determine the air inducted into respective cylinders as described by U.S. Pat. No. 5,331,936 which is hereby fully incorporated by reference. Alternatively, a manifold pressure transducer or feedback from valve position sensors may be used to determine if a desired air amount has been inducted from the valve commands of step <b>711</b>. Specifically, a base individual cylinder air amount can be calculated using the well-known ideal gas law equation PV=mRT. The ideal gas equation, written for a four-cylinder engine compensated for operating conditions is as follows:</p>
<p id="p-0090" num="0089">
<maths id="MATH-US-00015" num="00015">
<math overflow="scroll">
<mrow>
  <mi>Mcyl</mi>
  <mo>=</mo>
  <mrow>
    <mfrac>
      <mi>D</mi>
      <mrow>
        <mn>4</mn>
        <mo>&#x2062;</mo>
        <mi>RT</mi>
      </mrow>
    </mfrac>
    <mo>&#xb7;</mo>
    <mrow>
      <mi>&#x3b7;</mi>
      <mo>&#x2061;</mo>
      <mrow>
        <mo>(</mo>
        <mrow>
          <mi>N</mi>
          <mo>,</mo>
          <mi>load</mi>
        </mrow>
        <mo>)</mo>
      </mrow>
    </mrow>
    <mo>&#xb7;</mo>
    <msub>
      <mi>P</mi>
      <mi>m</mi>
    </msub>
    <mo>&#xb7;</mo>
    <mrow>
      <mi>FNBP</mi>
      <mo>&#x2061;</mo>
      <mrow>
        <mo>(</mo>
        <mi>BP</mi>
        <mo>)</mo>
      </mrow>
    </mrow>
    <mo>&#xb7;</mo>
    <mrow>
      <mi>FNTEM</mi>
      <mo>&#x2061;</mo>
      <mrow>
        <mo>(</mo>
        <mrow>
          <mi>ECT</mi>
          <mo>,</mo>
          <mi>ACT</mi>
        </mrow>
        <mo>)</mo>
      </mrow>
    </mrow>
  </mrow>
</mrow>
</math>
</maths>
<br/>
Where Mcyl is the engine air amount or cylinder air charge, D is the displacement of the engine, R is the gas constant, T is the engine air temperature. The symbol &#x3b7; represents the engine volumetric efficiency, empirically determined, stored in a table with indices of engine speed and load. Manifold pressure, Pm can be based on measuring a signal from pressure transducer <b>122</b>.
</p>
<p id="p-0091" num="0090">If the inducted air amount is equal to the desired air amount the routing proceeds to exit. Alternatively, a dead band may be constructed around the desired air amount such that if the inducted air amount is within a predetermined region of the desired air amount the routine also exits. However, if the inducted air amount deviates from the desired air amount the routine proceeds to step <b>714</b>.</p>
<p id="p-0092" num="0091">In step <b>714</b>, the routine determines if IVC is at a limit of adjustment. Depending on the valve operating mode (e.g., single coil controlled or hyper-ballistic), IVC locations may be limited to a specific operating window. For example, IVC locations later than BDC may result in air charge amounts that are below an amount necessary for combustion. Consequently, boundary limits can be used to limit the IVC location during single coil control and hyper-ballistic valve operating modes. Further, the IVC limits may be based on crankshaft referenced locations and/or engine operating conditions that provide locations of high or low air charge amounts, engine speed for example. If the current valve timing is at an IVC limit then the routine proceeds to step <b>718</b>, otherwise the routine proceeds to step <b>716</b>.</p>
<p id="p-0093" num="0092">In step <b>716</b>, IVC timing is adjusted. In one example, feedback from an air mass sensing device may also be used to correct single coil control or hyper-ballistic mode valve operation. For example, an error signal may be produced by subtracting an actual inducted air mass from the desired inducted air mass. This error amount or a proportion of the error amount can then be added to the desired air amount, from step <b>703</b>, to compensate for any differences between the desired and actual inducted air amount. One effect of changing the desired air amount may be that the inducted air amount is changed by retarding or advancing the valve opening position, relative to a crankshaft position. Another effect may be that air amount is changed by increasing or decreasing valve lift (step <b>720</b>), and/or by increasing or decreasing the valve opening duration (step <b>720</b>). Furthermore, look-up functions or tables based on the air charge error can be used to modify desired air amount by adjusting the desired air amount as a function of the desired air amount error. In addition, adjustments may be made during a single intake stroke or they may be incrementally moved over the course of a number of intake events. Also, the before-mentioned air mass sensing device can be a mass air meter or a manifold pressure transducer. Alternatively, a combination of the two sensors may also be used. The routine proceeds to step <b>707</b>.</p>
<p id="p-0094" num="0093">In step <b>718</b>, the routine determines if valve lift and/or open duration is at a limit of adjustment. Valve lift control actions may be limited to a specific operating window. For example, engine operating conditions (e.g., speed, load, temperature, etc.) and/or the valve IVC location may result in air charge amounts that are below an amount necessary for combustion. Consequently, boundary limits can be used to limit the valve lift and/or opening duration during hyper-ballistic valve operating mode. Further, the valve lift and/or open duration limits may be based on crankshaft referenced locations and/or engine operating conditions that provide locations of higher or lower air charge amounts. If the current valve lift is at a limit then the routine proceeds to step <b>722</b>, otherwise the routine proceeds to step <b>720</b>.</p>
<p id="p-0095" num="0094">The path from step <b>713</b> to step <b>714</b>, and then to step <b>718</b> can cause valve adjustments to first modify the valve opening position and then to adjust valve lift and/or opening duration. However, it is also possible to first adjust valve lift and/or opening duration and then adjust the valve opening position. Alternatively, valve lift and/or duration and valve timing may be adjusted simultaneously.</p>
<p id="p-0096" num="0095">In step <b>720</b>, valve lift and/or opening duration can be adjusted. By controlling current to the opening coil valve lift and/or valve opening duration may be adjusted. By controlling the amount and direction of current in the opening coil, a permanent magnet actuator armature can be attracted or repelled. If a lift amount greater than that available from controlling a single coil is desired the opening coil may be used to attract and control the valve lift to an amount between a full open amount and a single coil controlled valve event amount. By controlling the current in the opening coil the lift amount can be varied. Typically, the valve duration may be affected by adjusting the valve lift amount. In addition, the valve lift amount may be controlled to an amount that is less than that achieved by controlling a valve with a single coil. For example, an armature plate of an electrically actuated valve can be moved so that the valve is moved from and closed position to an open position by adjusting current flow to the closing coil. During the valve opening the valve lift can be controlled by adjusting current flow to the opening coil to attract or repel the armature plate. By controlling current to the opening coil a magnetic repulsion force may be created by the opening coil against a permanent magnet armature plate. The repulsing force can be used in conjunction to the closing spring force to control the valve lift amount. Furthermore, the valve lift amount can be controlled by adjusting current flow to the valve opening coil in response to engine operating conditions so that as operating conditions vary the valve lift amount varies.</p>
<p id="p-0097" num="0096">Continuing with step <b>720</b>, similar to step <b>716</b>, an air mass sensing device may be used to correct valve lift in step <b>720</b>. An error signal may be produced by subtracting an actual inducted air mass from the desired inducted air mass. This error amount or a proportion of the error amount can then be added to the desired air amount, from step <b>703</b>, to compensate for any differences between the desired and actual inducted air amount. In addition, look-up functions or tables based on the air charge error can be used to modify desired air amount by adjusting the desired air amount as a function of the desired air amount error. The routine proceeds to step <b>707</b>.</p>
<p id="p-0098" num="0097">It is also possible to adjust valve lift and IVC in response to engine speed. For example, at one engine operating speed valve lift amount may be restricted to a predetermined value, but at another engine speed the valve lift amount may be restricted to a different amount. This alternative strategy can be used to control valve lift and IVC taking into account changes in engine breathing that may occur at different engine speeds.</p>
<p id="p-0099" num="0098">In another embodiment it is possible to time the end of injection with the adjusting IVC location. Alternatively, injection timing can be scheduled so that a portion of fuel injects on a closed valve and the remainder injects on an open valve. The injection options are available by linking the fuel injection location to the determined IVC.</p>
<p id="p-0100" num="0099">In step <b>722</b>, an alternate valve operating mode can be selected. In one example, a valve operating mode can be selected that captures and holds the valve substantially motionless for a portion of a cylinder cycle. This mode can be a typical electrically actuated valve mode since valve opening and closing can be controlled with respect to crankshaft position. For example, an intake valve can be held closed for 580 crankshaft degrees and then held open for the remaining 140 crankshaft degrees that make up a four-stroke combustion cycle. The routine proceeds to exit.</p>
<p id="p-0101" num="0100">As will be appreciated by one of ordinary skill in the art, the routines described in <figref idref="DRAWINGS">FIG. 7</figref> may represent one or more of any number of processing strategies such as event-driven, interrupt-driven, multi-tasking, multi-threading, and the like. As such, various steps or functions illustrated may be performed in the sequence illustrated, in parallel, or in some cases omitted. Likewise, the order of processing is not necessarily required to achieve the objects, features, and advantages described herein, but is provided for ease of illustration and description. Although not explicitly illustrated, one of ordinary skill in the art will recognize that one or more of the illustrated steps or functions may be repeatedly performed depending on the particular strategy being used.</p>
<p id="p-0102" num="0101">This concludes the description. The reading of it by those skilled in the art would bring to mind many alterations and modifications without departing from the spirit and the scope of the description. For example, I3, I4, I5, V6, V8, V10, and V12 engines operating in natural gas, gasoline, diesel, or alternative fuel configurations could use the present description to advantage.</p>
<?DETDESC description="Detailed Description" end="tail"?>
</description>
<us-math idrefs="MATH-US-00001 MATH-US-00001-2 MATH-US-00001-3" nb-file="US07640899-20100105-M00001.NB">
<img id="EMI-M00001" he="19.05mm" wi="76.20mm" file="US07640899-20100105-M00001.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00002 MATH-US-00002-2 MATH-US-00002-3" nb-file="US07640899-20100105-M00002.NB">
<img id="EMI-M00002" he="19.05mm" wi="76.20mm" file="US07640899-20100105-M00002.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00003 MATH-US-00003-2" nb-file="US07640899-20100105-M00003.NB">
<img id="EMI-M00003" he="15.16mm" wi="76.20mm" file="US07640899-20100105-M00003.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00004" nb-file="US07640899-20100105-M00004.NB">
<img id="EMI-M00004" he="16.59mm" wi="76.20mm" file="US07640899-20100105-M00004.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00005" nb-file="US07640899-20100105-M00005.NB">
<img id="EMI-M00005" he="6.35mm" wi="76.20mm" file="US07640899-20100105-M00005.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00006" nb-file="US07640899-20100105-M00006.NB">
<img id="EMI-M00006" he="6.35mm" wi="76.20mm" file="US07640899-20100105-M00006.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00007" nb-file="US07640899-20100105-M00007.NB">
<img id="EMI-M00007" he="6.35mm" wi="76.20mm" file="US07640899-20100105-M00007.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00008" nb-file="US07640899-20100105-M00008.NB">
<img id="EMI-M00008" he="7.03mm" wi="76.20mm" file="US07640899-20100105-M00008.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00009" nb-file="US07640899-20100105-M00009.NB">
<img id="EMI-M00009" he="10.92mm" wi="76.20mm" file="US07640899-20100105-M00009.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00010" nb-file="US07640899-20100105-M00010.NB">
<img id="EMI-M00010" he="9.57mm" wi="76.20mm" file="US07640899-20100105-M00010.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00011" nb-file="US07640899-20100105-M00011.NB">
<img id="EMI-M00011" he="6.35mm" wi="76.20mm" file="US07640899-20100105-M00011.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00012" nb-file="US07640899-20100105-M00012.NB">
<img id="EMI-M00012" he="6.69mm" wi="76.20mm" file="US07640899-20100105-M00012.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00013" nb-file="US07640899-20100105-M00013.NB">
<img id="EMI-M00013" he="6.35mm" wi="76.20mm" file="US07640899-20100105-M00013.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00014" nb-file="US07640899-20100105-M00014.NB">
<img id="EMI-M00014" he="6.35mm" wi="76.20mm" file="US07640899-20100105-M00014.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-math idrefs="MATH-US-00015" nb-file="US07640899-20100105-M00015.NB">
<img id="EMI-M00015" he="6.01mm" wi="76.20mm" file="US07640899-20100105-M00015.TIF" alt="embedded image " img-content="math" img-format="tif"/>
</us-math>
<us-claim-statement>The invention claimed is:</us-claim-statement>
<claims id="claims">
<claim id="CLM-00001" num="00001">
<claim-text>1. A method to adjust lift, amount of an electrically actuated valve, said electrically actuated valve operating in a cylinder of an internal combustion engine, the method comprising:
<claim-text>operating said electrically actuated valve at a first valve opening lift amount, by adjusting current flowing to a valve opening coil, at a first engine operating condition; and</claim-text>
<claim-text>operating said electrically actuated valve at a second valve opening lift amount, by adjusting current flowing to said valve opening coil, at a second engine operating condition, wherein said first valve opening lift amount is a full open lift amount, and wherein said second valve lift amount is less than a valve lift amount when said electrically actuated valve is suspended open by said valve opening coil.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00002" num="00002">
<claim-text>2. A method to adjust lift amount of an electrically actuated valve, said electrically actuated valve having a valve actuator comprising an armature, an armature plate having a permanent magnet, and at least a coil, said electrically actuated valve operating in a cylinder of an internal combustion engine, the method comprising:
<claim-text>moving said armature plate of said electrically actuated valve so that said electrically actuated valve is moved from a closed position toward an open position by adjusting current flow to a first coil of said valve actuator; and</claim-text>
<claim-text>adjusting current flow to a second coil of said valve actuator to repel said armature plate from said second coil as said electrically actuated valve moves toward said open position, said adjusted current moving said valve to an adjusted valve lift amount less than a valve lift amount when said electrically actuated valve is full open.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00003" num="00003">
<claim-text>3. The method of <claim-ref idref="CLM-00002">claim 2</claim-ref> wherein said electrically actuated valve is moved from the closed position by reducing current flow to said first coil.</claim-text>
</claim>
<claim id="CLM-00004" num="00004">
<claim-text>4. The method of <claim-ref idref="CLM-00002">claim 2</claim-ref> wherein said electrically actuated valve is moved from the closed position by changing the direction of current flowing to said first coil.</claim-text>
</claim>
<claim id="CLM-00005" num="00005">
<claim-text>5. The method of <claim-ref idref="CLM-00002">claim 2</claim-ref> wherein said adjusting current flow to said second coil increases a magnetic field produced by said second coil.</claim-text>
</claim>
<claim id="CLM-00006" num="00006">
<claim-text>6. A method to adjust lift amount of an electrically actuated intake valve, said electrically actuated intake valve having a valve actuator comprising an armature, an armature plate having a permanent magnet, and at least a coil, said electrically actuated intake valve operating in a cylinder of an internal combustion engine, the method comprising:
<claim-text>moving said armature plate of said electrically actuated intake valve so that said electrically actuated intake valve is moved from a closed position toward an open position by adjusting current flow to a first coil of said valve actuator; and</claim-text>
<claim-text>adjusting current flow to a second coil of said valve actuator to repel said armature plate from said second coil as said electrically actuated intake valve moves toward said open position, said adjusting current flow to said second coil increasing a magnetic field produced by said second coil, said adjusted current moving said valve to an adjusted valve lift amount less than a valve lift amount when said electrically actuated valve is full open.</claim-text>
</claim-text>
</claim>
<claim id="CLM-00007" num="00007">
<claim-text>7. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref> wherein said electrically actuated intake valve is moved from the closed position by reducing current flow to said first coil.</claim-text>
</claim>
<claim id="CLM-00008" num="00008">
<claim-text>8. The method of <claim-ref idref="CLM-00006">claim 6</claim-ref> wherein said electrically actuated intake valve is moved from the closed position by changing the direction of current flowing to said first coil.</claim-text>
</claim>
</claims>
</us-patent-grant>
